app.controller("AccountsUpdateCtrl",["$scope","$location","ApiService","ConfirmService","GrowlsService","GeographiesService",function(e,t,o,n,i,r){e.exception={};var s=function(){e.exception.error=null};e.url=o.buildUrl("/accounts/"+localStorage.getItem("account_id")),e.confirmCancel=function(){if(angular.equals(e.account,e.account_orig))utils.redirect(t,"/");else{var o={id:"changes_lost"};o.onConfirm=function(){utils.redirect(t,"/")},n.showConfirm(e,o)}};var a=r.getGeographies(!1);e.countries=a.countries,e.us_states=a.us_states,e.ca_provinces=a.ca_provinces,e.au_states=a.au_states,0==utils.inTestMode()&&o.getItem(e.url).then(function(t){e.account=t,e.account_orig=angular.copy(e.account),e.typeahead={},e.typeahead.country={},e.typeahead.state_prov={},null!=e.account.country&&(e.typeahead.country=_.find(e.countries,{code:e.account.country})),null!=e.account.state_prov&&("US"==e.account.country&&(e.typeahead.state_prov=_.find(e.us_states,{code:e.account.state_prov})),"CA"==e.account.country&&(e.typeahead.state_prov=_.find(e.ca_provinces,{code:e.account.state_prov})),"AU"==e.account.country&&(e.typeahead.state_prov=_.find(e.au_states,{code:e.account.state_prov})))},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.onCountrySelect=function(t,o,n){e.account.country=o.code},e.onStateSelect=function(t,o,n){e.account.state_prov=o.code},e.updateAccount=function(){s(),e.form.$invalid||o.set(e.account,e.url).then(function(e){i.addGrowl({id:"edit_success_no_link",type:"success"}),utils.redirect(t,"/")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.downloadContractPdf=function(){o.getItemPdf(o.buildUrl("/contracts/current")).then(function(e){var t=new Blob([e],{type:"application/pdf"});saveAs(t,"Contract_"+localStorage.getItem("account_id")+".pdf")},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("AppsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.exception={},e.resources={},e.functions={},e.resources.appListUrl=r.buildUrl("/apps"),e.meta={},e.functions.getLaunchUrl=function(e){if(e){var t=localStorage.getItem("oauth_callback_url")+"#access_token="+localStorage.getItem("token")+"&redirect_uri=",o=e.app_installation.launch_url;return t+=encodeURIComponent(o)}},e.functions.getInstallUrl=function(e){if(e){var t=localStorage.getItem("oauth_callback_url")+"#access_token="+localStorage.getItem("token")+"&redirect_uri=",o=e.install_url;return t+=encodeURIComponent(o)}}}]),app.controller("AppsSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","HelperService",function(e,t,o,n,i,r,s){e.exception={},e.app_display={},e.helperService=s,null!=t.id?(e.update=!0,e.add=!1,e.url=i.buildUrl("/apps/"+t.id),i.getItem(e.url,{expand:"images,app_package,source_app_package"}).then(function(t){e.app=t,t.settings_fields&&(e.app_display.settings_fields=JSON.stringify(t.settings_fields,null,4)),t.style_fields&&(e.app_display.style_fields=JSON.stringify(t.style_fields,null,4)),e.images=t.images,"app_default"==t.images[0].image_id&&(e.images=[]),e.redirect_uris=utils.arrayToString(t.redirect_uris),e.csp_hosts=utils.arrayToString(t.csp_hosts),null!=t.app_package&&(e.app_package=t.app_package,e.app_package_id=t.app_package.app_package_id),null!=t.source_app_package&&(e.source_app_package=t.source_app_package,e.source_app_package_id=t.source_app_package.app_package_id),delete e.app.app_package,delete e.app.source_app_package,delete e.app.images,e.app_orig=angular.copy(e.app)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0,e.app={is_public:!1,active:!1,hash_navigation:!1,allow_custom_css:!1,allow_custom_javascript:!1},e.images=[]),e.$watch("app_package",function(t,o){null!=t&&(e.app_package_id=t.app_package_id)}),e.$watch("source_app_package",function(t,o){null!=t&&(e.source_app_package_id=t.app_package_id)}),e.removeAppPackage=function(){e.app.app_package_id=null,e.app_package.app_package_id=null,e.showAppPackage=!1},e.removeSourceAppPackage=function(){e.app.source_app_package_id=null,e.source_app_package.source_app_package_id=null,e.showSourceAppPackage=!1};var a=function(){e.exception.error=null,null!=e.app_package&&(e.app.app_package_id=e.app_package.app_package_id),null!=e.source_app_package&&(e.app.source_app_package_id=e.source_app_package.app_package_id),null!=e.images&&_.each(e.images,function(t){null==e.app.image_ids&&(e.app.image_ids=[]),e.app.image_ids.push(t.image_id)}),0==e.app.client_side&&(e.app.type=null),0==e.app.platform_hosted&&(e.app.app_package_id=null,e.app.source_app_package=null,e.app.allow_source_download=!1,e.app.version=null,e.app.csp_hosts=null),"storefront"==e.app.type&&(e.redirect_uris=null,e.app.permissions=[]),null!=e.redirect_uris&&(e.app.redirect_uris=utils.stringToArray(e.redirect_uris)),null!=e.csp_hosts&&(e.app.csp_hosts=utils.stringToArray(e.csp_hosts))};e.confirmCancel=function(){if(angular.equals(e.app,e.app_orig))utils.redirect(o,"/apps");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/apps")},r.showConfirm(e,t)}},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},r.showConfirm(e,t)},e.setConditionals=function(){0==e.app.client_side&&(e.app.type=null,e.app.platform_hosted=!1),"storefront"==e.app.type&&(e.app.platform_hosted=!0)},e.addApp=function(){if(a(),e.form.settings_fields.$setValidity("json",!0),null!=utils.emptyToNull(e.app_display.settings_fields))try{e.app.settings_fields=JSON.parse(e.app_display.settings_fields)}catch(t){e.form.settings_fields.$setValidity("json",!1)}else e.app.settings_fields=null;if(e.form.style_fields.$setValidity("json",!0),null!=utils.emptyToNull(e.app_display.style_fields))try{e.app.style_fields=JSON.parse(e.app_display.style_fields)}catch(t){e.form.style_fields.$setValidity("json",!1)}else e.app.style_fields=null;return null!=e.redirect_uris&&(e.app.redirect_uris=utils.stringToArray(e.redirect_uris)),e.form.$invalid?void window.scrollTo(0,0):void i.set(e.app,i.buildUrl("/apps"),{show:"app_id,name"}).then(function(e){n.addGrowl({id:"add_success",name:e.name,type:"success",url:"#/apps/"+e.app_id+"/edit"}),utils.redirect(o,"/apps")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.updateApp=function(){if(a(),e.form.settings_fields.$setValidity("json",!0),null!=utils.emptyToNull(e.app_display.settings_fields))try{e.app.settings_fields=JSON.parse(e.app_display.settings_fields)}catch(t){e.form.settings_fields.$setValidity("json",!1)}else e.app.settings_fields=null;if(e.form.style_fields.$setValidity("json",!0),null!=utils.emptyToNull(e.app_display.style_fields))try{e.app.style_fields=JSON.parse(e.app_display.style_fields)}catch(t){e.form.style_fields.$setValidity("json",!1)}else e.app.style_fields=null;return null!=e.redirect_uris&&(e.app.redirect_uris=utils.stringToArray(e.redirect_uris)),e.form.$invalid?void window.scrollTo(0,0):(delete e.app.effective_permissions,void i.set(e.app,e.url,{show:"app_id,name"}).then(function(e){n.addGrowl({id:"edit_success",name:e.name,type:"success",app_id:e.app_id,url:"#/apps/"+e.app_id+"/edit"}),utils.redirect(o,"/apps")},function(t){window.scrollTo(0,0),e.exception.error=t}))},e.delete=function(){i.remove(e.url).then(function(){n.addGrowl({id:"delete_success_with_undelete",name:e.app.name,type:"success",url:"#/apps/"+e.app.app_id+"/edit"}),utils.redirect(o,"/apps")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.undelete=function(){i.set({deleted:!1},e.url,{show:"app_id,name"}).then(function(t){n.addGrowl({id:"undelete_success",name:e.app.name,type:"success",app_id:e.app.app_id,url:"#/apps/"+t.app_id+"/edit"}),utils.redirect(o,"/apps")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.stringify=function(e){return Json.stringify(e)}}]),app.controller("AppInstallationsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService","ConfirmService",function(e,t,o,n,i,r,s){e.exception={},e.resources={},e.resources.appInstallationListUrl=r.buildUrl("/app_installations"),e.meta={},e.meta.test=localStorage.getItem("test"),e.functions={},e.functions.uninstall=function(t,o){var n=r.buildUrl("/app_installations/"+t);r.remove(n).then(function(){i.addGrowl({id:"uninstall_success",name:o,type:"success"}),e.functions.refresh()},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.functions.confirmUninstall=function(t,o){var n={id:"app_uninstall"};n.onConfirm=function(){e.functions.uninstall(t,o)},s.showConfirm(e,n)},e.functions.setDefaultVersion=function(t,o){var n=r.buildUrl("/app_installations/"+t),s={is_default_version:!0};r.set(s,n,{show:"name"}).then(function(t){i.addGrowl({id:"set_default_app_version",name:t.name,type:"success"}),e.functions.refresh()},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.functions.confirmSetDefaultVersion=function(t){var o={id:"set_default_app_version"};o.onConfirm=function(){e.functions.setDefaultVersion(t)},s.showConfirm(e,o)},e.functions.getLaunchUrl=function(e){if(e){var t=localStorage.getItem("oauth_callback_url")+"#access_token="+localStorage.getItem("token")+"&redirect_uri=",o=e.launch_url;return e.version&&(o+="&target_version="+e.version),t+=encodeURIComponent(o)}},e.functions.getInstallUrl=function(e){if(e){var t=localStorage.getItem("oauth_callback_url")+"#access_token="+localStorage.getItem("token")+"&redirect_uri=",o=e.install_url;return e.updated_version_available&&(o+="&target_version="+e.current_app_version),t+=encodeURIComponent(o)}},e.functions.getInfoUrl=function(e,t){if(e.platform_hosted&&e.info_url&&utils.left(e.info_url,e.location_url.length)==e.location_url){var o=localStorage.getItem("oauth_callback_url")+"#access_token="+localStorage.getItem("token")+"&redirect_uri=";return o+"&redirect_uri="+encodeURIComponent(e.info_url)}return e.info_url}}]),app.controller("AppInstallationsSettingsCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,o,n,i,r){e.exception={},e.selections={},e.url=i.buildUrl("/app_installations/"+t.id),e.checkboxState={},i.getItem(e.url,{show:"app_installation_id,app_id,name,settings_fields.*,settings,alias,launch_url,location_url,allow_custom_javascript,custom_javascript"}).then(function(t){e.app_installation=t,null!=t.settings&&(e.selections=t.settings),e.settings_orig=angular.copy(e.app_installation.settings),e.app_host=utils.left(t.location_url,t.location_url.length-t.alias.length-1)},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.confirmCancel=function(){if(angular.equals(e.app_installation.config,e.config_orig))utils.redirect(o,"/app_installations");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/app_installations")},r.showConfirm(e,t)}},e.updateAppInstallation=function(t){e.app_installation.settings=e.selections,e.exception={},i.set(e.app_installation,e.url,{show:"app_installation_id,name"}).then(function(i){n.addGrowl({id:"edit_success",name:e.app_installation.name,type:"success",url:"#/app_installations/"+e.app_installation.app_installation_id+"/settings"}),t||utils.redirect(o,"/app_installations")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("AppInstallationsStyleCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,o,n,i,r){e.exception={},e.selections={},e.url=i.buildUrl("/app_installations/"+t.id),e.checkboxState={},i.getItem(e.url,{show:"app_installation_id,app_id,name,style_fields.*,style,allow_custom_css,custom_css"}).then(function(t){e.app_installation=t,null!=t.style&&(e.selections=t.style),e.style_orig=angular.copy(e.app_installation.style)},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.confirmCancel=function(){if(angular.equals(e.app_installation.style,e.style_orig))utils.redirect(o,"/app_installations");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/app_installations")},r.showConfirm(e,t)}},e.updateAppInstallation=function(t){e.app_installation.style=e.selections,e.exception={},i.set(e.app_installation,e.url,{show:"app_installation_id,name"}).then(function(i){n.addGrowl({id:"edit_success",name:e.app_installation.name,type:"success",url:"#/app_installations/"+e.app_installation.app_installation_id+"/style"}),t||utils.redirect(o,"/app_installations")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("AppPackagesCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","CurrenciesService","TimezonesService","HelperService",function(e,t,o,n,i,r,s,a,c){e.exception={},e.url=i.buildUrl("/app_packages/"+t.id),i.getItem(e.url).then(function(t){e.app_package=t,e.app_package_orig=angular.copy(e.app_package)},function(t){e.exception.error=t,window.scrollTo(0,0)});var l=function(){e.exception.error=null};e.update=function(){return l(),e.form.$invalid?void window.scrollTo(0,0):void i.multipartForm(e.app_package,null,e.url).then(function(e){n.addGrowl({id:"edit_success",name:"App Package "+t.id,type:"success",url:"#/app_packages/"+t.id+"/edit"})},function(t){window.scrollTo(0,0),e.exception.error=t})},e.download=function(){i.set(null,e.url+"/download").then(function(e){window.location=e.link},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("AuthsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.auths={},e.nav={},e.exception={},e.parseParams=function(){e.params=o.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadAuths=function(){r.getList(r.buildUrl("/auths?show=auth_id,token,comments,expires,date_created&sort_by="+e.params.date_type+"&desc="+e.params.desc),e.params).then(function(t){e.auths.authList=t,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,n){e.params[t]=n,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,o.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),o.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.auths.authList.next_page_offset:e.params.offset=e.auths.authList.previous_page_offset,e.nav.scrollTop=!0,o.search(e.params)},e.sort=function(t,n){e.params.sort_by=t,e.params.desc=n,o.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadAuths()}),e.parseParams(),e.loadAuths()}]),app.controller("AuthsSetCtrl",["$scope","$rootScope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","$http",function(e,t,o,n,i,r,s,a){e.exception={},e.data={},e.data.type="secret",e.data.test=!0,null!=o.id?(e.update=!0,e.add=!1,e.url=r.buildUrl("/auths/"+o.id),r.getItem(e.url).then(function(t){e.auth=t,e.auth_orig=angular.copy(e.auth)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0,e.auth={});var c=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.auth,e.auth_orig))utils.redirect(n,"/auths");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/auths")},s.showConfirm(e,t)}},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},s.showConfirm(e,t)},e.addAuth=function(){c(),e.form.$invalid||r.set(e.auth,r.buildUrl("/auths/secret"),{show:"auth_id,token",test:t.settings.test}).then(function(t){e.showToken=!0,e.auth.token=t.token},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.updateAuth=function(){c(),e.form.$invalid||(delete e.auth.effective_permissions,r.set(e.auth,e.url,{show:"auth_id,token"}).then(function(e){i.addGrowl({id:"edit_success",name:e.name,type:"success",name:e.token,url:"#/auths/"+e.auth_id+"/edit"}),utils.redirect(n,"/auths")},function(t){window.scrollTo(0,0),e.exception.error=t}))},e.delete=function(){r.remove(e.url).then(function(t){i.addGrowl({id:"delete_success",name:e.auth.token,type:"success"}),utils.redirect(n,"/auths")},function(t){window.scrollTo(0,0),e.exception.error=t})},e.addLimitedAuth=function(t){c();var o={headers:{Authorization:"Bearer "+localStorage.getItem("token"),Accept:"application/json;"}};0==t&&delete o.headers.Authorization;var n=a.post("/api/v1/auths/limited?account_id="+localStorage.getItem("account_id")+"&test="+t,null,o);n.success(function(t){e.showToken=!0,e.auth.token=t.token}),n.error(function(t){e.exception.error=t.error,window.scrollTo(0,0)})}}]),app.controller("CartsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.exception={},e.resources={},e.resources.cartListUrl=r.buildUrl("/carts")}]),app.controller("CartsViewCtrl",["$scope","$routeParams","ApiService","ConfirmService","GrowlsService",function(e,t,o,n,i){e.cart={},e.payment={},e.exception={},e.count={},e.count.payments=0,e.resources={},e.functions={},e.url=o.buildUrl("/carts/"+t.id),e.resources.paymentListUrl=e.url+"/payments";var r={expand:"customer,items.product,payments,payments.payment_method",hide:"items.product.images",formatted:!0};o.getItem(e.url,r).then(function(t){e.cart=t,e.successful_payment=_.findWhere(e.cart.payments.data,{success:!0})},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.hasPermission=function(e,t){return utils.hasPermission(e,t)},e.$watch("successful_payment.status",function(t,o){e.successful_payment&&void 0!=o&&(e.cart.payment_status=e.successful_payment.status)})}]),app.controller("CustomersListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.customers={},e.nav={},e.exception={},e.parseParams=function(){e.params=o.search(),utils.stringsToBool(e.params),null==e.params.date_type&&(e.params.date_type="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadCustomers=function(){r.getList(r.buildUrl("/customers?show=customer_id,name,email,has_payments,date_created&date_type="+e.params.date_type+"&desc="+e.params.desc),e.params).then(function(t){e.customers.customerList=t,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null,e.setPagination(e.customers.customerList)},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setPagination=function(t){e.nav.before_item=null,e.nav.after_item=null,t.data.length>0&&(null!=t.previous_page_url&&(e.nav.before_item=t.data[0].customer_id),null!=t.next_page_url&&(e.nav.after_item=t.data[t.data.length-1].customer_id))},e.setParam=function(t,n){e.params[t]=n,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,o.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),o.search(e.params))},e.movePage=function(t){"+"==t?(e.params.after_item=e.nav.after_item,e.params.before_item=null):(e.params.after_item=null,e.params.before_item=e.nav.before_item),e.nav.scrollTop=!0,o.search(e.params)},e.sort=function(t,n){e.params.date_type=t,e.params.desc=n,o.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadCustomers()}),e.parseParams(),e.params.has_payments=!0,e.loadCustomers()}]),app.controller("CustomersViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","GeographiesService",function(e,t,o,n,i,r,s){e.customer={},e.billing_address={},e.shipping_address={},e.cards=[],e.resources={},e.edit=!1,e.exception={},e.count={},e.count.orders=0,e.count.payments=0,e.count.subscriptions=0,e.count.refunds=0,e.count.invoices=0,e.url=i.buildUrl("/customers/"+t.id),e.resources.orderListUrl=e.url+"/orders",e.resources.subscriptionListUrl=e.url+"/subscriptions",e.resources.paymentListUrl=e.url+"/payments",e.resources.refundListUrl=e.url+"/refunds",e.resources.invoiceListUrl=e.url+"/invoices",i.getItem(e.url,{expand:"payment_methods"}).then(function(t){e.customer=t,e.payment_methods=t.payment_methods},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.hasPermission=function(e,t){return utils.hasPermission(e,t)},e.refreshPaymentMethods=function(){i.getList(e.url+"/payment_methods").then(function(t){e.payment_methods=t})}}]),app.controller("DashboardViewCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.dashboard={},e.exception={},e.options={},e.options.currencies=[],e.options.currencies.push(localStorage.getItem("reporting_currency_primary")),e.options.currencies.push(localStorage.getItem("reporting_currency_secondary")),e.options.currency=e.options.currencies[0],e.url=r.buildUrl("/dashboard"),e.loadDashboard=function(t){r.getItem(e.url,{currency:t,formatted:!0}).then(function(t){e.currency=t.currency,e.sales=[],_.each(t.sales,function(t){e.sales.push(t.total)}),e.sales_today=t.sales[29].formatted.total,e.sales_yesterday=t.sales[28].formatted.total,e.sales_month=t.sales_summary.formatted.total,e.new_subscriptions=[],_.each(t.new_subscriptions,function(t){e.new_subscriptions.push(t.total)}),e.new_subscriptions_today=t.new_subscriptions[29].formatted.total,e.new_subscriptions_yesterday=t.new_subscriptions[28].formatted.total,e.new_subscriptions_month=t.new_subscriptions_summary.formatted.total,e.subscription_renewals=[],_.each(t.subscription_renewals,function(t){e.subscription_renewals.push(t.total)}),e.subscription_renewals_today=t.subscription_renewals[29].formatted.total,e.subscription_renewals_yesterday=t.subscription_renewals[28].formatted.total,e.subscription_renewals_month=t.subscription_renewals_summary.formatted.total,e.subscriptions=[],_.each(t.subscriptions,function(t){e.subscriptions.push(t.total)}),e.subscriptions_today=t.subscriptions[29].formatted.total,e.subscriptions_yesterday=t.subscriptions[28].formatted.total,e.subscriptions_month=t.subscriptions_summary.formatted.total,e.cart_visitors=[],e.cart_visitors=_.pluck(t.cart_visitors,"value"),e.cart_visitors_today=t.cart_visitors[29].value,e.cart_visitors_yesterday=t.cart_visitors[28].value;for(var o=0,n=0;o<e.cart_visitors.length;n+=e.cart_visitors[o++]);e.cart_visitors_month=n,e.cart_conversions=[],e.cart_conversions=_.pluck(t.cart_conversions,"value"),e.cart_conversions_today=t.cart_conversions[29].value,e.cart_conversions_yesterday=t.cart_conversions[28].value;for(var o=0,n=0;o<e.cart_conversions.length;n+=e.cart_conversions[o++]);e.cart_conversions_month=n,e.cart_conversion_rates=[],e.cart_conversion_rates=_.pluck(t.cart_conversion_rates,"value"),e.cart_conversion_rates_today=t.cart_conversion_rates[29].value,e.cart_conversion_rates_yesterday=t.cart_conversion_rates[28].value,e.cart_conversion_rates_month=t.average_cart_conversion_rate,utils.renameProperty(t.customer_operating_systems,"item","label"),e.customer_operating_systems=t.customer_operating_systems,utils.renameProperty(t.customer_languages,"item","label"),e.customer_languages=t.customer_languages,utils.renameProperty(t.customer_browsers,"item","label"),e.customer_browsers=t.customer_browsers,utils.renameProperty(t.customer_locations,"item","label"),e.customer_locations=t.customer_locations,utils.renameProperty(t.customer_devices,"item","label"),e.customer_devices=t.customer_devices,utils.renameProperty(t.customer_new_vs_returning,"item","label"),e.customer_new_vs_returning=t.customer_new_vs_returning},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.loadDashboard(e.options.currency)}]),app.controller("EventsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.events={},e.nav={},e.exception={},e.parseParams=function(){e.params=o.search(),utils.stringsToBool(e.params),null==e.params.status&&(e.params.status="delivered"),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadEvents=function(){r.getList(r.buildUrl("/events"),e.params).then(function(t){e.events.eventList=t,e.eventsChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,n){e.params[t]=n,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,o.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),o.search(e.params))},e.movePage=function(t,n){"+"==t?(e.params.after_item=n,e.params.before_item=null):(e.params.after_item=null,e.params.before_item=n),e.nav.scrollTop=!0,o.search(e.params)},e.sort=function(t,n){e.params.sort_by=t,e.params.desc=n,o.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadEvents()}),e.parseParams(),e.loadEvents()}]),app.controller("EventViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService",function(e,t,o,n,i,r,s){e.event={},e.exception={},e.options={},e.options.raw=!0,e.url=i.buildUrl("/events/"+t.id);var a={expand:"event_subscription",debug:!0};i.getItem(e.url,a).then(function(t){e.event=t,e.event.data=JSON.stringify(e.event.data,null,4)},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.retryEvent=function(){e.exception={},i.set(null,e.event.url+"/retry").then(function(e){n.addGrowl({id:"event_resend",type:"success"})},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("EventSubscriptionsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.eventSubscriptions={},e.nav={},e.exception={},e.parseParams=function(){e.params=o.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadEventSubscriptions=function(){r.getList(r.buildUrl("/event_subscriptions"),e.params).then(function(t){e.eventSubscriptions.subscriptionList=t,e.eventSubscriptionsChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,n){e.params[t]=n,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,o.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),o.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.eventSubscriptions.subscriptionList.next_page_offset:e.params.offset=e.eventSubscriptions.subscriptionList.previous_page_offset,e.nav.scrollTop=!0,o.search(e.params)},e.sort=function(t,n){e.params.sort_by=t,e.params.desc=n,o.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadEventSubscriptions()}),e.parseParams(),e.loadEventSubscriptions()}]),app.controller("EventSubscriptionsSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService","TimezonesService",function(e,t,o,n,i,r,s,a){e.eventSubscription={},e.timezones=a.getTimezones(),e.environmentVariables=[],e.event_types=[{name:"Account Modified",code:"account:modified"},{name:"Cart Payment Completed",code:"cart:payment_completed"},{name:"Gateway Created",code:"gateway:created"},{name:"Gateway Modified",code:"gateway:modified"},{name:"Event Subscription Created",code:"event_subscription:created"},{name:"Event Subscription Modified",code:"event_subscription:modified"},{name:"Event Subscription Deleted",code:"event_subscription:deleted"},{name:"License Service Low Licenses",code:"license_service:low_licenses"},{name:"Invoice Created",code:"invoice:created"},{name:"Invoice Payment Completed",code:"invoice:payment_completed"},{name:"Order Created",code:"order:created"},{name:"Order Licenses Assigned",code:"order:licenses_assigned"},{name:"Order Payment Completed",code:"order:payment_completed"},{name:"Order Fulfilled",code:"order:fulfilled"},{name:"Payment Created Success",code:"payment:created_success"},{name:"Payment Created Failure",code:"payment:created_failure"},{name:"Payment Captured Success",code:"payment:captured_success"},{name:"Payment Captured Failure",code:"payment:captured_failure"},{name:"Payment Voided",code:"payment:voided"},{name:"Product Created",code:"product:created"},{name:"Product Modified",code:"product:modified"},{name:"Product Deleted",code:"product:deleted"},{name:"Refund Created Success",code:"refund:created_success"},{name:"Refund Created Failure",code:"refund:created_failure"},{name:"Refund Deleted",code:"refund:deleted"},{name:"User Created",code:"user:created"},{name:"User Modified",code:"user:modified"},{name:"Shipment Created",code:"shipment:created"},{name:"Shipment Modified",code:"shipment:modified"},{name:"Shipment Deleted",code:"shipment:deleted"},{name:"Subscription Created",code:"subscription:created"},{name:"Subscription Cancelled",code:"subscription:cancelled"},{name:"Subscription Item Cancelled",code:"subscription_item:cancelled"},{name:"Subscription Completed",code:"subscription:completed"},{name:"Subscription Converted",code:"subscription:converted"},{name:"Subscription Renewal Success",code:"subscription:renewal_success"},{name:"Subscription Renewal Failure",code:"subscription:renewal_failure"}],e.exception={},e.options={email:null,url:null},null!=t.id?(e.update=!0,e.add=!1,e.url=i.buildUrl("/event_subscriptions/"+t.id),i.getItem(e.url).then(function(t){if(e.eventSubscription=t,"http"==e.eventSubscription.method?e.options.url=e.eventSubscription.destination:e.options.email=e.eventSubscription.destination,t.environment_variables)for(var o in t.environment_variables)t.environment_variables.hasOwnProperty(o)&&e.environmentVariables.push({name:o,value:t.environment_variables[o]})},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0,e.eventSubscription.method="http",e.eventSubscription.format="json",e.eventSubscription.active=!0);var c=function(){e.exception.error=null,"http"==e.eventSubscription.method?e.eventSubscription.destination=e.options.url:e.eventSubscription.destination=e.options.email,e.eventSubscription.environment_variables={};for(var t in e.environmentVariables)utils.isNullOrEmpty(e.environmentVariables[t].name)||utils.isNullOrEmpty(e.environmentVariables[t].value)||(e.eventSubscription.environment_variables[e.environmentVariables[t].name]=e.environmentVariables[t].value);e.eventSubscription.environment_variables=e.eventSubscription.environment_variables};e.addVariable=function(){e.environmentVariables.push({name:null,value:null})},e.removeVariable=function(e,t){e.splice(t,1)},e.confirmCancel=function(){var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/event_subscriptions")},r.showConfirm(e,t)},e.addEventSubscription=function(){return c(),"http"==e.eventSubscription.method&&(e.form.email.$setValidity("characters",!0),e.form.email.$setValidity("required",!0)),"email"==e.eventSubscription.method&&(e.form.url.$setValidity("characters",!0),e.form.url.$setValidity("required",!0)),e.form.$invalid?void window.scrollTo(0,0):void i.set(e.eventSubscription,i.buildUrl("/event_subscriptions"),{show:"event_subscription_id,name"}).then(function(e){n.addGrowl({id:"add_success",name:e.event_subscription_id,type:"success",event_subscription_id:e.event_subscription_id,url:"#/event_subscriptions/"+e.event_subscription_id+"/edit"}),window.location="#/event_subscriptions"},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.updateEventSubscription=function(){return c(),"http"==e.eventSubscription.method&&(e.form.email.$setValidity("characters",!0),e.form.email.$setValidity("required",!0)),"email"==e.eventSubscription.method&&(e.form.url.$setValidity("characters",!0),e.form.url.$setValidity("required",!0)),e.form.$invalid?void window.scrollTo(0,0):void i.set(e.eventSubscription,e.url,{show:"event_subscription_id,name"}).then(function(e){n.addGrowl({id:"edit_success",name:e.event_subscription_id,type:"success",event_subscription_id:e.event_subscription_id,url:"#/event_subscriptions/"+e.event_subscription_id+"/edit"}),window.location="#/event_subscriptions"},function(t){window.scrollTo(0,0),e.exception.error=t})},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},r.showConfirm(e,t)},e.delete=function(){
i.remove(e.eventSubscription.url).then(function(t){n.addGrowl({id:"delete_success",name:e.eventSubscription.event_subscription_id,type:"success"}),utils.redirect(o,"/event_subscriptions")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("FilesListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.files={},e.nav={},e.exception={},e.parseParams=function(){e.params=o.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="name"),null==e.params.desc&&(e.params.desc=!1)},e.loadFiles=function(){r.getList(r.buildUrl("/files?show=file_id,filename,name,version,bytes,date_created"),e.params).then(function(t){e.files.fileList=t,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),o.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.files.fileList.next_page_offset:e.params.offset=e.files.fileList.previous_page_offset,e.nav.scrollTop=!0,o.search(e.params)},e.sort=function(t,n){e.params.sort_by=t,e.params.desc=n,o.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadFiles()}),e.parseParams(),e.loadFiles()}]),app.controller("FilesAddCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,o,n,i,r){e.file={},e.file.expires_in_days=7,e.file.expires_in_clicks=10,e.options={by_url:!1},e.exception={},e.uploadSending=!1;e.$on("uploadSending",function(t,o){e.$apply(function(){e.uploadSending=o})}),e.$on("uploadDelete",function(t,n,s){var a={id:"delete"};a.onConfirm=function(){e.$broadcast("uploadDeleted",s),i.remove(n.url,null,!1),utils.redirect(o,"/files")},r.showConfirm(e,a)}),e.$on("uploadComplete",function(e,t){n.addGrowl({id:"add_success",name:t.name,type:"success",file_id:t.file_id,url:"#/files/"+t.file_id+"/edit"}),utils.redirect(o,"/files")});e.uploadByUrl=function(){var t=angular.copy(e.file);t.file_url=e.options.url,t.http_authorization_username=e.options.http_authorization_username,t.http_authorization_password=e.options.http_authorization_password,i.multipartForm(t,null,i.buildUrl("/files")).then(function(e){n.addGrowl({id:"add_success",name:e.name,type:"success",file_id:e.file_id,url:"#/files/"+e.file_id+"/edit"}),utils.redirect(o,"/files")},function(t){e.exception.error=t,window.scrollTo(0,0)})};e.cancel=function(){if(e.uploadSending){var t={id:"upload_cancel"};t.onConfirm=function(){e.$broadcast("uploadCanceled"),utils.redirect(o,"/files")},r.showConfirm(e,t)}else utils.redirect(o,"/files")}}]),app.controller("FilesEditCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,o,n,i,r){e.file={},e.exception={},e.options={by_url:!1},e.url=i.buildUrl("/files/"+t.id),e.uploadUrl="/files/"+t.id,i.getItem(e.url).then(function(t){e.file=t,e.file_orig=angular.copy(e.file)},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.confirmCancel=function(){if(angular.equals(e.file,e.file_orig))utils.redirect(o,"/files");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/files")},r.showConfirm(e,t)}},e.uploadSending=!1;e.$on("uploadSending",function(t,o){e.$apply(function(){e.uploadSending=o})}),e.$on("uploadComplete",function(t,i){e.$apply(function(){n.addGrowl({id:"edit_success",name:i.name,type:"success",file_id:i.file_id,url:"#/files/"+i.file_id+"/edit"}),utils.redirect(o,"/files")})});e.cancelUpload=function(){if(e.uploadSending){var t={id:"upload_cancel"};t.onConfirm=function(){e.$broadcast("uploadCanceled"),utils.redirect(o,"/files")},r.showConfirm(e,t)}else utils.redirect(o,"/files")};var s=function(){e.exception.error=null};e.updateFile=function(){s(),i.multipartForm(e.file,null,e.file.url,{show:"file_id,name"}).then(function(e){n.addGrowl({id:"edit_success",name:e.name,type:"success",file_id:e.file_id,url:"#/files/"+e.file_id+"/edit"}),utils.redirect(o,"/files")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.uploadByUrl=function(){s();var t=angular.copy(e.file);t.file_url=e.options.url,t.http_authorization_username=e.options.http_authorization_username,t.http_authorization_password=e.options.http_authorization_password,i.multipartForm(t,null,i.buildUrl("/files/"+t.file_id)).then(function(e){n.addGrowl({id:"edit_success",name:e.name,type:"success",file_id:e.file_id,url:"#/files/"+e.file_id+"/edit"}),utils.redirect(o,"/files")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.deleteFile()},r.showConfirm(e,t)},e.deleteFile=function(){i.remove(e.file.url).then(function(){n.addGrowl({id:"delete_success",name:e.file.name,type:"success"}),utils.redirect(o,"/files")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("GatewaysListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.gateways={},e.nav={},e.exception={},e.parseParams=function(){e.params=o.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadGateways=function(){r.getList(r.buildUrl("/gateways?show=gateway_id,name,active,payment_method_type,date_created&sort_by="+e.params.sort_by+"&desc="+e.params.desc),e.params).then(function(t){e.gateways.gatewayList=t,e.gatewaysChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setActive=function(t){e.exception={};var o=_.where(e.gateways.gatewayList.data,{checked:!0}),s=15;if(o.length>s)return void(e.exception={error:{message:"You can select a maximum of "+s+" items to bulk update."}});var a=n.when();_.each(o,function(e){a=a.then(function(){return r.set({active:t},e.url).then(function(t){e.active=t.active},function(t){i.addGrowl({id:"active_change_failure",name:e.name,type:"danger"})})})})},e.setParam=function(t,n){e.params[t]=n,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,o.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),o.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.gateways.gatewayList.next_page_offset:e.params.offset=e.gateways.gatewayList.previous_page_offset,e.nav.scrollTop=!0,o.search(e.params)},e.sort=function(t,n){e.params.sort_by=t,e.params.desc=n,o.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadGateways()}),e.checkGateway=function(t){t.checked?(t.checked=!1,e.gatewaysChecked=!1,_.each(e.gateways.gatewayList.data,function(t){t.checked&&(e.gatewaysChecked=!0)})):(t.checked=!0,e.gatewaysChecked=!0)},e.parseParams(),e.loadGateways()}]),app.controller("GatewaysSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService",function(e,t,o,n,i,r,s){e.exception={},e.models={},e.models.selectedCurrencies=[],e.models.selectedCardTypes=[],e.showFields=!1,e.gateway_config={},null!=t.id?(e.update=!0,e.add=!1,e.url=i.buildUrl("/gateways/"+t.id),i.getItem(e.url,{show_sensitive:!0}).then(function(t){e.gateway=t,i.getItem(i.buildUrl("/gateways/options")).then(function(o){e.gateway_configs=o.gateway_configs,e.currencies=o.currencies,e.card_types=o.card_types,_.each(t.currencies,function(t){var o=_.findWhere(e.currencies,{code:t});null!=o&&e.models.selectedCurrencies.push(o)}),_.each(t.card_types,function(t){e.models.selectedCardTypes.push(t)}),e.loadFields(t.provider_id)},function(t){e.exception.error=t}),e.gateway_orig=angular.copy(e.gateway)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0,e.gateway={active:!1,currencies:[],card_types:[],fields:{},weight:1},i.getItem(i.buildUrl("/gateways/options")).then(function(t){e.gateway_configs=t.gateway_configs,e.currencies=t.currencies,e.card_types=t.card_types},function(t){e.exception.error=t}));var a=function(){e.exception.error=null,e.gateway.currencies=_.pluck(e.models.selectedCurrencies,"code"),e.gateway.card_types=e.models.selectedCardTypes};e.confirmCancel=function(){if(angular.equals(e.gateway,e.gateway_orig))utils.redirect(o,"/gateways");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/gateways")},r.showConfirm(e,t)}},e.addGateway=function(){a(),e.form.$invalid||i.set(e.gateway,i.buildUrl("/gateways"),{show:"gateway_id,name"}).then(function(e){n.addGrowl({id:"add_success",name:e.name,type:"success",gateway_id:e.gateway_id,url:"#/gateways/"+e.gateway_id+"/edit"}),s.setAccountMeta(),utils.redirect(o,"/gateways")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.updateGateway=function(){a(),e.form.$invalid||i.set(e.gateway,e.url,{show:"gateway_id,name"}).then(function(e){n.addGrowl({id:"edit_success",name:e.name,type:"success",url:"#/gateways/"+e.gateway_id+"/edit"}),s.setAccountMeta(),utils.redirect(o,"/gateways")},function(t){window.scrollTo(0,0),e.exception.error=t})},e.loadGatewayConfig=function(t){e.gateway_config=_.findWhere(e.gateway_configs,{provider_id:e.gateway.provider_id}),1==e.gateway_config.payment_method_types.length&&(e.gateway.payment_method_type=e.gateway_config.payment_method_types[0]),e.loadFields(t)},e.loadFields=function(t){var o=_.findWhere(e.gateway_configs,{provider_id:t});o&&(o.fields.length>0?e.fields=o.fields:e.fields=null)},e.onCurrencySelect=function(t,o,n){_.findWhere(e.models.selectedCurrencies,{code:o.code})||e.models.selectedCurrencies.push(o),e.typeahead.currency=null},e.removeCurrency=function(t){e.models.selectedCurrencies=_.reject(e.models.selectedCurrencies,function(e){return e.code==t.code})},e.onCardTypeSelect=function(t,o,n){e.models.selectedCardTypes.push(o),e.typeahead.card_types=null},e.removeCardType=function(t){e.models.selectedCardTypes=_.reject(e.models.selectedCardTypes,function(e){return e==t})},e.supportsCreditCard=function(e){return!(!e||"credit_card"!=e.payment_method_type)},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},r.showConfirm(e,t)},e.delete=function(){i.remove(e.url).then(function(){n.addGrowl({id:"delete_success",name:e.gateway.name,type:"success"}),utils.redirect(o,"/gateways")},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("GettingStartedViewCtrl",["$scope","$q","$routeParams","ApiService","GrowlsService",function(e,t,o,n,i){var r=function(t){e.cartUrl="#/app_installations"};e.onNavigate=function(){$(window).trigger("openSubMenu")},e.account_id=localStorage.getItem("account_id"),r(utils.stringToBool(localStorage.getItem("test")))}]),app.controller("HostedFunctionsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.hostedFunctions={},e.nav={},e.exception={},e.parseParams=function(){e.params=o.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="name"),null==e.params.desc&&(e.params.desc=!1)},e.loadHostedFunctions=function(){r.getList(r.buildUrl("/hosted_functions?show=hosted_function_id,filename,name,environment,bytes,date_created"),e.params).then(function(t){e.hostedFunctions.hostedFunctionList=t,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),o.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.hostedFunctions.hostedFunctionList.next_page_offset:e.params.offset=e.hostedFunctions.hostedFunctionList.previous_page_offset,e.nav.scrollTop=!0,o.search(e.params)},e.sort=function(t,n){e.params.sort_by=t,e.params.desc=n,o.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadHostedFunctions()}),e.parseParams(),e.loadHostedFunctions()}]),app.controller("HostedFunctionsAddCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,o,n,i,r){e.hostedFunction={environment_variables:{}},e.exception={},e.environmentVariables=[],e.environments=[{name:"Node.js 4.3",code:"nodejs4.3",deprecated:!0},{name:"Node.js 6.10",code:"nodejs6.10"},{name:"Node.js 8.10",code:"nodejs8.10"},{name:"Java 8",code:"java8"},{name:"Python 2.7",code:"python2.7"},{name:"Python 3.6",code:"python3.6"},{name:".NET Core 1.0",code:"dotnetcore1.0"},{name:".NET Core 2.0",code:"dotnetcore2.0"},{name:"Go 1.x",code:"go1.x"}],e.isDeprecated=function(t){var o=_.find(e.environments,function(e){return e.code==t});return!(!o||!o.deprecated)},e.uploadSending=!1;e.$on("uploadSending",function(t,o){e.$apply(function(){e.uploadSending=o})}),e.$on("uploadDelete",function(t,n,s){var a={id:"delete"};a.onConfirm=function(){e.$broadcast("uploadDeleted",s),i.remove(n.url,null,!1),utils.redirect(o,"/hosted_functions")},r.showConfirm(e,a)}),e.$on("uploadComplete",function(e,t){n.addGrowl({id:"add_success",name:t.name,type:"success",hosted_function_id:t.hosted_function_id,url:"#/hosted_functions/"+t.hosted_function_id+"/edit"}),utils.redirect(o,"/hosted_functions")});e.addVariable=function(){e.environmentVariables.push({name:null,value:null}),e.setVariables()},e.removeVariable=function(t,o){t.splice(o,1),e.setVariables()},e.setVariables=function(){var t={};$.each(e.environmentVariables,function(e,o){utils.isNullOrEmpty(o.name)||utils.isNullOrEmpty(o.value)||(t[o.name]=o.value)}),e.environment_variables_json=JSON.stringify(t)},e.cancel=function(){if(e.uploadSending){var t={id:"upload_cancel"};t.onConfirm=function(){e.$broadcast("uploadCanceled"),utils.redirect(o,"/hosted_functions")},r.showConfirm(e,t)}else utils.redirect(o,"/hosted_functions")}}]),app.controller("HostedFunctionsEditCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,o,n,i,r){e.hostedFunction={},e.exception={},e.environmentVariables=[],e.environments=[{name:"Node.js 4.3",code:"nodejs4.3",deprecated:!0},{name:"Node.js 6.10",code:"nodejs6.10"},{name:"Node.js 8.10",code:"nodejs8.10"},{name:"Java 8",code:"java8"},{name:"Python 2.7",code:"python2.7"},{name:"Python 3.6",code:"python3.6"},{name:".NET Core 1.0",code:"dotnetcore1.0"},{name:".NET Core 2.0",code:"dotnetcore2.0"},{name:"Go 1.x",code:"go1.x"}],e.isDeprecated=function(t){var o=_.find(e.environments,function(e){return e.code==t});return!(!o||!o.deprecated)},e.url=i.buildUrl("/hosted_functions/"+t.id),e.uploadUrl="/hosted_functions/"+t.id,i.getItem(e.url).then(function(t){if(e.hostedFunction=t,t.environment_variables)for(var o in t.environment_variables)t.environment_variables.hasOwnProperty(o)&&e.environmentVariables.push({name:o,value:t.environment_variables[o]});e.hostedFunction_orig=angular.copy(e.hostedFunction)},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.confirmCancel=function(){if(angular.equals(e.hostedFunction,e.hostedFunction_orig))utils.redirect(o,"/hosted_functions");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/hosted_functions")},r.showConfirm(e,t)}},e.uploadSending=!1;e.$on("uploadSending",function(t,o){e.$apply(function(){e.uploadSending=o})}),e.$on("uploadComplete",function(t,o){e.$apply(function(){e.hostedFunction=o})});e.cancelUpload=function(){if(e.uploadSending){var t={id:"upload_cancel"};t.onConfirm=function(){e.$broadcast("uploadCanceled"),utils.redirect(o,"/hosted_functions")},r.showConfirm(e,t)}else utils.redirect(o,"/hosted_functions")},e.addVariable=function(){e.environmentVariables.push({name:null,value:null}),e.setVariables()},e.removeVariable=function(t,o){t.splice(o,1),e.setVariables()},e.setVariables=function(){var t={};$.each(e.environmentVariables,function(e,o){utils.isNullOrEmpty(o.name)||utils.isNullOrEmpty(o.value)||(t[o.name]=o.value)}),e.environment_variables_json=JSON.stringify(t)};var s=function(){e.exception.error=null,e.hostedFunction.environment_variables={};for(var t in e.environmentVariables)utils.isNullOrEmpty(e.environmentVariables[t].name)||utils.isNullOrEmpty(e.environmentVariables[t].value)||(e.hostedFunction.environment_variables[e.environmentVariables[t].name]=e.environmentVariables[t].value);e.hostedFunction.environment_variables=JSON.stringify(e.hostedFunction.environment_variables)};e.updateHostedFunction=function(){s(),i.multipartForm(e.hostedFunction,null,e.hostedFunction.url,{show:"hosted_function_id,name"}).then(function(e){n.addGrowl({id:"edit_success",name:e.name,type:"success",hosted_function_id:e.hosted_function_id,url:"#/hosted_functions/"+e.hosted_function_id+"/edit"}),utils.redirect(o,"/hosted_functions")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.deleteHostedFunction()},r.showConfirm(e,t)},e.deleteHostedFunction=function(){i.remove(e.hostedFunction.url).then(function(){n.addGrowl({id:"delete_success",name:e.hostedFunction.name,type:"success"}),utils.redirect(o,"/hosted_functions")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("ImagesListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.images={},e.nav={},e.exception={},e.parseParams=function(){e.params=o.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!1)},e.loadImages=function(){r.getList(r.buildUrl("/images?show=image_id,filename,link_square,link_large,date_created&sort_by="+e.params.sort_by+"&desc="+e.params.desc),e.params).then(function(t){e.images.imageList=t,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),o.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.images.imageList.next_page_offset:e.params.offset=e.images.imageList.previous_page_offset,e.nav.scrollTop=!0,o.search(e.params)},e.sort=function(t,n){e.params.sort_by=t,e.params.desc=n,o.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadImages()}),e.parseParams(),e.loadImages()}]),app.controller("ImagesAddCtrl",["$scope","$routeParams","GrowlsService","ApiService","ConfirmService",function(e,t,o,n,i){e.image={},e.exception={},e.state={},e.state.uploadSending=!1,e.state.uploadComplete=!1;e.$on("uploadSending",function(t,o){e.$apply(function(){e.state.uploadSending=o})});e.showDelete=!1,utils.hasPermission("images","delete")&&(e.showDelete=!0);e.$on("uploadDelete",function(t,o,r){var s={id:"delete"};s.onConfirm=function(){e.$broadcast("uploadDeleted",r),utils.hasPermission("images","delete")&&n.remove(o.url,null,!1)},i.showConfirm(e,s)}),e.$on("uploadComplete",function(t,o){e.state.uploadComplete=!0});e.cancel=function(){if(e.state.uploadSending){var t={id:"upload_cancel"};t.onConfirm=function(){e.$broadcast("uploadCanceled"),utils.redirect($location,"/images")},i.showConfirm(e,t)}else utils.redirect($location,"/images")}}]),app.controller("ImagesViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,o,n,i,r){e.image={},e.exception={},e.url=i.buildUrl("/images/"+t.id),i.getItem(e.url).then(function(t){e.image=t},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.deleteImage()},r.showConfirm(e,t)},e.deleteImage=function(){i.remove(e.image.url).then(function(){n.addGrowl({id:"delete_success",name:e.image.filename,type:"success"}),utils.redirect(o,"/images")},function(t){window.scrollTo(0,0),e.exception=t})}}]),app.controller("InvoicesListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.exception={},e.resources={},e.resources.invoiceListUrl=r.buildUrl("/invoices")}]),app.controller("InvoicesSetCtrl",["$scope","$routeParams","$location","ApiService","ConfirmService","GrowlsService",function(e,t,o,n,i,r){if(e.invoice={},e.payment={},e.exception={},e.count={},e.count.payments=0,e.count.refunds=0,e.count.notifications=0,e.resources={},e.functions={},e.currencies=JSON.parse(localStorage.getItem("payment_currencies")),e.params={expand:"customer.payment_methods,options,payments.payment_method,items.subscription_terms,subscription",formatted:!0},e.invoice.currency=localStorage.getItem("default_payment_currency"),e.suppress_customer_notification=!1,e.data={},1==e.currencies.length&&(e.invoice.currency=e.currencies[0].code),e.itemPriceEdits={},e.itemQuantityEdits={},e.datepicker={},e.datepicker.status={},e.datepicker.options={startingDay:1,showWeeks:!1,initDate:new Date,yearRange:10},e.datepicker.status.date_due={opened:!1},e.datepicker.open=function(t,o){e.datepicker.status[o].opened=!0},null!=t.id)e.update=!0,e.add=!1,e.url=n.buildUrl("/invoices/"+t.id),e.resources.paymentListUrl=e.url+"/payments",e.resources.refundListUrl=e.url+"/refunds",e.resources.notificationListUrl=e.url+"/notifications",n.getItem(e.url,e.params).then(function(t){e.invoice=t,e.invoice.date_due&&(e.data.date_due=new Date(e.invoice.date_due)),e.successful_payment=_.findWhere(e.invoice.payments.data,{success:!0}),e.draft=e.invoice.draft},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.hasPermission=function(e,t){return utils.hasPermission(e,t)};else{e.url=n.buildUrl("/invoices"),e.invoice.items=[],e.invoice.autopay=!1,e.draft=!0,e.update=!1,e.add=!0;var s=new Date;s.setMonth(s.getMonth()+1),e.data.date_due=s}e.$watch("successful_payment.status",function(t,o){e.successful_payment&&void 0!=o&&(e.invoice.payment_status=e.successful_payment.status)}),e.functions.onCustomerSet=function(t){e.invoice.url&&(e.invoice.customer=t,e.backgroundUpdate())},e.backgroundUpdate=function(){e.invoice.autopay;return e.data.date_due&&(e.invoice.date_due=e.data.date_due),n.set(e.invoice,e.url,e.params).then(function(t){e.invoice=t,e.invoice.date_due&&(e.invoice.date_due=Date.parse(e.invoice.date_due)),e.invoice.customer&&e.invoice.customer.payment_methods&&e.invoice.customer.payment_methods.length>0&&(e.invoice.autopay=!0)},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.editItemPrice=function(t){var o={reference_price:t.reference_price,reference_currency:t.reference_currency};null==t.reference_price&&(t.reference_price=t.price),null==t.reference_currency&&(t.reference_currency=t.currency),e.itemPriceEdits[t.item_id]=o,e.itemEdits=!0},e.editItemQuantity=function(t,o){if(!e.itemQuantityEdits[t.item_id]){var n={quantity:o};e.itemQuantityEdits[t.item_id]=n,e.itemEdits=!0}},e.cancelItemsEdit=function(t){for(var o in e.itemPriceEdits)if(e.itemPriceEdits.hasOwnProperty(o)){var n=_.findWhere(t,{item_id:o});n&&(n.reference_price=e.itemPriceEdits[o].reference_price,n.reference_currency=e.itemPriceEdits[o].reference_currency)}for(var o in e.itemQuantityEdits)if(e.itemQuantityEdits.hasOwnProperty(o)){var n=_.findWhere(t,{item_id:o});n&&(n.quantity=e.itemQuantityEdits[o].quantity)}e.itemPriceEdits={},e.itemQuantityEdits={},e.itemEdits=!1},e.applyItemEdits=function(){e.exception.error=null,e.backgroundUpdate().then(function(t){e.itemPriceEdits={},e.itemQuantityEdits={},e.itemEdits=!1},function(t){window.scrollTo(0,0),e.exception.error=t})},e.removeCustomer=function(){e.invoice.customer=null,e.invoice.customer_id=null,e.invoice.url&&e.backgroundUpdate()},e.save=function(){var t=e.invoice.draft;e.invoice.draft=e.draft,e.invoice.suppress_customer_notification=e.suppress_customer_notification,e.data.date_due&&(e.invoice.date_due=e.data.date_due),n.set(e.invoice,e.url,e.params).then(function(e){r.addGrowl({id:"edit_success",name:"invoice "+e.invoice_id,type:"success",url:"#/invoices/"+e.invoice_id}),utils.redirect(o,"/invoices")},function(o){e.exception.error=o,e.invoice.draft=t,window.scrollTo(0,0)})},e.setShipping=function(t){return e.invoice.shipping_method_id=t,e.backgroundUpdate()},e.publish=function(){e.draft=!1,e.invoice.draft=!1,e.data.date_due&&(e.invoice.date_due=e.data.date_due),n.set(e.invoice,e.url,e.params).then(function(e){r.addGrowl({id:"invoice_published",type:"success"})},function(t){e.draft=!0,e.invoice.draft=!0,e.exception.error=t,window.scrollTo(0,0)})},e.send=function(){n.set(null,e.url+"/send").then(function(e){r.addGrowl({id:"invoice_sent",type:"success"})},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.delete=function(){n.remove(e.url).then(function(){r.addGrowl({id:"delete_success",name:"invoice "+e.invoice.invoice_id,type:"success"}),utils.redirect(o,"/invoices")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.confirmCancel=function(){var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/invoices")},i.showConfirm(e,t)},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},i.showConfirm(e,t)},e.downloadPdf=function(){n.getItemPdf(e.url).then(function(t){var o=new Blob([t],{type:"application/pdf"});saveAs(o,"Invoice_"+e.invoice.invoice_id+".pdf")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.getInvoiceLink=function(){n.set(null,e.url+"/links").then(function(t){e.link=t.link_url},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("LicenseRequestsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.licenseRequests={},e.nav={},e.exception={},e.parseParams=function(){e.params=o.search(),utils.stringsToBool(e.params),null==e.params.status&&(e.params.status="completed"),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadLicenseRequests=function(){r.getList(r.buildUrl("/license_requests",{expand:"order",show:"license_request_id,status,date_created,order.order_id"}),e.params).then(function(t){e.licenseRequests.licenseRequestList=t,e.licenseRequestsChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,n){e.params[t]=n,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,o.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),o.search(e.params))},e.movePage=function(t,n){"+"==t?(e.params.after_item=n,e.params.before_item=null):(e.params.after_item=null,e.params.before_item=n),e.nav.scrollTop=!0,o.search(e.params)},e.sort=function(t,n){e.params.sort_by=t,e.params.desc=n,o.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadLicenseRequests()}),e.parseParams(),e.loadLicenseRequests()}]),app.controller("LicenseRequestViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService",function(e,t,o,n,i,r,s){e.licenseRequest={},e.exception={},e.options={},e.options.raw=!0,e.options.html=!0,e.url=i.buildUrl("/license_requests/"+t.id);var a={expand:"license,license_service",debug:!0};i.getItem(e.url,a).then(function(t){e.licenseRequest=t,t.license&&(e.renderedLicenseText=t.license.label+":\n"+t.license.text,t.license.instructions&&(e.renderedLicenseText+="\n\n"+t.license.instructions),e.renderedLicenseHtml=t.license.label+"<br>"+t.license.html,t.license.instructions&&(e.renderedLicenseHtml+="<br><br>"+t.license.instructions)),e.licenseRequest.order=JSON.stringify(e.licenseRequest.order,null,4)},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.retry=function(){e.exception={},i.set(null,e.licenseRequest.url+"/retry").then(function(e){n.addGrowl({id:"license_request_resend",type:"success"})},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("LicenseServicesListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.license_services={},e.nav={},e.exception={},e.parseParams=function(){e.params=o.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="name"),null==e.params.desc&&(e.params.desc=!1)},e.loadLicenseServices=function(){r.getList(r.buildUrl("/license_services?show=license_service_id,name,type,configuration.license_count,configuration.notify_at_count,date_created"),e.params).then(function(t){e.license_services.license_serviceList=t,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,n){e.params[t]=n,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,o.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),o.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.license_services.license_serviceList.next_page_offset:e.params.offset=e.license_services.license_serviceList.previous_page_offset,e.nav.scrollTop=!0,o.search(e.params)},e.sort=function(t,n){e.params.sort_by=t,e.params.desc=n,o.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadLicenseServices()}),e.parseParams(),e.loadLicenseServices()}]),app.controller("LicenseServicesSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,o,n,i,r){e.licenses={},e.licenses.list=null,e.exception={},e.license_service={},e.license_service.type="list",e.license_service.configuration={},e.license_service.configuration.format="json",e.license_service.configuration.per_quantity=!1,e.license_service.configuration.remove_after_use=!0,e.license_service.configuration.notify_at_count=100,null!=t.id?(e.update=!0,e.add=!1,e.url=i.buildUrl("/license_services/"+t.id),i.getItem(e.url).then(function(t){e.license_service=t,"list"==e.license_service.type&&(e.licenses.list=utils.arrayToString(e.license_service.configuration.licenses),e.license_service.configuration.format="json"),"remote_url"==e.license_service.type&&(e.license_service.configuration.per_quantity=!1,e.license_service.configuration.remove_after_use=!0,e.license_service.configuration.notify_at_count=100)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0);var s=function(){e.exception.error=null};e.confirmCancel=function(){var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/license_services")},r.showConfirm(e,t)},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},r.showConfirm(e,t)},e.addLicenseService=function(){return s(),e.form.$invalid?void window.scrollTo(0,0):(null!=e.licenses.list&&"list"==e.license_service.type&&(e.license_service.configuration.licenses=utils.stringToArray(e.licenses.list)),void i.set(e.license_service,i.buildUrl("/license_services"),{show:"license_service_id,name"}).then(function(e){n.addGrowl({id:"add_success",name:e.name,type:"success",license_service_id:e.license_service_id,url:"#/license_services/"+e.license_service_id+"/edit"}),window.location="#/license_services"},function(t){e.exception.error=t,window.scrollTo(0,0)}))},e.updateLicenseService=function(){s(),e.form.$invalid||(null!=e.licenses.list&&"list"==e.license_service.type&&(e.license_service.configuration.licenses=utils.stringToArray(e.licenses.list)),i.set(e.license_service,e.url,{show:"license_service_id,name"}).then(function(e){n.addGrowl({id:"edit_success",name:e.name,type:"success",license_service_id:e.license_service_id,url:"#/license_services/"+e.license_service_id+"/edit"}),utils.redirect(o,"/license_services")},function(t){window.scrollTo(0,0),e.exception.error=t}))},e.delete=function(){i.remove(e.license_service.url).then(function(t){n.addGrowl({id:"delete_success",name:e.license_service.name,type:"success"}),utils.redirect(o,"/license_services")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("NotificationsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.exception={},e.resources={},e.resources.notificationListUrl=r.buildUrl("/notifications")}]),app.controller("NotificationsViewCtrl",["$scope","$routeParams","ApiService","GrowlsService","$sce",function(e,t,o,n,i){
e.notification={},e.exception={},e.url=o.buildUrl("/notifications/"+t.id),e.previewUrl=null,e.showResend=!1;var r={expand:"customer",hide:"data"};o.getItem(e.url,r).then(function(t){e.notification=t,e.previewUrl=i.trustAsResourceUrl("app/pages/notifications/preview/index.html?notification_id="+t.notification_id),e.email=t.customer.email},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.resend=function(t){if(!t.$invalid){var i={destination:e.email};o.set(i,e.url+"/resend",{show:"notification_id"}).then(function(t){n.addGrowl({id:"notification_resend",email:e.email,type:"success"}),e.showResend=!1},function(t){e.exception.error=t,window.scrollTo(0,0)})}}}]),app.controller("NotificationsPreviewCtrl",["$scope","$routeParams","ApiService",function(e,t,o){e.notification={},e.exception={},e.url=o.buildUrl("/notifications/"+t.id);var n={show:"body"};o.getItem(e.url,n).then(function(t){e.notification=t},function(t){e.exception.error=t,window.scrollTo(0,0)})}]),app.controller("NotificationSubscriptionsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.notificationSubscriptions={},e.nav={},e.exception={},e.parseParams=function(){e.params=o.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadNotificationSubscriptions=function(){r.getList(r.buildUrl("/notification_subscriptions"),e.params).then(function(t){e.notificationSubscriptions.notificationSubscriptionList=t,e.notificationSubscriptionsChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,n){e.params[t]=n,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,o.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),o.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.notificationSubscriptions.notificationSubscriptionList.next_page_offset:e.params.offset=e.notificationSubscriptions.notificationSubscriptionList.previous_page_offset,e.nav.scrollTop=!0,o.search(e.params)},e.sort=function(t,n){e.params.sort_by=t,e.params.desc=n,o.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadNotificationSubscriptions()}),e.parseParams(),e.loadNotificationSubscriptions()}]),app.controller("NotificationSubscriptionsSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService",function(e,t,o,n,i,r,s){if(e.notificationSubscription={},e.exception={},e.showTemplate=!1,null!=t.id){e.update=!0,e.add=!1,e.url=i.buildUrl("/notification_subscriptions/"+t.id);var a={expand:"template"};i.getItem(e.url,a).then(function(t){e.notificationSubscription=t},function(t){e.exception.error=t,window.scrollTo(0,0)})}else e.update=!1,e.add=!0;var c=function(){e.exception.error=null};e.confirmCancel=function(){var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/notification_subscriptions")},r.showConfirm(e,t)},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},r.showConfirm(e,t)},e.addNotificationSubscription=function(){return c(),e.form.$invalid?void window.scrollTo(0,0):(e.notificationSubscription.method||(e.notificationSubscription.method="email"),e.notificationSubscription.template&&e.notificationSubscription.template.template_id&&(e.notificationSubscription.template_id=e.notificationSubscription.template.template_id),void i.set(e.notificationSubscription,i.buildUrl("/notification_subscriptions"),{show:"notification_subscription_id,name"}).then(function(e){n.addGrowl({id:"add_success",name:e.notification_subscription_id,type:"success",notification_subscription_id:e.notification_subscription_id,url:"#/notification_subscriptions/"+e.notification_subscription_id+"/edit"}),window.location="#/notification_subscriptions"},function(t){e.exception.error=t,window.scrollTo(0,0)}))},e.updateNotificationSubscription=function(){return c(),e.form.$invalid?void window.scrollTo(0,0):(e.notificationSubscription.template&&e.notificationSubscription.template.template_id&&(e.notificationSubscription.template_id=e.notificationSubscription.template.template_id),void i.set(e.notificationSubscription,e.url,{show:"notification_subscription_id,name"}).then(function(e){n.addGrowl({id:"edit_success",name:e.notification_subscription_id,type:"success",notification_subscription_id:e.notification_subscription_id,url:"#/notification_subscriptions/"+e.notification_subscription_id+"/edit"}),window.location="#/notification_subscriptions"},function(t){window.scrollTo(0,0),e.exception.error=t}))},e.delete=function(){i.remove(e.notificationSubscription.url).then(function(t){n.addGrowl({id:"delete_success",name:e.notificationSubscription.notification_subscription_id,type:"success"}),utils.redirect(o,"/notification_subscriptions")},function(t){window.scrollTo(0,0),e.exception.error=t})},e.removeTemplate=function(){e.notificationSubscription.template=null,e.showTemplate=!1}}]),app.controller("OrdersListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.exception={},e.resources={},e.resources.orderListUrl=r.buildUrl("/orders")}]),app.controller("OrdersViewCtrl",["$scope","$routeParams","ApiService","ConfirmService","GrowlsService",function(e,t,o,n,i){e.order={},e.payment={},e.exception={},e.count={},e.count.shipments=0,e.resources={},e.url=o.buildUrl("/orders/"+t.id),e.resources.shipmentListUrl=e.url+"/shipments",e.resources.refundListUrl=e.url+"/refunds",e.resources.notificationListUrl=e.url+"/notifications";var r={expand:"customer,payment.response_data,payment.payment_method,payment.gateway,payment.refunds.items,items.product,items.subscription,items.download.file,items.license.license_service,shipments",hide:"items.product.images,items.license.license_service.configuration",formatted:!0};o.getItem(e.url,r).then(function(t){e.order=t},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.$watch("order.fulfilled",function(t,o){0==o&&1==t&&"pending"==e.order.payment.status&&"credit_card"==e.order.payment.payment_method.type&&(i.addGrowl({id:"payment_capture_scheduled",type:"success"}),e.order.hideCapture=!0)}),e.hasPermission=function(e,t){return utils.hasPermission(e,t)},e.downloadPdf=function(){o.getItemPdf(e.url).then(function(t){var o=new Blob([t],{type:"application/pdf"});saveAs(o,"Order_"+e.order.order_id+".pdf")},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("PaymentsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.exception={},e.resources={},e.resources.paymentListUrl=r.buildUrl("/payments")}]),app.controller("PaymentsViewCtrl",["$scope","$routeParams","ApiService","ConfirmService","GrowlsService",function(e,t,o,n,i){e.payment={},e.exception={},e.fee_currency=null,e.currencyType="transaction",e.resources={},e.prefs={},e.prefs.loadRefundDetails=!1,e.url=o.buildUrl("/payments/"+t.id),e.resources.notificationListUrl=e.url+"/notifications",e.refundListUrl=e.url+"/refunds";var r={expand:"customer,payment_method,response_data,gateway,fees,commissions,order,refunds.items"};o.getItem(e.url,r).then(function(t){e.payment=t,t.fees.data.length>0&&(e.fee_currency=t.fees.data[0].currency)},function(t){e.exception.error=t,window.scrollTo(0,0)})}]),app.controller("PaymentsAddCtrl",["$scope","$location","$routeParams","ApiService","ConfirmService","GrowlsService","GeographiesService",function(e,t,o,n,i,r,s){e.payment={payment_method:{type:"credit_card"},capture:!0},e.exception={},e.functions={},e.data={},e.currencies=JSON.parse(localStorage.getItem("payment_currencies"));var a=s.getGeographies(!1);e.countries=a.countries,e.typeahead={},e.typeahead.country={},null!=_.find(e.currencies,function(e){return"USD"==e.code})?e.payment.currency="USD":e.payment.currency=e.currencies[0].code,e.url=n.buildUrl("/payments"),e.removeCustomer=function(){delete e.payment.customer,delete e.payment.customer_id,delete e.payment.payment_method,e.payment_methods=null,e.payment.payment_method={type:"credit_card"}},e.calculateTotal=function(e){var t=e.subtotal||0,o=e.shipping||0,n=e.tax||0;return Number(t)+Number(o)+Number(n)||e.total},e.functions.onCustomerSelect=function(t){if(delete e.payment.customer_id,e.payment.payment_method={type:"credit_card",capture:e.capture},t.billing_address&&t.billing_address.country){var o=_.find(e.countries,function(e){return e.code==t.billing_address.country});e.typeahead.country=o}n.getItem(t.payment_methods).then(function(t){e.payment_methods=t,t.data.length&&(e.payment.payment_method=_.find(t.data,function(e){return 1==e.is_default}))},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.functions.setPaymentMethod=function(t,o){e.payment.payment_method={},t&&(e.payment.payment_method.payment_method_id=t),o&&(e.payment.payment_method.type=o)},e.createPayment=function(){e.exception={},e.payment.customer&&(delete e.payment.customer.username,e.payment.customer.billing_address&&(e.payment.customer.billing_address.country=e.typeahead.country.code)),e.payment.payment_method.save||(e.payment.payment_method.save=!1),n.set(e.payment,e.url,{formatted:!0}).then(function(e){r.addGrowl({id:"payment_created_success",payment_id:e.payment_id,url:"#/payments/"+e.payment_id,amount:e.formatted.total,currency:e.currency,type:"success"}),utils.redirect(t,"/payments/"+e.payment_id)},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("ProductsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.products={},e.nav={},e.exception={},e.parseParams=function(){e.params=o.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadProducts=function(){r.getList(r.buildUrl("/products?show=product_id,name,active,price,currency,deleted,date_created&sort_by="+e.params.sort_by+"&desc="+e.params.desc),e.params).then(function(t){e.products.productList=t,e.productsChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setActive=function(t){e.exception={};var o=_.where(e.products.productList.data,{checked:!0}),s=15;if(o.length>s)return void(e.exception={error:{message:"You can select a maximum of "+s+" items to bulk update."}});var a=n.when();_.each(o,function(e){a=a.then(function(){return r.set({active:t},e.url).then(function(t){e.deleted=t.deleted,e.active=t.active},function(t){i.addGrowl({id:"active_change_failure",name:e.name,type:"danger"})})})})},e.setParam=function(t,n){e.params[t]=n,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,o.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),o.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.products.productList.next_page_offset:e.params.offset=e.products.productList.previous_page_offset,e.nav.scrollTop=!0,o.search(e.params)},e.sort=function(t,n){e.params.sort_by=t,e.params.desc=n,o.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadProducts()}),e.checkProduct=function(t){t.checked?(t.checked=!1,e.productsChecked=!1,_.each(e.products.productList.data,function(t){t.checked&&(e.productsChecked=!0)})):(t.checked=!0,e.productsChecked=!0)},e.parseParams(),e.loadProducts()}]),app.controller("ProductsSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","gettextCatalog",function(e,t,o,n,i,r,s){function a(){0==e.data.offer_volume_discounts&&(e.product.volume_prices=[]),_.each(e.product.volume_prices,function(e){e.prices=utils.removeEmptyPrices(e.prices)}),e.product.volume_prices=_.reject(e.product.volume_prices,function(e){return!e.low||0==e.prices.length})}e.exception={},e.data={},e.data.offer_volume_discounts=!1,null!=t.id?(e.update=!0,e.add=!1,e.url=i.buildUrl("/products/"+t.id),i.getItem(e.url,{expand:"file,images,subscription_plan,license_service"}).then(function(t){e.product=t,null==e.product.weight&&(e.product.weight={unit:"oz"}),e.data.file=t.file,e.data.images=t.images,e.data.subscription_plan=t.subscription_plan,e.data.license_service=t.license_service,delete e.product.file,delete e.product.images,delete e.product.subscription_plan,delete e.product.license_service;for(var o=0;o<e.product.prices.length;o++)e.product.prices[o].price=utils.cleanPrice(e.product.prices[o].price);e.data.offer_volume_discounts=t.volume_prices.length>0,0==t.volume_prices.length&&e.product.volume_prices.push({low:"",prices:[{price:"",currency:""}]}),e.product_orig=angular.copy(e.product)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0,e.product={active:!1,description:"",prices:[],weight:{}},e.data.images=[],e.account_id=localStorage.getItem("account_id"),e.product.active=!1,e.product.hidden=!1,e.product.weight.unit="oz",e.product.prices.push({price:"",currency:""}),e.product.volume_prices=[],e.product.volume_prices.push({low:"",prices:[{price:"",currency:""}]})),e.currencies=JSON.parse(localStorage.getItem("payment_currencies")),e.removeFile=function(){e.product.file_id=null,e.data.file=null,e.showFile=!1},e.removeSubscriptionPlan=function(){e.product.subscription_plan_id=null,e.data.subscription_plan=null,e.showSubscriptionPlan=!1},e.removeLicenseService=function(){e.product.license_service_id=null,e.data.license_service=null,e.showLicenseService=!1};var c=function(){e.exception.error=null,e.product.prices=utils.removeEmptyPrices(e.product.prices),e.product.weight&&(null!=e.product.weight.amount&&""!=e.product.weight.amount||(e.product.weight=null)),0==e.product.prices.length&&e.product.prices.push({price:"",currency:""}),null!=e.data.file&&(e.product.file_id=e.data.file.file_id),null!=e.data.images?_.each(e.data.images,function(t){null==e.product.image_ids&&(e.product.image_ids=[]),e.product.image_ids.push(t.image_id)}):e.product.image_ids=[],null!=e.data.subscription_plan&&(e.product.subscription_plan_id=e.data.subscription_plan.subscription_plan_id),null!=e.data.license_service&&(e.product.license_service_id=e.data.license_service.license_service_id),a()};e.confirmCancel=function(){if(angular.equals(e.product,e.product_orig))utils.redirect(o,"/products");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/products")},r.showConfirm(e,t)}},e.removeVolumeDiscountRange=function(e,t){e.splice(t,1)},e.addVolumePriceRange=function(){e.product.volume_prices.push({low:"",prices:[{price:"",currency:""}]})},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},r.showConfirm(e,t)},e.addProduct=function(){c(),setTimeout(function(){if(e.form.$invalid)return e.exception={error:{message:s.getString("Please review and correct the fields highlighted below.")}},void window.scrollTo(0,0)},1),i.set(e.product,i.buildUrl("/products"),{show:"product_id,name"}).then(function(e){n.addGrowl({id:"add_success",name:e.name,type:"success",product_id:e.product_id,url:"#/products/"+e.product_id+"/edit"}),utils.redirect(o,"/products")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.updateProduct=function(){c(),setTimeout(function(){if(e.form.$invalid)return e.exception={error:{message:s.getString("Please review and correct the fields highlighted below.")}},void window.scrollTo(0,0)},1),i.set(e.product,e.url,{show:"product_id,name"}).then(function(e){n.addGrowl({id:"edit_success",name:e.name,type:"success",url:"#/products/"+e.product_id+"/edit"}),utils.redirect(o,"/products")},function(t){window.scrollTo(0,0),e.exception.error=t})},e.delete=function(){i.remove(e.url).then(function(){n.addGrowl({id:"delete_success_with_undelete",name:e.product.name,type:"success",url:"#/products/"+e.product.product_id+"/edit"}),utils.redirect(o,"/products")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.undelete=function(){i.set({deleted:!1},e.url,{show:"product_id,name"}).then(function(t){n.addGrowl({id:"undelete_success",name:e.product.name,type:"success",product_id:e.product.product_id,url:"#/products/"+t.product_id+"/edit"}),utils.redirect(o,"/products")},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("ProfileUpdateCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,o,n,i,r){e.exception={},e.url=i.buildUrl("/users/me"),i.getItem(e.url).then(function(t){e.user=t,e.user_orig=angular.copy(e.user)},function(t){e.exception.error=t,window.scrollTo(0,0)});var s=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.user,e.user_orig))utils.redirect(o,"/");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/")},r.showConfirm(e,t)}},e.updateProfile=function(t){if(s(),e.user.password||e.user.password2){if(e.user.password!=e.user.password2)return void t.password2.$setValidity("match",!1);t.password2.$setValidity("match",!0)}else t.password2.$setValidity("match",!0);e.form.$invalid||(utils.isNullOrEmpty(e.user.password)&&(delete e.user.password,delete e.user.password2),i.set(e.user,e.url).then(function(e){n.addGrowl({id:"edit_success",name:"your profile",type:"success",url:"#/profile"}),utils.redirect(o,"/")},function(t){window.scrollTo(0,0),e.exception.error=t}))}}]),app.controller("CouponSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService","gettextCatalog",function(e,t,o,n,i,r,s,a){e.promotion={apply_to_recurring:!1,active:!1},e.promotion.config={max_uses_per_customer:null,discount_amount:[{price:null,currency:null}],apply_to_recurring_count:null},e.exception={},e.options={},e.options.discount_type="percentage",e.options.coupon_code_type="single",e.data={},e.data.generate_number=100,e.datepicker={},e.datepicker.status={},e.datepicker.options={startingDay:1,showWeeks:!1,initDate:new Date,yearRange:10},e.datepicker.status.expires={opened:!1},e.datepicker.open=function(t,o){e.datepicker.status[o].opened=!0},null!=t.id?(e.update=!0,e.add=!1,e.url=i.buildUrl("/promotions/"+t.id),i.getItem(e.url,{expand:"config.product_ids"}).then(function(t){e.promotion=t,e.options.discount_type=t.config.discount_percent?"percentage":"amounts",e.options.coupon_code_type=t.config.code?"single":"unique",t.expires&&(e.datepicker.expires=new Date(t.expires)),e.promotion.config.discount_amount=e.promotion.config.discount_amount||[],e.promotion.config.discount_percent&&(e.promotion.config._discount_percent=utils.decimalToPercent(e.promotion.config.discount_percent)),"product"===e.promotion.config.type&&e.promotion.config.product_ids&&(e.promotion.config.product_ids=_.map(e.promotion.config.product_ids,function(e){return{product_id:e}}))},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0),e.currencies=JSON.parse(localStorage.getItem("payment_currencies"));var c=function(){e.exception.error=null,"product"!=e.promotion.config.type&&(e.promotion.apply_to_recurring=!1,e.promotion.apply_to_recurring_count=null)};e.confirmCancel=function(){var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/promotions")},r.showConfirm(e,t)},e.addPromotion=function(){return c(),e.form.$invalid?(e.exception={error:{message:a.getString("Please review and correct the fields highlighted below.")}},void window.scrollTo(0,0)):(e.promotion.expires=e.datepicker.expires,"percentage"==e.options.discount_type?(e.promotion.config.discount_percent=utils.percentToDecimal(e.promotion.config._discount_percent),e.promotion.config.discount_amount=void 0):"amounts"==e.options.discount_type&&(e.promotion.config.discount_percent=void 0),"single"==e.options.coupon_code_type?(e.promotion.config.generator_prefix=void 0,e.promotion.config.generator_secret_key=void 0):"unique"==e.options.coupon_code_type&&(e.promotion.config.code=void 0),"product"===e.promotion.config.type&&e.promotion.config.product_ids&&e.promotion.config.product_ids.length&&(e.promotion.config.product_ids=_.pluck(e.promotion.config.product_ids,"product_id")),e.promotion.type="coupon",void i.set(e.promotion,i.buildUrl("/promotions"),{show:"promotion_id,name"}).then(function(e){n.addGrowl({id:"add_success",name:e.name,type:"success",promotion_id:e.promotion_id,url:"#/promotions/coupon/"+e.promotion_id+"/edit"}),window.location="#/promotions"},function(t){e.exception.error=t,window.scrollTo(0,0),angular.isArray(e.promotion.config.product_ids)&&e.promotion.config.product_ids.length>0&&(e.promotion.config.product_ids=_.map(e.promotion.config.product_ids,function(e){return{product_id:e}}))}))},e.updatePromotion=function(){return c(),e.form.$invalid?(e.exception={error:{message:a.getString("Please review and correct the fields highlighted below.")}},void window.scrollTo(0,0)):(e.promotion.expires=e.datepicker.expires,"percentage"==e.options.discount_type?(e.promotion.config.discount_percent=utils.percentToDecimal(e.promotion.config._discount_percent),e.promotion.config.discount_amount=void 0):"amounts"==e.options.discount_type&&(e.promotion.config.discount_percent=void 0),"single"==e.options.coupon_code_type?(e.promotion.config.generator_prefix=void 0,e.promotion.config.generator_secret_key=void 0):"unique"==e.options.coupon_code_type&&(e.promotion.config.code=void 0),"product"===e.promotion.config.type&&e.promotion.config.product_ids&&e.promotion.config.product_ids.length&&(e.promotion.config.product_ids=_.pluck(e.promotion.config.product_ids,"product_id")),void i.set(e.promotion,e.url,{show:"promotion_id,name"}).then(function(e){n.addGrowl({id:"edit_success",name:e.name,type:"success",promotion_id:e.promotion_id,url:"#/promotions/coupon/"+e.promotion_id+"/edit"}),window.location="#/promotions"},function(t){window.scrollTo(0,0),e.exception.error=t}))},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},r.showConfirm(e,t)},e.delete=function(){i.remove(e.promotion.url).then(function(t){n.addGrowl({id:"delete_success",name:e.promotion.name,type:"success"}),utils.redirect(o,"/promotions")},function(t){window.scrollTo(0,0),e.exception.error=t})},e.generateCode=function(t){var o="ABCDEFGHJKMNPQRSTUVWXYZ23456789",n=utils.getRandomString(o,12),i=n.match(/.{1,4}/g);n=i.join("-"),e.promotion.config.code=n},e.generateCodes=function(t,o,n){for(var i="ABCDEFGHJKMNPQRSTUVWXYZ23456789",r=[],s=n;s>0;--s){var a=new jsSHA("SHA-256","TEXT");a.setHMACKey(o,"TEXT");var c=t.toUpperCase()+"-"+utils.getRandomString(i,12);a.update(c);var l=a.getHMAC("HEX");r.push(c+"-"+l.substring(0,7).toUpperCase())}e.data.codes=r.join("\n")}}]),app.controller("CrossSellSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService","gettextCatalog",function(e,t,o,n,i,r,s,a){function c(){return e.form.$invalid?(e.exception={error:{message:a.getString("Please review and correct the fields highlighted below.")}},window.scrollTo(0,0),!1):e.options.product&&e.options.product.length?"selected"!=e.options.qualifies||e.options.offer_with_products&&e.options.offer_with_products.length?void 0:(e.exception={error:{message:a.getString("You must select the products that will trigger this cross sell, or select 'Any product'.")}},window.scrollTo(0,0),!1):(e.exception={error:{message:a.getString("You must select the product to offer as a cross sell.")}},window.scrollTo(0,0),!1)}e.promotion={apply_to_recurring:!1,active:!1},e.promotion.config={discount_amount:[{price:null,currency:null}],apply_to_recurring_count:null,weight:1},e.exception={},e.options={},e.datepicker={},e.datepicker.status={},e.datepicker.options={startingDay:1,showWeeks:!1,initDate:new Date,yearRange:10},e.datepicker.status.expires={opened:!1},e.datepicker.open=function(t,o){e.datepicker.status[o].opened=!0},null!=t.id?(e.update=!0,e.add=!1,e.url=i.buildUrl("/promotions/"+t.id),i.getItem(e.url,{expand:"config.product_ids"}).then(function(t){e.promotion=t,t.config.discount_percent||t.config.discount_amount?e.options.discount_type=t.config.discount_percent?"percentage":"amounts":e.options.discount_type="none",t.expires&&(e.datepicker.expires=new Date(t.expires)),e.promotion.config.discount_amount=e.promotion.config.discount_amount||[],e.promotion.config.discount_percent&&(e.promotion.config._discount_percent=utils.decimalToPercent(e.promotion.config.discount_percent)),e.options.offer_with_products=_.map(e.promotion.config.offer_with_product_ids,function(e){return{product_id:e}}),e.promotion.config.offer_with_product_ids.indexOf("*")>-1?(e.options.offer_with_products=null,e.options.qualifies="any"):e.options.qualifies="selected",i.getItem(i.buildUrl("/products/"+t.config.product_id),{show:"name,product_id"}).then(function(t){e.options.product=[t]},function(t){e.exception.error=t,window.scrollTo(0,0)})},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0,e.options.discount_type="percentage",e.options.qualifies="selected"),e.currencies=JSON.parse(localStorage.getItem("payment_currencies"));var l=function(){e.exception.error=null,"percentage"==e.options.discount_type&&delete e.promotion.config.discount_amount,"amounts"==e.options.discount_type&&delete e.promotion.config.discount_percent,"none"==e.options.discount_type&&(e.promotion.config.discount_amount=null,e.promotion.config.discount_percent=null)};e.confirmCancel=function(){var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/promotions")},r.showConfirm(e,t)},e.addPromotion=function(){l(),0!=c()&&(e.promotion.expires=e.datepicker.expires,"percentage"==e.options.discount_type?(e.promotion.config.discount_percent=utils.percentToDecimal(e.promotion.config._discount_percent),e.promotion.config.discount_amount=void 0):"amounts"==e.options.discount_type&&(e.promotion.config.discount_percent=void 0),e.promotion.config.product_id=e.options.product[0].product_id,"selected"==e.options.qualifies&&(e.promotion.config.offer_with_product_ids=_.pluck(e.options.offer_with_products,"product_id"),e.promotion.config.offer_with_product_ids=_.reject(e.promotion.config.offer_with_product_ids,function(t){return t==e.promotion.config.product_id})),"any"==e.options.qualifies&&(e.promotion.config.offer_with_product_ids=["*"]),e.promotion.type="cross_sell",i.set(e.promotion,i.buildUrl("/promotions"),{show:"promotion_id,name"}).then(function(e){n.addGrowl({id:"add_success",name:e.name,type:"success",promotion_id:e.promotion_id,url:"#/promotions/cross-sell/"+e.promotion_id+"/edit"}),window.location="#/promotions"},function(t){e.exception.error=t,window.scrollTo(0,0)}))},e.updatePromotion=function(){return l(),e.form.$invalid?(e.exception={error:{message:a.getString("Please review and correct the fields highlighted below.")}},void window.scrollTo(0,0)):void(0!=c()&&(e.promotion.expires=e.datepicker.expires,"percentage"==e.options.discount_type?(e.promotion.config.discount_percent=utils.percentToDecimal(e.promotion.config._discount_percent),e.promotion.config.discount_amount=void 0):"amounts"==e.options.discount_type&&(e.promotion.config.discount_percent=void 0),"selected"===e.options.qualifies&&(e.promotion.config.offer_with_product_ids=_.pluck(e.options.offer_with_products,"product_id"),e.promotion.config.offer_with_product_ids=_.reject(e.promotion.config.offer_with_product_ids,function(t){return t==e.promotion.config.product_id})),"any"==e.options.qualifies&&(e.promotion.config.offer_with_product_ids=["*"]),i.set(e.promotion,e.url,{show:"promotion_id,name"}).then(function(e){n.addGrowl({id:"edit_success",name:e.name,type:"success",promotion_id:e.promotion_id,url:"#/promotions/cross-sell/"+e.promotion_id+"/edit"}),window.location="#/promotions"},function(t){window.scrollTo(0,0),e.exception.error=t})))},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},r.showConfirm(e,t)},e.delete=function(){i.remove(e.promotion.url).then(function(t){n.addGrowl({id:"delete_success",name:e.promotion.name,type:"success"}),utils.redirect(o,"/promotions")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("PromotionsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.promotions={},e.nav={},e.exception={},e.parseParams=function(){e.params=o.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadPromotions=function(){r.getList(r.buildUrl("/promotions"),e.params).then(function(t){e.promotions.promotionList=t,e.promotionsChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,n){e.params[t]=n,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,o.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),o.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.promotions.promotionList.next_page_offset:e.params.offset=e.promotions.promotionList.previous_page_offset,e.nav.scrollTop=!0,o.search(e.params)},e.sort=function(t,n){e.params.sort_by=t,e.params.desc=n,o.search(e.params)},e.getUrl=function(e){return"#/promotions/"+utils.replaceAll(e.type,"_","-")+"/"+e.promotion_id+"/edit"},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadPromotions()}),e.parseParams(),e.loadPromotions()}]),app.controller("RefundsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.exception={},e.resources={},e.resources.refundListUrl=r.buildUrl("/refunds")}]),app.controller("RefundsViewCtrl",["$scope","$routeParams","ApiService","ConfirmService","GrowlsService",function(e,t,o,n,i){e.refund={},e.exception={},e.fee_currency=null,e.items=[],e.currencyType="transaction",e.resources={},e.prefs={},e.prefs.loadRefundDetails=!1,e.url=o.buildUrl("/refunds/"+t.id),e.resources.notificationListUrl=e.url+"/notifications";var r={expand:"payment,customer,payment_method,gateway,fees,commissions,order,refunds.items"};o.getItem(e.url,r).then(function(t){e.refund=t,t.fees.data.length>0&&(e.fee_currency=t.fees.data[0].currency),null!=t.order&&(e.items=t.order.items)},function(t){e.exception.error=t,window.scrollTo(0,0)})}]),app.controller("ReportCommissionsController",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","TimezonesService",function(e,t,o,n,i,r,s){e.exception={},e.timezones=s.getTimezones(),e.url=i.buildUrl("/reports/commissions"),e.options={},e.options.category=null,e.options.desc="true",e.options.sort_by="total",e.options.timezone="UTC",e.options.dates="this_month",e.options.search_by="date",e.options.accounting_id=null,e.options.currencies=["Actual",localStorage.getItem("reporting_currency_primary"),localStorage.getItem("reporting_currency_secondary")],e.options.currency=e.options.currencies[0],e.nav={},e.datepicker={},e.datepicker.status={},e.datepicker.options={startingDay:1,showWeeks:!1,initDate:new Date,yearRange:10},e.datepicker.status.date_start={opened:!1},e.datepicker.status.date_end={opened:!1},e.datepicker.open=function(t,o){e.datepicker.status[o].opened=!0},e.run=function(t){e.exception={},t&&(e.options.offset="0");var o=e.options.dates;switch(date_end=e.options.dates,e.options.dates){case"last_30":o=-29,date_end=0;break;case"last_7":o=-6,date_end=0;break;case"custom":e.datepicker.date_end||(e.datepicker.date_end=new Date),e.datepicker.date_start||(e.datepicker.date_start=e.datepicker.date_end),o=e.datepicker.date_start.toISOString().substring(0,10),date_end=e.datepicker.date_end.toISOString().substring(0,10)}"doc"==e.options.search_by&&(o=null,date_end=null);var n=e.options.accounting_id;"date"==e.options.search_by&&(n=null);var r=e.options.currency;"Actual"==r&&(r=null),i.getItem(e.url,{category:e.options.category,currency:r,accounting_id:n,sort_by:e.options.sort_by,timezone:e.options.timezone,
desc:e.options.desc,date_start:o,date_end:date_end,offset:e.options.offset,formatted:!0},!0,9e4).then(function(t){e.report=t,e.data={},_.each(t.data,function(t){e.data[t.currency]={},e.data[t.currency].data=[],e.data[t.currency].labels=[],e.data[t.currency].values=[],_.each(t.breakdowns,function(o){e.data[t.currency].data.push(o.total),e.data[t.currency].labels.push(o.type.split("_").join(" ")),e.data[t.currency].values.push(o.formatted.total)})}),1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.getChartData=function(e){var t={},o=[],n=[],i=[];return _.each(e.breakdowns,function(e){o.push(e.total),n.push(e.name),i.push(e.formatted.total)}),t.data=o,t.labels=n,t.values=i,t},e.downloadCsv=function(t,o){var n="all";if(e.options.category&&(n=e.options.category),"doc"==e.options.search_by)var i="commissionss_"+n+"_"+o+"_"+e.options.accounting_id;e.options.accounting_id;if("date"==e.options.search_by)var i="commissionss_"+n+"_"+o+"_"+utils.replaceAll(e.report.date_start,"-","").substring(0,8)+"-"+utils.replaceAll(e.report.date_end,"-","").substring(0,8)+"_"+utils.replaceAll(e.report.timezone," ","_").replace("/","_");_.each(t,function(e){e.currency=o}),utils.jsonToCsvDownload(t,i)},e.run()}]),app.controller("ReportFeesController",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","TimezonesService",function(e,t,o,n,i,r,s){e.exception={},e.timezones=s.getTimezones(),e.url=i.buildUrl("/reports/fees"),e.options={},e.options.category=null,e.options.desc="true",e.options.sort_by="total",e.options.timezone="UTC",e.options.dates="this_month",e.options.search_by="date",e.options.accounting_id=null,e.options.currencies=["Actual",localStorage.getItem("reporting_currency_primary"),localStorage.getItem("reporting_currency_secondary")],e.options.currency=e.options.currencies[0],e.nav={},e.datepicker={},e.datepicker.status={},e.datepicker.options={startingDay:1,showWeeks:!1,initDate:new Date,yearRange:10},e.datepicker.status.date_start={opened:!1},e.datepicker.status.date_end={opened:!1},e.datepicker.open=function(t,o){e.datepicker.status[o].opened=!0},e.run=function(t){e.exception={},t&&(e.options.offset="0");var o=e.options.dates;switch(date_end=e.options.dates,e.options.dates){case"last_30":o=-29,date_end=0;break;case"last_7":o=-6,date_end=0;break;case"custom":e.datepicker.date_end||(e.datepicker.date_end=new Date),e.datepicker.date_start||(e.datepicker.date_start=e.datepicker.date_end),o=e.datepicker.date_start.toISOString().substring(0,10),date_end=e.datepicker.date_end.toISOString().substring(0,10)}"doc"==e.options.search_by&&(o=null,date_end=null);var n=e.options.accounting_id;"date"==e.options.search_by&&(n=null);var r=e.options.currency;"Actual"==r&&(r=null),i.getItem(e.url,{category:e.options.category,currency:r,accounting_id:n,sort_by:e.options.sort_by,timezone:e.options.timezone,desc:e.options.desc,date_start:o,date_end:date_end,offset:e.options.offset,formatted:!0},!0,9e4).then(function(t){e.report=t,e.data={},_.each(t.data,function(t){e.data[t.currency]={},e.data[t.currency].data=[],e.data[t.currency].labels=[],e.data[t.currency].values=[],_.each(t.breakdowns,function(o){e.data[t.currency].data.push(o.total),e.data[t.currency].labels.push(o.type.split("_").join(" ")),e.data[t.currency].values.push(o.formatted.total)})}),1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.getChartData=function(e){var t={},o=[],n=[],i=[];return _.each(e.breakdowns,function(e){o.push(e.total),n.push(e.name),i.push(e.formatted.total)}),t.data=o,t.labels=n,t.values=i,t},e.downloadCsv=function(t,o){var n="all";if(e.options.category&&(n=e.options.category),"doc"==e.options.search_by)var i="fees_"+n+"_"+o+"_"+e.options.accounting_id;e.options.accounting_id;if("date"==e.options.search_by)var i="fees_"+n+"_"+o+"_"+utils.replaceAll(e.report.date_start,"-","").substring(0,8)+"-"+utils.replaceAll(e.report.date_end,"-","").substring(0,8)+"_"+utils.replaceAll(e.report.timezone," ","_").replace("/","_");_.each(t,function(e){e.currency=o}),utils.jsonToCsvDownload(t,i)},e.run()}]),app.controller("ReportItemsController",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","TimezonesService",function(e,t,o,n,i,r,s){e.exception={},e.timezones=s.getTimezones(),e.url=i.buildUrl("/reports/items"),e.options={},e.options.type="combined",e.options.desc="true",e.options.sort_by="subtotal",e.options.timezone="UTC",e.options.dates="yesterday",e.options.offset="0",e.options.labels=[],e.options.values=[],e.options.currencies=[],e.options.currencies.push(localStorage.getItem("reporting_currency_primary")),e.options.currencies.push(localStorage.getItem("reporting_currency_secondary")),e.options.currency=e.options.currencies[0],e.nav={},e.datepicker={},e.datepicker.status={},e.datepicker.options={startingDay:1,showWeeks:!1,initDate:new Date,yearRange:10},e.datepicker.status.date_start={opened:!1},e.datepicker.status.date_end={opened:!1},e.datepicker.open=function(t,o){e.datepicker.status[o].opened=!0},e.run=function(t){e.exception={},t&&(e.options.offset="0");var o=e.options.dates;switch(date_end=e.options.dates,e.options.dates){case"last_30":o=-29,date_end=0;break;case"last_7":o=-6,date_end=0;break;case"custom":e.datepicker.date_end||(e.datepicker.date_end=new Date),e.datepicker.date_start||(e.datepicker.date_start=e.datepicker.date_end),o=e.datepicker.date_start.toISOString().substring(0,10),date_end=e.datepicker.date_end.toISOString().substring(0,10)}i.getItem(e.url,{type:e.options.type,sort_by:e.options.sort_by,timezone:e.options.timezone,desc:e.options.desc,date_start:o,date_end:date_end,currency:e.options.currency,offset:e.options.offset,formatted:!0},!0,9e4).then(function(t){e.report=t,e.data=[],e.options.labels=[],e.options.values=[],_.each(t.data,function(t){e.data.push(t.total),e.options.labels.push(t.name),e.options.values.push(t.formatted.total)}),1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.movePage=function(t){"+"==t?e.options.offset=e.report.next_page_offset:e.options.offset=e.report.previous_page_offset,e.nav.scrollTop=!0,e.run()},e.downloadCsv=function(t){var o="sales_by_product_"+e.report.type+"_"+utils.replaceAll(e.report.date_start,"-","").substring(0,8)+"-"+utils.replaceAll(e.report.date_end,"-","").substring(0,8)+"_"+utils.replaceAll(e.report.timezone," ","_").replace("/","_");utils.jsonToCsvDownload(t,o)},e.run()}]),app.controller("ReportSalesCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","TimezonesService",function(e,t,o,n,i,r,s){e.exception={},e.timezones=s.getTimezones(),e.url=i.buildUrl("/reports/sales"),e.options={},e.options.type="combined",e.options.segment="all",e.options.group_by="day",e.options.timezone="UTC",e.options.dates="last_30",e.options.labels=[],e.options.values=[],e.options.currencies=[],e.options.currencies.push(localStorage.getItem("reporting_currency_primary")),e.options.currencies.push(localStorage.getItem("reporting_currency_secondary")),e.options.currency=e.options.currencies[0],e.datepicker={},e.datepicker.status={},e.datepicker.options={startingDay:1,showWeeks:!1,initDate:new Date,yearRange:10},e.datepicker.status.date_start={opened:!1},e.datepicker.status.date_end={opened:!1},e.datepicker.open=function(t,o){e.datepicker.status[o].opened=!0},e.run=function(){e.exception={};var t=e.options.dates;switch(date_end=e.options.dates,e.options.dates){case"last_30":t=-29,date_end=0;break;case"last_7":t=-6,date_end=0;break;case"custom":e.datepicker.date_end||(e.datepicker.date_end=new Date),e.datepicker.date_start||(e.datepicker.date_start=e.datepicker.date_end),t=e.datepicker.date_start.toISOString().substring(0,10),date_end=e.datepicker.date_end.toISOString().substring(0,10)}i.getItem(e.url,{type:e.options.type,group_by:e.options.group_by,timezone:e.options.timezone,segment:e.options.segment,date_start:t,date_end:date_end,currency:e.options.currency,formatted:!0}).then(function(t){e.report=t,e.data=[],e.options.labels=[],e.options.values=[],_.each(t.data,function(t){e.data.push(t.total-t.tax),e.options.labels.push(t.total),e.options.values.push(t.formatted.total)})},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.downloadCsv=function(t){var o="sales_"+e.report.type+"_"+e.report.segment+"_"+utils.replaceAll(e.report.date_start,"-","").substring(0,8)+"-"+utils.replaceAll(e.report.date_end,"-","").substring(0,8)+"_"+utils.replaceAll(e.report.timezone," ","_").replace("/","_");utils.jsonToCsvDownload(t,o)},e.run()}]),app.controller("AnalyticsSettingsCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,o,n,i,r){e.exception={},e.url=i.buildUrl("/settings/analytics"),i.getItem(e.url).then(function(t){e.settings=t,e.settings_orig=angular.copy(e.settings)},function(t){e.exception.error=t,window.scrollTo(0,0)});var s=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.settings,e.settings_orig))utils.redirect(o,"/");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/")},r.showConfirm(e,t)}},e.updateSettings=function(t){s(),e.form.$invalid||(null!=e.refund_reasons&&(e.settings.refund_reasons=utils.stringToArray(e.refund_reasons)),null!=e.chargeback_reasons&&(e.settings.chargeback_reasons=utils.stringToArray(e.chargeback_reasons)),i.set(e.settings,e.url).then(function(e){n.addGrowl({id:"edit_success",name:"Analytics Settings",type:"success",url:"#/settings/analytics"})},function(t){window.scrollTo(0,0),e.exception.error=t}))}}]),app.controller("FulfillmentSettingsCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,o,n,i,r){e.exception={},e.url=i.buildUrl("/settings/fulfillment"),i.getItem(e.url).then(function(t){e.settings=t,e.settings_orig=angular.copy(e.settings)},function(t){e.exception.error=t,window.scrollTo(0,0)});var s=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.settings,e.settings_orig))utils.redirect(o,"/");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/")},r.showConfirm(e,t)}},e.updateSettings=function(t){s(),e.form.$invalid||i.set(e.settings,e.url).then(function(e){n.addGrowl({id:"edit_success",name:"Fulfillment Settings",type:"success",url:"#/settings/fulfillment"})},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("GeneralSettingsCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","CurrenciesService","TimezonesService","HelperService",function(e,t,o,n,i,r,s,a,c){e.exception={},e.url=i.buildUrl("/settings/general"),e.currencies=s.getCurrencies(),e.timezones=a.getTimezones(),e.helperService=c,i.getItem(e.url).then(function(t){e.settings=t,e.typeahead={},e.typeahead.reporting_currency_primary=_.find(e.currencies,{code:t.reporting_currency_primary}),e.typeahead.reporting_currency_secondary=_.find(e.currencies,{code:t.reporting_currency_secondary}),e.app_hosts=utils.arrayToString(t.app_hosts),e.cors_allowed_origins=utils.arrayToString(t.cors_allowed_origins),e.oauth_redirect_uris=utils.arrayToString(t.oauth_redirect_uris),e.notification_from_addresses=utils.arrayToString(t.notification_from_addresses),e.settings_orig=angular.copy(e.settings)},function(t){e.exception.error=t,window.scrollTo(0,0)});var l=function(){e.exception.error=null};e.onCurrencySelect=function(t,o,n,i){e.settings["reporting_currency_"+i]=o.code},e.confirmCancel=function(){if(angular.equals(e.settings,e.settings_orig))utils.redirect(o,"/");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/")},r.showConfirm(e,t)}},e.updateSettings=function(){return l(),e.form.$invalid?void window.scrollTo(0,0):(null!=e.app_hosts&&(e.settings.app_hosts=utils.stringToArray(e.app_hosts)),null!=e.cors_allowed_origins&&(e.settings.cors_allowed_origins=utils.stringToArray(e.cors_allowed_origins)),null!=e.oauth_redirect_uris&&(e.settings.oauth_redirect_uris=utils.stringToArray(e.oauth_redirect_uris)),null!=e.notification_from_addresses&&(e.settings.notification_from_addresses=utils.stringToArray(e.notification_from_addresses)),void i.set(e.settings,e.url).then(function(e){n.addGrowl({id:"edit_success",name:"General Settings",type:"success",url:"#/settings/general"})},function(t){window.scrollTo(0,0),e.exception.error=t}))}}]),app.controller("PaymentSettingsCtrl",["$scope","$routeParams","$location","$timeout","GrowlsService","ApiService","ConfirmService","CurrenciesService","HelperService",function(e,t,o,n,i,r,s,a,c){function l(e,t){return _.each(e,function(e){t[e]=!0}),t}function u(e){var t=[];for(var o in e)e.hasOwnProperty(o)&&1==e[o]&&t.push(o);return t}e.exception={},e.url=r.buildUrl("/settings/payment"),e.currencies=a.getCurrencies(),e.required_fields={},e.optional_fields={},e.helperService=c,r.getItem(e.url).then(function(t){e.settings=t,e.typeahead={},e.typeahead.default_payment_currency=_.find(e.currencies,{code:t.default_payment_currency}),e.refund_reasons=utils.arrayToString(t.refund_reasons),e.chargeback_reasons=utils.arrayToString(t.chargeback_reasons),e.blocked_countries=utils.arrayToString(t.blocked_countries),e.required_fields=l(t.customer_required_fields,e.required_fields),e.optional_fields=l(t.customer_optional_fields,e.optional_fields),e.settings_orig=angular.copy(e.settings)},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.onCurrencySelect=function(t,o,n,i){e.settings[i]=o.code},e.toggleCustomerRequiredField=function(t){e.required_fields[t]&&(e.optional_fields[t]=!1)},e.toggleCustomerOptionalField=function(t){e.optional_fields[t]&&(e.required_fields[t]=!1)};var p=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.settings,e.settings_orig))utils.redirect(o,"/");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/")},s.showConfirm(e,t)}},e.updateSettings=function(t){p(),e.form.$invalid||(null!=e.refund_reasons&&(e.settings.refund_reasons=utils.stringToArray(e.refund_reasons)),null!=e.chargeback_reasons&&(e.settings.chargeback_reasons=utils.stringToArray(e.chargeback_reasons)),null!=e.blocked_countries&&(e.settings.blocked_countries=utils.stringToArray(e.blocked_countries)),e.settings.customer_required_fields=u(e.required_fields),e.settings.customer_optional_fields=u(e.optional_fields),r.set(e.settings,e.url).then(function(e){i.addGrowl({id:"edit_success",name:"Payment Settings",type:"success",url:"#/settings/payment"})},function(t){window.scrollTo(0,0),e.exception.error=t}))}}]),app.controller("PricingSettingsCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","GeographiesService",function(e,t,o,n,i,r,s){e.exception={},e.url=i.buildUrl("/settings/pricing"),e.currencies=JSON.parse(localStorage.getItem("payment_currencies")),e.currencies.unshift({code:null,name:"All other currencies (default)"}),e.methods=[{name:"Highest",value:"highest"},{name:"Closest",value:"closest"},{name:"Lowest",value:"lowest"}],i.getItem(e.url).then(function(t){_.each(t.currency_rounding_rules,function(e){e._positions=_.map(e.positions,function(e){return{value:e}})}),_.each(t.currency_markup_rules,function(e){e.markup_percentage_value=utils.decimalToPercent(e.markup_percentage)}),e.settings=t},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.addNew=function(t,o){"currency_rounding_rules"==t&&(o.method="highest",o.minimum="3",o._positions.push({value:0}),o._positions.push({value:.5}),o._positions.push({value:.95}),o._positions.push({value:.99})),e.settings[t].unshift(o)},e.confirmDelete=function(t,o,n){var i={id:"delete"};i.onConfirm=function(){e.deleteRule(t,o,n)},r.showConfirm(e,i)},e.deleteRule=function(t,o,n){e.settings[t].splice(n,1)},e.addRoundingPosition=function(e){e._positions.push({})},e.removeRoundingPosition=function(e,t){e._positions.splice(t,1)},e.confirmCancel=function(){var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/")},r.showConfirm(e,t)},e.updateSettings=function(t){if(e.exception.error=null,e.form.$invalid)return e.exception={error:{message:"Please review the fields highlighted below."}},void window.scrollTo(0,0);var o=angular.copy(e.settings);_.each(o.currency_rounding_rules,function(e){e.positions=_.map(e._positions,function(e){return e.value}),delete e._positions}),_.each(o.currency_markup_rules,function(e){e.markup_percentage=e.markup_percentage_value/100}),i.set(o,e.url).then(function(e){n.addGrowl({id:"edit_success",name:"Pricing Settings",type:"success",url:"#/settings/pricing"})},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("SubscriptionsSettingsCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,o,n,i,r){e.exception={},e.url=i.buildUrl("/settings/subscription"),i.getItem(e.url).then(function(t){e.settings=t,e.settings_orig=angular.copy(e.settings),e.cancellation_reasons=utils.arrayToString(t.cancellation_reasons)},function(t){e.exception.error=t,window.scrollTo(0,0)});var s=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.settings,e.settings_orig))utils.redirect(o,"/");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/")},r.showConfirm(e,t)}},e.updateSettings=function(t){s(),e.form.$invalid||(null!=e.cancellation_reasons&&(e.settings.cancellation_reasons=utils.stringToArray(e.cancellation_reasons)),i.set(e.settings,e.url).then(function(e){n.addGrowl({id:"edit_success",name:"Subscription Settings",type:"success",url:"#/settings/subscriptions"})},function(t){window.scrollTo(0,0),e.exception.error=t}))}}]),app.controller("TaxSettingsCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","GeographiesService",function(e,t,o,n,i,r,s){e.exception={},e.geo=s,e.url=i.buildUrl("/settings/tax"),e.countries=e.geo.getGeographies().countries,e.countries.push({code:"EU",name:"European Union"}),e.countries=_.sortBy(e.countries,"name"),e.ruleCountries=angular.copy(e.countries),e.countries.unshift({code:"*",name:"All countries"}),e.models={},e.models.tax_inclusive_countries=[],e.models.gross_discount_countries=[],e.typeahead={},i.getItem(e.url).then(function(t){e.settings=t,_.each(t.tax_inclusive_countries,function(t){var o=_.findWhere(e.countries,{code:t});null!=o&&e.models.tax_inclusive_countries.push(o)}),_.each(t.gross_discount_countries,function(t){var o=_.findWhere(e.countries,{code:t});null!=o&&e.models.gross_discount_countries.push(o)}),_.each(e.settings.rules,function(t){t.country=_.find(e.countries,{code:t.country}),t.manual_rate=!1,null!=t.rate&&(t.manual_rate=!0),t.state_prov&&(t.state_prov=t.state_prov.toUpperCase())})},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.addNewRule=function(){e.settings.rules.unshift({manual_rate:!0})},e.confirmDelete=function(t,o){var n={id:"delete"};n.onConfirm=function(){e.deleteRule(t,o)},r.showConfirm(e,n)},e.deleteRule=function(t,o){e.settings.rules.splice(o,1)},e.onCountrySelect=function(t,o,n,i){_.findWhere(e.models[i],{code:o.code})||e.models[i].push(o),e.typeahead[i]=null},e.removeCountry=function(t,o){e.models[o]=_.reject(e.models[o],function(e){return e.code==t.code}),"tax_inclusive_countries"==o&&e.removeCountry(t,"gross_discount_countries")},e.onRuleCountrySelect=function(t,o,n,i,r){"US"==o.code||"CA"==o.code||"EU"==o.code||e.geo.isEuCountry(o.code)?r.manual_rate=!1:r.manual_rate=!0},e.confirmCancel=function(){var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/")},r.showConfirm(e,t)},e.updateSettings=function(t){if(e.exception.error=null,!e.form.$invalid){var o=angular.copy(e.settings);_.each(o.rules,function(e){e.manual_rate||(e.rate=null),delete e.manual_rate,e.country=e.country.code}),o.tax_inclusive_countries=_.pluck(e.models.tax_inclusive_countries,"code"),o.gross_discount_countries=_.pluck(e.models.gross_discount_countries,"code"),i.set(o,e.url).then(function(e){n.addGrowl({id:"edit_success",name:"Tax Settings",type:"success",url:"#/settings/tax"})},function(t){window.scrollTo(0,0),e.exception.error=t})}}}]),app.controller("TechnicalSettingsCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","CurrenciesService","TimezonesService","HelperService",function(e,t,o,n,i,r,s,a,c){e.exception={},e.url=i.buildUrl("/settings/technical"),e.currencies=s.getCurrencies(),e.timezones=a.getTimezones(),e.helperService=c,i.getItem(e.url).then(function(t){e.settings=t,e.typeahead={},e.typeahead.reporting_currency_primary=_.find(e.currencies,{code:t.reporting_currency_primary}),e.typeahead.reporting_currency_secondary=_.find(e.currencies,{code:t.reporting_currency_secondary}),e.app_hosts=utils.arrayToString(t.app_hosts),e.cors_allowed_origins=utils.arrayToString(t.cors_allowed_origins),e.oauth_redirect_uris=utils.arrayToString(t.oauth_redirect_uris),e.notification_from_addresses=utils.arrayToString(t.notification_from_addresses),e.settings_orig=angular.copy(e.settings)},function(t){e.exception.error=t,window.scrollTo(0,0)});var l=function(){e.exception.error=null};e.onCurrencySelect=function(t,o,n,i){e.settings["reporting_currency_"+i]=o.code},e.confirmCancel=function(){if(angular.equals(e.settings,e.settings_orig))utils.redirect(o,"/");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/")},r.showConfirm(e,t)}},e.updateSettings=function(){return l(),e.form.$invalid?void window.scrollTo(0,0):(null!=e.app_hosts&&(e.settings.app_hosts=utils.stringToArray(e.app_hosts)),null!=e.cors_allowed_origins&&(e.settings.cors_allowed_origins=utils.stringToArray(e.cors_allowed_origins)),null!=e.oauth_redirect_uris&&(e.settings.oauth_redirect_uris=utils.stringToArray(e.oauth_redirect_uris)),null!=e.notification_from_addresses&&(e.settings.notification_from_addresses=utils.stringToArray(e.notification_from_addresses)),void i.set(e.settings,e.url).then(function(e){n.addGrowl({id:"edit_success",name:"Technical Settings",type:"success",url:"#/settings/technical"})},function(t){window.scrollTo(0,0),e.exception.error=t}))}}]),app.controller("ShipmentsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.shipments={},e.nav={},e.exception={},e.parseParams=function(){e.params=o.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_shipped"),null==e.params.desc&&(e.params.desc=!0)},e.loadShipments=function(){r.getList(r.buildUrl("/shipments"),e.params).then(function(t){e.shipments.shipmentList=t,e.shipmentsChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,n){e.params[t]=n,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,o.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),o.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.shipments.shipmentList.next_page_offset:e.params.offset=e.shipments.shipmentList.previous_page_offset,e.nav.scrollTop=!0,o.search(e.params)},e.sort=function(t,n){e.params.sort_by=t,e.params.desc=n,o.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadShipments()}),e.parseParams(),e.loadShipments()}]),app.controller("ShipmentsViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService",function(e,t,o,n,i,r,s){e.shipment={},e.exception={},e.count={},e.resources={},e.url=i.buildUrl("/shipments/"+t.id),e.resources.notificationListUrl=e.url+"/notifications",i.getItem(e.url,{expand:"order.customer"}).then(function(t){e.shipment=t},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},r.showConfirm(e,t)},e.delete=function(){i.remove(e.shipment.url).then(function(t){n.addGrowl({id:"delete_success",name:e.shipment.shipment_id,type:"success"}),utils.redirect(o,"/shipments")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("ShippingMethodsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.shippingMethods={},e.nav={},e.exception={},e.parseParams=function(){e.params=o.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadShippingMethods=function(){r.getList(r.buildUrl("/shipping_methods"),e.params).then(function(t){e.shippingMethods.shippingMethodList=t,e.shippingMethodsChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,n){e.params[t]=n,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,o.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),o.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.shippingMethods.shippingMethodList.next_page_offset:e.params.offset=e.shippingMethods.shippingMethodList.previous_page_offset,e.nav.scrollTop=!0,o.search(e.params)},e.sort=function(t,n){e.params.sort_by=t,e.params.desc=n,o.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadShippingMethods()}),e.parseParams(),e.loadShippingMethods()}]),app.controller("ShippingMethodsSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService","GeographiesService","gettextCatalog",function(e,t,o,n,i,r,s,a,c){function l(e){return e._states=[],e.typeahead={},e.percentage?(e.adjustment_type="percentage",e.percentage=utils.decimalToPercent(e.percentage),e.amounts=[]):e.amounts&&(e.adjustment_type="amounts"),"US"==e.country?u(e,"us_states"):"CA"==e.country&&u(e,"ca_provinces"),e}function u(t,o){return _.each(t.regions,function(n){var i=_.findWhere(e[o],{code:n});null!=i&&t._states.push(i)}),t}function p(t){e.adjustmentCountries=_.filter(e.models[t],function(t){return e.adjustmentsEligibleCountries.indexOf(t.code)!=-1})}function d(){return!!e.adjustmentCountries.length}function m(){var t=angular.copy(e.shippingMethod);return t.countries=_.pluck(e.models.shipping_method_countries,"code"),d()?t.adjustments=_.map(t.adjustments,f):t.adjustments=null,"subtotal"==e.shipping_method_config_type?(t.quantity_config=null,t.weight_config=null,t.subtotal_config.percent_of_subtotal=utils.percentToDecimal(t.subtotal_config.percent_of_subtotal)):"quantity"==e.shipping_method_config_type?(t.subtotal_config=null,t.weight_config=null):(e.shipping_method_config_type="weight")&&(t.subtotal_config=null,t.quantity_config=null),t}function f(e){return"percentage"==e.adjustment_type?e.amounts=null:e.percentage=null,e.regions=_.pluck(e._states,"code"),e.percentage&&(e.percentage=utils.percentToDecimal(e.percentage)),delete e.adjustment_type,e}e.shippingMethod={quantity_config:{prices_per_quantity:[{price:null,currency:null}],rules:[]},weight_config:{prices_per_unit:[{price:null,currency:null}],rules:[]},subtotal_config:{rules:[]}},e.exception={},e.geo=a;var g=e.geo.getGeographies();e.countries=g.countries,e.countries.push({name:"All Countries",code:"*"}),e.us_states=g.us_states,e.ca_provinces=g.ca_provinces,e.countries=_.sortBy(e.countries,"name"),e.adjustmentsEligibleCountries=["US","CA"],e.adjustmentCountries=[],e.currencies=JSON.parse(localStorage.getItem("payment_currencies")),e.models={},e.models.shipping_method_countries=[],e.typeahead={},e.shipping_method_config_type=null,e.units=[{code:"lb",name:"pound"},{code:"oz",name:"ounce"},{code:"kg",name:"kilogram"},{code:"g",name:"gram"}],null!=t.id?(e.update=!0,e.add=!1,e.url=i.buildUrl("/shipping_methods/"+t.id),i.getItem(e.url).then(function(t){e.shippingMethod=t,_.each(t.countries,function(t){var o=_.findWhere(e.countries,{code:t});null!=o&&e.models.shipping_method_countries.push(o)}),p("shipping_method_countries"),e.shippingMethod.adjustments=_.map(e.shippingMethod.adjustments,l),e.shippingMethod.subtotal_config?(e.shipping_method_config_type="subtotal",e.shippingMethod.quantity_config={prices_per_quantity:[{price:null,currency:null}]},e.shippingMethod.weight_config={prices_per_unit:[{price:null,currency:null}]},e.shippingMethod.subtotal_config.percent_of_subtotal=utils.decimalToPercent(e.shippingMethod.subtotal_config.percent_of_subtotal)):e.shippingMethod.quantity_config?(e.shipping_method_config_type="quantity",e.shippingMethod.weight_config={prices_per_unit:[{price:null,currency:null}]},e.shippingMethod.subtotal_config={}):e.shippingMethod.weight_config&&(e.shipping_method_config_type="weight",e.shippingMethod.quantity_config={prices_per_quantity:[{price:null,currency:null}]},e.shippingMethod.subtotal_config={})},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0);var h=function(){e.exception.error=null};e.onCountrySelect=function(t,o,n,i){_.findWhere(e.models[i],{code:o.code})||e.models[i].push(o),e.typeahead[i]=null,p(i)},e.removeCountry=function(t,o){e.models[o]=_.reject(e.models[o],function(e){return e.code==t.code}),p(o)},e.onRuleCurrencySelect=function(e,t,o,n,i){i.currency=t.code},e.addNewAdjustment=function(){var t={amounts:[{price:null,currency:null}],_states:[],typeahead:{}};e.shippingMethod.adjustments?e.shippingMethod.adjustments.unshift(t):e.shippingMethod.adjustments=[t]},e.removeAdjustment=function(t,o,n){e.shippingMethod.adjustments.splice(n,1)},e.onStateSelect=function(e,t,o,n){_.findWhere(e._states,{code:o.code})||e._states.push(o),e.typeahead.state_prov=null},e.removeState=function(e,t){e._states=_.reject(e._states,function(e){return e.code==t.code})},e.addNewRule=function(t,o){e.shippingMethod[t].rules||(e.shippingMethod[t].rules=[]),e.shippingMethod[t].rules.unshift(o||{})},e.removeRule=function(t,o,n,i){e.shippingMethod[o].rules.splice(i,1)},e.confirmCancel=function(){var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/shipping_methods")},r.showConfirm(e,t)},e.confirmDelete=function(t,o,n,i,s){var a={id:"delete"};a.onConfirm=t.bind(e,t,o,n,i,s),r.showConfirm(e,a)},e.addShippingMethod=function(){if(h(),e.form.$invalid)return e.exception={error:{message:c.getString("Please review and correct the fields highlighted below.")}},void window.scrollTo(0,0);var t=m();i.set(t,i.buildUrl("/shipping_methods"),{show:"shipping_method_id,name"}).then(function(e){n.addGrowl({id:"add_success",name:e.shipping_method_id,type:"success",shipping_method_id:e.shipping_method_id,url:"#/shipping_methods/"+e.shipping_method_id+"/edit"}),window.location="#/shipping_methods"},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.updateShippingMethod=function(){if(h(),e.form.$invalid)return e.exception={error:{message:c.getString("Please review and correct the fields highlighted below.")}},void window.scrollTo(0,0);var t=m();i.set(t,e.url,{show:"shipping_method_id,name"}).then(function(e){n.addGrowl({id:"edit_success",name:e.shipping_method_id,type:"success",shipping_method_id:e.shipping_method_id,url:"#/shipping_methods/"+e.shipping_method_id+"/edit"}),window.location="#/shipping_methods"},function(t){window.scrollTo(0,0),e.exception.error=t})},e.delete=function(){i.remove(e.shippingMethod.url).then(function(t){n.addGrowl({id:"delete_success",name:e.shippingMethod.shipping_method_id,type:"success"}),utils.redirect(o,"/shipping_methods")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("SubscriptionsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.exception={},e.resources={},e.resources.subscriptionListUrl=r.buildUrl("/subscriptions")}]),app.controller("SubscriptionsViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,o,n,i,r){e.exception={},e.payment_method=null,e.invoices={},e.model={},
e.model.subscription={},e.resources={},e.count={},e.count.invoices=0,e.url=i.buildUrl("/subscriptions/"+t.id),e.resources.invoiceListUrl=e.url+"/invoices",i.getItem(e.url,{expand:"subscription_plan,customer.payment_methods,items.subscription_terms",formatted:!0},{formatted:!0}).then(function(t){e.model.subscription=t},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.uncancel=function(){var t={cancel_at_current_period_end:!1};i.set(t,e.url,{expand:"subscription_plan,customer.payment_methods,items.subscription_terms",formatted:!0}).then(function(t){e.model.subscription=t},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.uncancelItem=function(t){var o={cancel_at_current_period_end:!1};i.set(o,t.url,{expand:"subscription.subscription_plan,subscription.customer.payment_methods,subscription.items.subscription_terms",formatted:!0}).then(function(t){e.model.subscription=t.subscription},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("SubscriptionPlansListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.subscription_plans={},e.nav={},e.exception={},e.parseParams=function(){e.params=o.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="name"),null==e.params.desc&&(e.params.desc=!1)},e.loadSubscriptionPlans=function(){r.getList(r.buildUrl("/subscription_plans?show=subscription_plan_id,name,billing_interval,billing_interval_unit,trial_interval,trial_interval_unit,end_at_billing_count,date_created&sort_by="+e.params.sort_by+"&desc="+e.params.desc),e.params).then(function(t){e.subscription_plans.subscription_planList=t,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,n){e.params[t]=n,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,o.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),o.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.subscription_plans.subscription_planList.next_page_offset:e.params.offset=e.subscription_plans.subscription_planList.previous_page_offset,e.nav.scrollTop=!0,o.search(e.params)},e.sort=function(t,n){e.params.sort_by=t,e.params.desc=n,o.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadSubscriptionPlans()}),e.parseParams(),e.loadSubscriptionPlans()}]),app.controller("SubscriptionPlansSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,o,n,i,r){e.exception={},null!=t.id?(e.update=!0,e.add=!1,e.url=i.buildUrl("/subscription_plans/"+t.id),i.getItem(e.url).then(function(t){e.subscription_plan=t,e.subscription_plan_orig=angular.copy(e.subscription_plan)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0,e.subscription_plan={},e.subscription_plan.fulfill_on_renewal=!1,e.subscription_plan.order_confirmation_on_renewal=!0,e.subscription_plan.trial_interval_unit=null,e.subscription_plan.billing_interval_unit="month");var s=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.subscription_plan,e.subscription_plan_orig))utils.redirect(o,"/subscription_plans");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/subscription_plans")},r.showConfirm(e,t)}},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},r.showConfirm(e,t)},e.addSubscriptionPlan=function(){return s(),e.form.$invalid?void window.scrollTo(0,0):void i.set(e.subscription_plan,i.buildUrl("/subscription_plans"),{show:"subscription_plan_id,name"}).then(function(e){n.addGrowl({id:"add_success",name:e.name,type:"success",subscription_plan_id:e.subscription_plan_id,url:"#/subscription_plans/"+e.subscription_plan_id+"/edit"}),utils.redirect(o,"/subscription_plans")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.updateSubscriptionPlan=function(){return s(),e.form.$invalid?void window.scrollTo(0,0):((utils.isNullOrEmpty(e.subscription_plan.trial_interval_unit)||utils.isNullOrEmpty(e.subscription_plan.trial_interval))&&(e.subscription_plan.trial_interval_unit=null,e.subscription_plan.trial_interval=null),void i.set(e.subscription_plan,e.url,{show:"subscription_plan_id,name"}).then(function(e){n.addGrowl({id:"edit_success",name:e.name,type:"success",subscription_plan_id:e.subscription_plan_id,url:"#/subscription_plans/"+e.subscription_plan_id+"/edit"}),utils.redirect(o,"/subscription_plans")},function(t){window.scrollTo(0,0),e.exception.error=t}))},e.delete=function(){i.remove(e.url).then(function(t){n.addGrowl({id:"delete_success_with_undelete",name:e.subscription_plan.name,type:"success",subscription_plan_id:e.subscription_plan.subscription_plan_id,url:"#/subscription_plans/"+e.subscription_plan.subscription_plan_id+"/edit"}),utils.redirect(o,"/subscription_plans")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.undelete=function(){i.set({deleted:!1},e.url,{show:"subscription_plan_id,name"}).then(function(t){n.addGrowl({id:"undelete_success",name:e.subscription_plan.name,type:"success",subscription_plan_id:e.subscription_plan.subscription_plan_id,url:"#/subscription_plans/"+t.subscription_plan_id+"/edit"}),utils.redirect(o,"/subscription_plans")},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("TemplatesListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.templates={},e.nav={},e.exception={},e.parseParams=function(){e.params=o.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadTemplates=function(){r.getList(r.buildUrl("/templates"),e.params).then(function(t){e.templates.templateList=t,e.templatesChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,n){e.params[t]=n,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,o.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),o.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.templates.templateList.next_page_offset:e.params.offset=e.templates.templateList.previous_page_offset,e.nav.scrollTop=!0,o.search(e.params)},e.sort=function(t,n){e.params.sort_by=t,e.params.desc=n,o.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadTemplates()}),e.parseParams(),e.loadTemplates()}]),app.controller("TemplatesSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService",function(e,t,o,n,i,r,s){e.template={},e.exception={},null!=t.id?(e.update=!0,e.add=!1,e.url=i.buildUrl("/templates/"+t.id),i.getItem(e.url,{expand:"wrapper_template"}).then(function(t){e.template=t,t.wrapper_template&&(e.template.wrapper_template_id=t.wrapper_template.template_id)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0);var a=function(){e.exception.error=null};e.confirmCancel=function(){var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/templates")},r.showConfirm(e,t)},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},r.showConfirm(e,t)},e.addTemplate=function(){return a(),e.form.$invalid?void window.scrollTo(0,0):void i.set(e.template,i.buildUrl("/templates"),{show:"template_id,name"}).then(function(e){n.addGrowl({id:"add_success",name:e.template_id,type:"success",template_id:e.template_id,url:"#/templates/"+e.template_id+"/edit"}),window.location="#/templates"},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.updateTemplate=function(){a(),e.form.$invalid||i.set(e.template,e.url,{show:"template_id,name"}).then(function(e){n.addGrowl({id:"edit_success",name:e.template_id,type:"success",template_id:e.template_id,url:"#/templates/"+e.template_id+"/edit"}),window.location="#/templates"},function(t){window.scrollTo(0,0),e.exception.error=t})},e.delete=function(){i.remove(e.template.url).then(function(t){n.addGrowl({id:"delete_success",name:e.template.template_id,type:"success"}),utils.redirect(o,"/templates")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("UsersListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,o,n,i,r){e.users={},e.nav={},e.exception={},e.parseParams=function(){e.params=o.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="name"),null==e.params.desc&&(e.params.desc=!0)},e.loadUsers=function(){r.getList(r.buildUrl("/users?show=user_id,name,date_last_login,date_created&sort_by="+e.params.sort_by+"&desc="+e.params.desc),e.params).then(function(t){e.users.userList=t,e.usersChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,n){e.params[t]=n,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,o.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),o.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.users.userList.next_page_offset:e.params.offset=e.users.userList.previous_page_offset,e.nav.scrollTop=!0,o.search(e.params)},e.sort=function(t,n){e.params.sort_by=t,e.params.desc=n,o.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadUsers()}),e.parseParams(),e.loadUsers()}]),app.controller("UsersSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","HelperService",function(e,t,o,n,i,r,s){e.exception={},e.data={},null!=t.id?(e.update=!0,e.add=!1,e.url=i.buildUrl("/users/"+t.id),i.getItem(e.url).then(function(t){e.usr=t,e.usr_orig=angular.copy(e.usr)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0,e.usr={is_account_owner:!1});var a=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.usr,e.usr_orig))utils.redirect(o,"/users");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(o,"/users")},r.showConfirm(e,t)}},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},r.showConfirm(e,t)},e.addUser=function(){return a(),e.form.$invalid?void window.scrollTo(0,0):(e.usr.password=e.data.password,void i.set(e.usr,i.buildUrl("/users"),{show:"user_id,name"}).then(function(e){n.addGrowl({id:"add_success",name:e.name,type:"success",user_id:e.usr_id,url:"#/users/"+e.user_id+"/edit"}),utils.redirect(o,"/users")},function(t){e.exception.error=t,window.scrollTo(0,0)}))},e.updateUser=function(){a(),e.form.$invalid||(utils.isNullOrEmpty(e.data.password)?delete e.usr.password:e.usr.password=e.data.password,i.set(e.usr,e.url,{show:"user_id,name"}).then(function(e){n.addGrowl({id:"edit_success",name:e.name,type:"success",url:"#/users/"+e.user_id+"/edit"}),utils.redirect(o,"/users")},function(t){window.scrollTo(0,0),e.exception.error=t}))},e.delete=function(){i.remove(e.url).then(function(){n.addGrowl({id:"delete_success_with_undelete",name:e.usr.name,type:"success",url:"#/users/"+e.usr.user_id+"/edit"}),utils.redirect(o,"/users")},function(t){e.exception.error=t,window.scrollTo(0,0)})},0==s.isAdmin()?i.getItem(i.buildUrl("/users/me"),{show:"is_account_owner"}).then(function(t){t.is_account_owner&&(e.isAccountOwner=!0)},function(t){e.exception.error=t,window.scrollTo(0,0)}):e.isAccountOwner=!0}]),$("document").ready(function(){var e=localStorage.getItem("token"),t=utils.getPageQueryParameters(),o="/api/v1/notifications/"+t.notification_id+"?show=body";t.notification_id&&$.ajax({type:"GET",url:o,beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+e)},success:function(e){document.open(),document.write(e.body),document.close()}})});