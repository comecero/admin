app.controller("AccountsUpdateCtrl",["$scope","$location","ApiService","ConfirmService","GrowlsService","GeographiesService",function(e,t,n,i,o,s){e.exception={};var r=function(){e.exception.error=null};e.url=n.buildUrl("/accounts/"+localStorage.getItem("account_id")),e.confirmCancel=function(){if(angular.equals(e.account,e.account_orig))utils.redirect(t,"/");else{var n={id:"changes_lost"};n.onConfirm=function(){utils.redirect(t,"/")},i.showConfirm(e,n)}};var a=s.getGeographies(!1);e.countries=a.countries,e.us_states=a.us_states,e.ca_provinces=a.ca_provinces,e.au_states=a.au_states,0==utils.inTestMode()&&n.getItem(e.url).then(function(t){e.account=t,e.account_orig=angular.copy(e.account),e.typeahead={},e.typeahead.country={},e.typeahead.state_prov={},null!=e.account.country&&(e.typeahead.country=_.find(e.countries,{code:e.account.country})),null!=e.account.state_prov&&("US"==e.account.country&&(e.typeahead.state_prov=_.find(e.us_states,{code:e.account.state_prov})),"CA"==e.account.country&&(e.typeahead.state_prov=_.find(e.ca_provinces,{code:e.account.state_prov})),"AU"==e.account.country&&(e.typeahead.state_prov=_.find(e.au_states,{code:e.account.state_prov})))},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.onCountrySelect=function(t,n,i){e.account.country=n.code},e.onStateSelect=function(t,n,i){e.account.state_prov=n.code},e.updateAccount=function(){r(),e.form.$invalid||n.set(e.account,e.url).then(function(e){o.addGrowl({id:"edit_success_no_link",type:"success"}),utils.redirect(t,"/")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.downloadContractPdf=function(){n.getItemPdf(n.buildUrl("/contracts/current")).then(function(e){var t=new Blob([e],{type:"application/pdf"});saveAs(t,"Contract_"+localStorage.getItem("account_id")+".pdf")},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("AppsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.exception={},e.resources={},e.resources.appListUrl=s.buildUrl("/apps"),e.meta={};var r=localStorage.getItem("alias");e.meta.app_install_url_base="https://"+r+".auth.comecero.com/oauth/callback/#access_token="+localStorage.getItem("token")+"&redirect_uri=",e.meta.test=localStorage.getItem("test")}]),app.controller("AppsSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,n,i,o,s){e.exception={},e.app_display={},null!=t.id?(e.update=!0,e.add=!1,e.url=o.buildUrl("/apps/"+t.id),o.getItem(e.url,{expand:"images,app_package,source_app_package"}).then(function(t){e.app=t,t.settings_fields&&(e.app_display.settings_fields=JSON.stringify(t.settings_fields,null,4)),t.style_fields&&(e.app_display.style_fields=JSON.stringify(t.style_fields,null,4)),e.images=t.images,"app_default"==t.images[0].image_id&&(e.images=[]),e.redirect_uris=utils.arrayToString(t.redirect_uris),e.csp_hosts=utils.arrayToString(t.csp_hosts),null!=t.app_package&&(e.app_package=t.app_package,e.app_package_id=t.app_package.app_package_id),null!=t.source_app_package&&(e.source_app_package=t.source_app_package,e.source_app_package_id=t.source_app_package.app_package_id),delete e.app.app_package,delete e.app.source_app_package,delete e.app.images,e.app_orig=angular.copy(e.app)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0,e.app={is_public:!1,active:!1,hash_navigation:!1,allow_custom_css:!1,allow_custom_javascript:!1},e.images=[]),e.$watch("app_package",function(t,n){null!=t&&(e.app_package_id=t.app_package_id)}),e.$watch("source_app_package",function(t,n){null!=t&&(e.source_app_package_id=t.app_package_id)}),e.removeAppPackage=function(){e.app.app_package_id=null,e.app_package.app_package_id=null,e.showAppPackage=!1},e.removeSourceAppPackage=function(){e.app.source_app_package_id=null,e.source_app_package.source_app_package_id=null,e.showSourceAppPackage=!1};var r=function(){e.exception.error=null,null!=e.app_package&&(e.app.app_package_id=e.app_package.app_package_id),null!=e.source_app_package&&(e.app.source_app_package_id=e.source_app_package.app_package_id),null!=e.images&&_.each(e.images,function(t){null==e.app.image_ids&&(e.app.image_ids=[]),e.app.image_ids.push(t.image_id)}),0==e.app.client_side&&(e.app.type=null),0==e.app.platform_hosted&&(e.app.app_package_id=null,e.app.source_app_package=null,e.app.allow_source_download=!1,e.app.version=null,e.app.csp_hosts=null),"storefront"==e.app.type&&(e.redirect_uris=null,e.app.permissions=[]),null!=e.redirect_uris&&(e.app.redirect_uris=utils.stringToArray(e.redirect_uris)),null!=e.csp_hosts&&(e.app.csp_hosts=utils.stringToArray(e.csp_hosts))};e.confirmCancel=function(){if(angular.equals(e.app,e.app_orig))utils.redirect(n,"/apps");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/apps")},s.showConfirm(e,t)}},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},s.showConfirm(e,t)},e.setConditionals=function(){0==e.app.client_side&&(e.app.type=null,e.app.platform_hosted=!1),"storefront"==e.app.type&&(e.app.platform_hosted=!0)},e.addApp=function(){if(r(),e.form.settings_fields.$setValidity("json",!0),null!=utils.emptyToNull(e.app_display.settings_fields))try{e.app.settings_fields=JSON.parse(e.app_display.settings_fields)}catch(t){e.form.settings_fields.$setValidity("json",!1)}else e.app.settings_fields=null;if(e.form.style_fields.$setValidity("json",!0),null!=utils.emptyToNull(e.app_display.style_fields))try{e.app.style_fields=JSON.parse(e.app_display.style_fields)}catch(t){e.form.style_fields.$setValidity("json",!1)}else e.app.style_fields=null;return null!=e.redirect_uris&&(e.app.redirect_uris=utils.stringToArray(e.redirect_uris)),e.form.$invalid?void window.scrollTo(0,0):void o.set(e.app,o.buildUrl("/apps"),{show:"app_id,name"}).then(function(e){i.addGrowl({id:"add_success",name:e.name,type:"success",url:"#/apps/"+e.app_id+"/edit"}),utils.redirect(n,"/apps")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.updateApp=function(){if(r(),e.form.settings_fields.$setValidity("json",!0),null!=utils.emptyToNull(e.app_display.settings_fields))try{e.app.settings_fields=JSON.parse(e.app_display.settings_fields)}catch(t){e.form.settings_fields.$setValidity("json",!1)}else e.app.settings_fields=null;if(e.form.style_fields.$setValidity("json",!0),null!=utils.emptyToNull(e.app_display.style_fields))try{e.app.style_fields=JSON.parse(e.app_display.style_fields)}catch(t){e.form.style_fields.$setValidity("json",!1)}else e.app.style_fields=null;return null!=e.redirect_uris&&(e.app.redirect_uris=utils.stringToArray(e.redirect_uris)),e.form.$invalid?void window.scrollTo(0,0):(delete e.app.effective_permissions,void o.set(e.app,e.url,{show:"app_id,name"}).then(function(e){i.addGrowl({id:"edit_success",name:e.name,type:"success",app_id:e.app_id,url:"#/apps/"+e.app_id+"/edit"}),utils.redirect(n,"/apps")},function(t){window.scrollTo(0,0),e.exception.error=t}))},e.delete=function(){o.remove(e.url).then(function(){i.addGrowl({id:"delete_success_with_undelete",name:e.app.name,type:"success",url:"#/apps/"+e.app.app_id+"/edit"}),utils.redirect(n,"/apps")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.undelete=function(){o.set({deleted:!1},e.url,{show:"app_id,name"}).then(function(t){i.addGrowl({id:"undelete_success",name:e.app.name,type:"success",app_id:e.app.app_id,url:"#/apps/"+t.app_id+"/edit"}),utils.redirect(n,"/apps")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.stringify=function(e){return Json.stringify(e)}}]),app.controller("AppInstallationsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService","ConfirmService",function(e,t,n,i,o,s,r){e.exception={},e.resources={},e.resources.appInstallationListUrl=s.buildUrl("/app_installations"),e.meta={},e.meta.test=localStorage.getItem("test");var a=localStorage.getItem("alias"),c=a+".auth.comecero.com";window.location.hostname.indexOf("admin-staging.")>-1&&(c=c.replace(".auth.comecero.com",".auth-staging.comecero.com")),e.meta.app_install_url_base="https://"+c+"/oauth/callback/#access_token="+localStorage.getItem("token")+"&test="+e.meta.test+"&redirect_uri=",e.functions={},e.functions.uninstall=function(t,n){var i=s.buildUrl("/app_installations/"+t);s.remove(i).then(function(){o.addGrowl({id:"uninstall_success",name:n,type:"success"}),e.functions.refresh()},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.functions.confirmUninstall=function(t,n){var i={id:"app_uninstall"};i.onConfirm=function(){e.functions.uninstall(t,n)},r.showConfirm(e,i)},e.functions.setDefaultVersion=function(t,n){var i=s.buildUrl("/app_installations/"+t),r={is_default_version:!0};s.set(r,i,{show:"name"}).then(function(t){o.addGrowl({id:"set_default_app_version",name:t.name,type:"success"}),e.functions.refresh()},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.functions.confirmSetDefaultVersion=function(t){var n={id:"set_default_app_version"};n.onConfirm=function(){e.functions.setDefaultVersion(t)},r.showConfirm(e,n)}}]),app.controller("AppInstallationsSettingsCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,n,i,o,s){e.exception={},e.selections={},e.url=o.buildUrl("/app_installations/"+t.id),e.checkboxState={},o.getItem(e.url,{show:"app_installation_id,app_id,name,settings_fields.*,settings,alias,launch_url,location_url,allow_custom_javascript,custom_javascript"}).then(function(t){e.app_installation=t,null!=t.settings&&(e.selections=t.settings),e.settings_orig=angular.copy(e.app_installation.settings),e.app_host=utils.left(t.location_url,t.location_url.length-t.alias.length-1)},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.confirmCancel=function(){if(angular.equals(e.app_installation.config,e.config_orig))utils.redirect(n,"/app_installations");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/app_installations")},s.showConfirm(e,t)}},e.updateAppInstallation=function(t){e.app_installation.settings=e.selections,e.exception={},o.set(e.app_installation,e.url,{show:"app_installation_id,name"}).then(function(o){i.addGrowl({id:"edit_success",name:e.app_installation.name,type:"success",url:"#/app_installations/"+e.app_installation.app_installation_id+"/settings"}),t||utils.redirect(n,"/app_installations")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("AppInstallationsStyleCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,n,i,o,s){e.exception={},e.selections={},e.url=o.buildUrl("/app_installations/"+t.id),e.checkboxState={},o.getItem(e.url,{show:"app_installation_id,app_id,name,style_fields.*,style,allow_custom_css,custom_css"}).then(function(t){e.app_installation=t,null!=t.style&&(e.selections=t.style),e.style_orig=angular.copy(e.app_installation.style)},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.confirmCancel=function(){if(angular.equals(e.app_installation.style,e.style_orig))utils.redirect(n,"/app_installations");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/app_installations")},s.showConfirm(e,t)}},e.updateAppInstallation=function(t){e.app_installation.style=e.selections,e.exception={},o.set(e.app_installation,e.url,{show:"app_installation_id,name"}).then(function(o){i.addGrowl({id:"edit_success",name:e.app_installation.name,type:"success",url:"#/app_installations/"+e.app_installation.app_installation_id+"/style"}),t||utils.redirect(n,"/app_installations")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("AuthsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.auths={},e.nav={},e.exception={},e.parseParams=function(){e.params=n.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadAuths=function(){s.getList(s.buildUrl("/auths?show=auth_id,token,comments,expires,date_created&sort_by="+e.params.date_type+"&desc="+e.params.desc),e.params).then(function(t){e.auths.authList=t,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,i){e.params[t]=i,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,n.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),n.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.auths.authList.next_page_offset:e.params.offset=e.auths.authList.previous_page_offset,e.nav.scrollTop=!0,n.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,n.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadAuths()}),e.parseParams(),e.loadAuths()}]),app.controller("AuthsSetCtrl",["$scope","$rootScope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","$http",function(e,t,n,i,o,s,r,a){e.exception={},e.data={},e.data.type="secret",e.data.test=!0,null!=n.id?(e.update=!0,e.add=!1,e.url=s.buildUrl("/auths/"+n.id),s.getItem(e.url).then(function(t){e.auth=t,e.auth_orig=angular.copy(e.auth)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0,e.auth={});var c=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.auth,e.auth_orig))utils.redirect(i,"/auths");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(i,"/auths")},r.showConfirm(e,t)}},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},r.showConfirm(e,t)},e.addAuth=function(){c(),e.form.$invalid||s.set(e.auth,s.buildUrl("/auths/secret"),{show:"auth_id,token",test:t.settings.test}).then(function(t){e.showToken=!0,e.auth.token=t.token},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.updateAuth=function(){c(),e.form.$invalid||(delete e.auth.effective_permissions,s.set(e.auth,e.url,{show:"auth_id,token"}).then(function(e){o.addGrowl({id:"edit_success",name:e.name,type:"success",name:e.token,url:"#/auths/"+e.auth_id+"/edit"}),utils.redirect(i,"/auths")},function(t){window.scrollTo(0,0),e.exception.error=t}))},e.delete=function(){s.remove(e.url).then(function(t){o.addGrowl({id:"delete_success",name:e.auth.token,type:"success"}),utils.redirect(i,"/auths")},function(t){window.scrollTo(0,0),e.exception.error=t})},e.addLimitedAuth=function(n){c();var i={headers:{Authorization:"Bearer "+localStorage.getItem("token"),Accept:"application/json;"}};0==n&&delete i.headers.Authorization;var o=a.post("https://"+t.apiHost+"/api/v1/auths/limited?account_id="+localStorage.getItem("account_id")+"&test="+n,null,i);o.success(function(t){e.showToken=!0,e.auth.token=t.token}),o.error(function(t){e.exception.error=t.error,window.scrollTo(0,0)})}}]),app.controller("CartsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.exception={},e.resources={},e.resources.cartListUrl=s.buildUrl("/carts")}]),app.controller("CartsViewCtrl",["$scope","$routeParams","ApiService","ConfirmService","GrowlsService",function(e,t,n,i,o){e.cart={},e.payment={},e.exception={},e.count={},e.count.payments=0,e.resources={},e.functions={},e.url=n.buildUrl("/carts/"+t.id),e.resources.paymentListUrl=e.url+"/payments";var s={expand:"customer,items.product,payments,payments.payment_method",hide:"items.product.images",formatted:!0};n.getItem(e.url,s).then(function(t){e.cart=t,e.successful_payment=_.findWhere(e.cart.payments.data,{success:!0})},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.hasPermission=function(e,t){return utils.hasPermission(e,t)},e.$watch("successful_payment.status",function(t,n){e.successful_payment&&void 0!=n&&(e.cart.payment_status=e.successful_payment.status)})}]),app.controller("CustomersListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.customers={},e.nav={},e.exception={},e.parseParams=function(){e.params=n.search(),utils.stringsToBool(e.params),null==e.params.date_type&&(e.params.date_type="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadCustomers=function(){s.getList(s.buildUrl("/customers?show=customer_id,name,email,has_payments,date_created&date_type="+e.params.date_type+"&desc="+e.params.desc),e.params).then(function(t){e.customers.customerList=t,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null,e.setPagination(e.customers.customerList)},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setPagination=function(t){e.nav.before_item=null,e.nav.after_item=null,t.data.length>0&&(null!=t.previous_page_url&&(e.nav.before_item=t.data[0].customer_id),null!=t.next_page_url&&(e.nav.after_item=t.data[t.data.length-1].customer_id))},e.setParam=function(t,i){e.params[t]=i,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,n.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),n.search(e.params))},e.movePage=function(t){"+"==t?(e.params.after_item=e.nav.after_item,e.params.before_item=null):(e.params.after_item=null,e.params.before_item=e.nav.before_item),e.nav.scrollTop=!0,n.search(e.params)},e.sort=function(t,i){e.params.date_type=t,e.params.desc=i,n.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadCustomers()}),e.parseParams(),e.params.has_payments=!0,e.loadCustomers()}]),app.controller("CustomersViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","GeographiesService",function(e,t,n,i,o,s,r){e.customer={},e.billing_address={},e.shipping_address={},e.cards=[],e.resources={},e.edit=!1,e.exception={},e.count={},e.count.orders=0,e.count.payments=0,e.count.subscriptions=0,e.count.refunds=0,e.count.invoices=0,e.url=o.buildUrl("/customers/"+t.id),e.resources.orderListUrl=e.url+"/orders",e.resources.subscriptionListUrl=e.url+"/subscriptions",e.resources.paymentListUrl=e.url+"/payments",e.resources.refundListUrl=e.url+"/refunds",e.resources.invoiceListUrl=e.url+"/invoices",o.getItem(e.url,{expand:"payment_methods"}).then(function(t){e.customer=t,e.payment_methods=t.payment_methods},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.hasPermission=function(e,t){return utils.hasPermission(e,t)},e.refreshCards=function(){o.getList(e.url+"/payment_methods").then(function(t){e.payment_methods=t})}}]),app.controller("DashboardViewCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.dashboard={},e.exception={},e.options={},e.options.currencies=[],e.options.currencies.push(localStorage.getItem("reporting_currency_primary")),e.options.currencies.push(localStorage.getItem("reporting_currency_secondary")),e.options.currency=e.options.currencies[0],e.url=s.buildUrl("/dashboard"),e.loadDashboard=function(t){s.getItem(e.url,{currency:t,formatted:!0}).then(function(t){e.currency=t.currency,e.sales=[],_.each(t.sales,function(t){e.sales.push(t.total)}),e.sales_today=t.sales[29].formatted.total,e.sales_yesterday=t.sales[28].formatted.total,e.sales_month=t.sales_summary.formatted.total,e.new_subscriptions=[],_.each(t.new_subscriptions,function(t){e.new_subscriptions.push(t.total)}),e.new_subscriptions_today=t.new_subscriptions[29].formatted.total,e.new_subscriptions_yesterday=t.new_subscriptions[28].formatted.total,e.new_subscriptions_month=t.new_subscriptions_summary.formatted.total,e.subscription_renewals=[],_.each(t.subscription_renewals,function(t){e.subscription_renewals.push(t.total)}),e.subscription_renewals_today=t.subscription_renewals[29].formatted.total,e.subscription_renewals_yesterday=t.subscription_renewals[28].formatted.total,e.subscription_renewals_month=t.subscription_renewals_summary.formatted.total,e.subscriptions=[],_.each(t.subscriptions,function(t){e.subscriptions.push(t.total)}),e.subscriptions_today=t.subscriptions[29].formatted.total,e.subscriptions_yesterday=t.subscriptions[28].formatted.total,e.subscriptions_month=t.subscriptions_summary.formatted.total,e.cart_visitors=[],e.cart_visitors=_.pluck(t.cart_visitors,"value"),e.cart_visitors_today=t.cart_visitors[29].value,e.cart_visitors_yesterday=t.cart_visitors[28].value;for(var n=0,i=0;n<e.cart_visitors.length;i+=e.cart_visitors[n++]);e.cart_visitors_month=i,e.cart_conversions=[],e.cart_conversions=_.pluck(t.cart_conversions,"value"),e.cart_conversions_today=t.cart_conversions[29].value,e.cart_conversions_yesterday=t.cart_conversions[28].value;for(var n=0,i=0;n<e.cart_conversions.length;i+=e.cart_conversions[n++]);e.cart_conversions_month=i,e.cart_conversion_rates=[],e.cart_conversion_rates=_.pluck(t.cart_conversion_rates,"value"),e.cart_conversion_rates_today=t.cart_conversion_rates[29].value,e.cart_conversion_rates_yesterday=t.cart_conversion_rates[28].value,e.cart_conversion_rates_month=t.average_cart_conversion_rate,utils.renameProperty(t.customer_operating_systems,"item","label"),e.customer_operating_systems=t.customer_operating_systems,utils.renameProperty(t.customer_languages,"item","label"),e.customer_languages=t.customer_languages,utils.renameProperty(t.customer_browsers,"item","label"),e.customer_browsers=t.customer_browsers,utils.renameProperty(t.customer_locations,"item","label"),e.customer_locations=t.customer_locations,utils.renameProperty(t.customer_devices,"item","label"),e.customer_devices=t.customer_devices,utils.renameProperty(t.customer_new_vs_returning,"item","label"),e.customer_new_vs_returning=t.customer_new_vs_returning},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.loadDashboard(e.options.currency)}]),app.controller("EventsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.events={},e.nav={},e.exception={},e.parseParams=function(){e.params=n.search(),utils.stringsToBool(e.params),null==e.params.status&&(e.params.status="delivered"),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadEvents=function(){s.getList(s.buildUrl("/events"),e.params).then(function(t){e.events.eventList=t,e.eventsChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,i){e.params[t]=i,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,n.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),n.search(e.params))},e.movePage=function(t,i){"+"==t?(e.params.after_item=i,e.params.before_item=null):(e.params.after_item=null,e.params.before_item=i),e.nav.scrollTop=!0,n.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,n.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadEvents()}),e.parseParams(),e.loadEvents()}]),app.controller("EventViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService",function(e,t,n,i,o,s,r){e.event={},e.exception={},e.options={},e.options.raw=!0,e.url=o.buildUrl("/events/"+t.id);var a={expand:"event_subscription",debug:!0};o.getItem(e.url,a).then(function(t){e.event=t,e.event.data=JSON.stringify(e.event.data,null,4)},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.retryEvent=function(){e.exception={},o.set(null,e.event.url+"/retry").then(function(e){i.addGrowl({id:"event_resend",type:"success"})},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("EventSubscriptionsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.eventSubscriptions={},e.nav={},e.exception={},e.parseParams=function(){e.params=n.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadEventSubscriptions=function(){s.getList(s.buildUrl("/event_subscriptions"),e.params).then(function(t){e.eventSubscriptions.subscriptionList=t,e.eventSubscriptionsChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,i){e.params[t]=i,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,n.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),n.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.eventSubscriptions.subscriptionList.next_page_offset:e.params.offset=e.eventSubscriptions.subscriptionList.previous_page_offset,e.nav.scrollTop=!0,n.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,n.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadEventSubscriptions()}),e.parseParams(),e.loadEventSubscriptions()}]),app.controller("EventSubscriptionsSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService","TimezonesService",function(e,t,n,i,o,s,r,a){e.eventSubscription={},e.timezones=a.getTimezones(),e.event_types=[{name:"Account Modified",code:"account:modified"},{name:"Cart Payment Completed",code:"cart:payment_completed"},{name:"Gateway Created",code:"gateway:created"},{name:"Gateway Modified",code:"gateway:modified"},{name:"Event Subscription Created",code:"event_subscription:created"},{name:"Event Subscription Modified",code:"event_subscription:modified"},{name:"Event Subscription Deleted",code:"event_subscription:deleted"},{name:"License Service Low Licenses",code:"license_service:low_licenses"},{name:"Invoice Created",code:"invoice:created"},{name:"Invoice Payment Completed",code:"invoice:payment_completed"},{name:"Order Created",code:"order:created"},{name:"Order Licenses Assigned",code:"order:licenses_assigned"},{name:"Order Payment Completed",code:"order:payment_completed"},{name:"Order Fulfilled",code:"order:fulfilled"},{name:"Payment Created Success",code:"payment:created_success"},{name:"Payment Created Failure",code:"payment:created_failure"},{name:"Payment Captured Success",code:"payment:captured_success"},{name:"Payment Captured Failure",code:"payment:captured_failure"},{name:"Payment Voided",code:"payment:voided"},{name:"Product Created",code:"product:created"},{name:"Product Modified",code:"product:modified"},{name:"Product Deleted",code:"product:deleted"},{name:"Refund Created Success",code:"refund:created_success"},{name:"Refund Created Failure",code:"refund:created_failure"},{name:"Refund Deleted",code:"refund:deleted"},{name:"User Created",code:"user:created"},{name:"User Modified",code:"user:modified"},{name:"Shipment Created",code:"shipment:created"},{name:"Shipment Modified",code:"shipment:modified"},{name:"Shipment Deleted",code:"shipment:deleted"},{name:"Subscription Created",code:"subscription:created"},{name:"Subscription Cancelled",code:"subscription:cancelled"},{name:"Subscription Completed",code:"subscription:completed"},{name:"Subscription Converted",code:"subscription:converted"},{name:"Subscription Renewal Success",code:"subscription:renewal_success"},{name:"Subscription Renewal Failure",code:"subscription:renewal_failure"}],e.exception={},e.options={email:null,url:null},null!=t.id?(e.update=!0,e.add=!1,e.url=o.buildUrl("/event_subscriptions/"+t.id),o.getItem(e.url).then(function(t){e.eventSubscription=t,"http"==e.eventSubscription.method?e.options.url=e.eventSubscription.destination:e.options.email=e.eventSubscription.destination},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0,e.eventSubscription.method="http",e.eventSubscription.format="json",e.eventSubscription.active=!0);var c=function(){e.exception.error=null,"http"==e.eventSubscription.method?e.eventSubscription.destination=e.options.url:e.eventSubscription.destination=e.options.email};e.confirmCancel=function(){var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/event_subscriptions")},s.showConfirm(e,t)},e.addEventSubscription=function(){return c(),"http"==e.eventSubscription.method&&(e.form.email.$setValidity("characters",!0),e.form.email.$setValidity("required",!0)),"email"==e.eventSubscription.method&&(e.form.url.$setValidity("characters",!0),e.form.url.$setValidity("required",!0)),e.form.$invalid?void window.scrollTo(0,0):void o.set(e.eventSubscription,o.buildUrl("/event_subscriptions"),{show:"event_subscription_id,name"}).then(function(e){i.addGrowl({id:"add_success",name:e.event_subscription_id,type:"success",event_subscription_id:e.event_subscription_id,url:"#/event_subscriptions/"+e.event_subscription_id+"/edit"}),window.location="#/event_subscriptions"},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.updateEventSubscription=function(){return c(),"http"==e.eventSubscription.method&&(e.form.email.$setValidity("characters",!0),e.form.email.$setValidity("required",!0)),"email"==e.eventSubscription.method&&(e.form.url.$setValidity("characters",!0),e.form.url.$setValidity("required",!0)),e.form.$invalid?void window.scrollTo(0,0):void o.set(e.eventSubscription,e.url,{show:"event_subscription_id,name"}).then(function(e){i.addGrowl({id:"edit_success",name:e.event_subscription_id,type:"success",event_subscription_id:e.event_subscription_id,url:"#/event_subscriptions/"+e.event_subscription_id+"/edit"}),window.location="#/event_subscriptions"},function(t){window.scrollTo(0,0),e.exception.error=t})},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},s.showConfirm(e,t)},e.delete=function(){o.remove(e.eventSubscription.url).then(function(t){i.addGrowl({id:"delete_success",name:e.eventSubscription.event_subscription_id,type:"success"}),utils.redirect(n,"/event_subscriptions")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("FilesListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.files={},e.nav={},e.exception={},e.parseParams=function(){e.params=n.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="name"),null==e.params.desc&&(e.params.desc=!1)},e.loadFiles=function(){s.getList(s.buildUrl("/files?show=file_id,filename,name,version,bytes,date_created"),e.params).then(function(t){e.files.fileList=t,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),n.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.files.fileList.next_page_offset:e.params.offset=e.files.fileList.previous_page_offset,e.nav.scrollTop=!0,n.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,n.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadFiles()}),e.parseParams(),e.loadFiles()}]),app.controller("FilesAddCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,n,i,o,s){e.file={},e.file.expires_in_days=7,e.file.expires_in_clicks=10,e.options={by_url:!1},e.exception={},e.uploadSending=!1;e.$on("uploadSending",function(t,n){e.$apply(function(){e.uploadSending=n})}),e.$on("uploadDelete",function(t,i,r){var a={id:"delete"};a.onConfirm=function(){e.$broadcast("uploadDeleted",r),o.remove(i.url,null,!1),utils.redirect(n,"/files")},s.showConfirm(e,a)}),e.$on("uploadComplete",function(e,t){i.addGrowl({id:"add_success",name:t.name,type:"success",file_id:t.file_id,url:"#/files/"+t.file_id+"/edit"}),utils.redirect(n,"/files")});e.uploadByUrl=function(){var t=angular.copy(e.file);t.file_url=e.options.url,t.http_authorization_username=e.options.http_authorization_username,t.http_authorization_password=e.options.http_authorization_password,o.multipartForm(t,null,o.buildUrl("/files")).then(function(e){i.addGrowl({id:"add_success",name:e.name,type:"success",file_id:e.file_id,url:"#/files/"+e.file_id+"/edit"}),utils.redirect(n,"/files")},function(t){e.exception.error=t,
window.scrollTo(0,0)})};e.cancel=function(){if(e.uploadSending){var t={id:"upload_cancel"};t.onConfirm=function(){e.$broadcast("uploadCanceled"),utils.redirect(n,"/files")},s.showConfirm(e,t)}else utils.redirect(n,"/files")}}]),app.controller("FilesEditCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,n,i,o,s){e.file={},e.exception={},e.options={by_url:!1},e.url=o.buildUrl("/files/"+t.id),e.uploadUrl="/files/"+t.id,o.getItem(e.url).then(function(t){e.file=t,e.file_orig=angular.copy(e.file)},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.confirmCancel=function(){if(angular.equals(e.file,e.file_orig))utils.redirect(n,"/files");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/files")},s.showConfirm(e,t)}},e.uploadSending=!1;e.$on("uploadSending",function(t,n){e.$apply(function(){e.uploadSending=n})}),e.$on("uploadComplete",function(t,o){e.$apply(function(){i.addGrowl({id:"edit_success",name:o.name,type:"success",file_id:o.file_id,url:"#/files/"+o.file_id+"/edit"}),utils.redirect(n,"/files")})});e.cancelUpload=function(){if(e.uploadSending){var t={id:"upload_cancel"};t.onConfirm=function(){e.$broadcast("uploadCanceled"),utils.redirect(n,"/files")},s.showConfirm(e,t)}else utils.redirect(n,"/files")};var r=function(){e.exception.error=null};e.updateFile=function(){r(),o.multipartForm(e.file,null,e.file.url,{show:"file_id,name"}).then(function(e){i.addGrowl({id:"edit_success",name:e.name,type:"success",file_id:e.file_id,url:"#/files/"+e.file_id+"/edit"}),utils.redirect(n,"/files")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.uploadByUrl=function(){r();var t=angular.copy(e.file);t.file_url=e.options.url,t.http_authorization_username=e.options.http_authorization_username,t.http_authorization_password=e.options.http_authorization_password,o.multipartForm(t,null,o.buildUrl("/files/"+t.file_id)).then(function(e){i.addGrowl({id:"edit_success",name:e.name,type:"success",file_id:e.file_id,url:"#/files/"+e.file_id+"/edit"}),utils.redirect(n,"/files")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.deleteFile()},s.showConfirm(e,t)},e.deleteFile=function(){o.remove(e.file.url).then(function(){i.addGrowl({id:"delete_success",name:e.file.name,type:"success"}),utils.redirect(n,"/files")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("GatewaysListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.gateways={},e.nav={},e.exception={},e.parseParams=function(){e.params=n.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadGateways=function(){s.getList(s.buildUrl("/gateways?show=gateway_id,name,active,payment_method_type,date_created&sort_by="+e.params.sort_by+"&desc="+e.params.desc),e.params).then(function(t){e.gateways.gatewayList=t,e.gatewaysChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setActive=function(t){function n(){e.successItems.length>0&&(1==t?o.addGrowl({id:"activate_success",count:e.successItems.length}):o.addGrowl({id:"inactivate_success",count:e.successItems.length}))}var r=_.where(e.gateways.gatewayList.data,{checked:!0});e.successItems=[],e.failItems=[];var a=(i.defer(),[]);_.each(r,function(n){a.push(s.set({gateway_id:n.gateway_id,active:t},n.url).then(function(t){n.active=t.active,e.successItems.push(n)},function(t){e.failItems.push(n),o.addGrowl({id:"active_change_failure",name:n.name,type:"danger"})}))}),i.all(a).then(n)},e.setParam=function(t,i){e.params[t]=i,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,n.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),n.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.gateways.gatewayList.next_page_offset:e.params.offset=e.gateways.gatewayList.previous_page_offset,e.nav.scrollTop=!0,n.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,n.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadGateways()}),e.checkGateway=function(t){t.checked?(t.checked=!1,e.gatewaysChecked=!1,_.each(e.gateways.gatewayList.data,function(t){t.checked&&(e.gatewaysChecked=!0)})):(t.checked=!0,e.gatewaysChecked=!0)},e.parseParams(),e.loadGateways()}]),app.controller("GatewaysSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService",function(e,t,n,i,o,s,r){e.exception={},e.models={},e.models.selectedCurrencies=[],e.models.selectedCardTypes=[],e.showFields=!1,e.gateway_config={},null!=t.id?(e.update=!0,e.add=!1,e.url=o.buildUrl("/gateways/"+t.id),o.getItem(e.url,{show_sensitive:!0}).then(function(t){e.gateway=t,o.getItem(o.buildUrl("/gateways/options")).then(function(n){e.gateway_configs=n.gateway_configs,e.currencies=n.currencies,e.card_types=n.card_types,_.each(t.currencies,function(t){var n=_.findWhere(e.currencies,{code:t});null!=n&&e.models.selectedCurrencies.push(n)}),_.each(t.card_types,function(t){e.models.selectedCardTypes.push(t)}),e.loadFields(t.provider_id)},function(t){e.exception.error=t}),e.gateway_orig=angular.copy(e.gateway)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0,e.gateway={active:!1,payment_method_type:"credit_card",currencies:[],card_types:[],fields:{}},o.getItem(o.buildUrl("/gateways/options")).then(function(t){e.gateway_configs=t.gateway_configs,e.currencies=t.currencies,e.card_types=t.card_types},function(t){e.exception.error=t}));var a=function(){e.exception.error=null,e.gateway.currencies=_.pluck(e.models.selectedCurrencies,"code"),e.gateway.card_types=e.models.selectedCardTypes};e.confirmCancel=function(){if(angular.equals(e.gateway,e.gateway_orig))utils.redirect(n,"/gateways");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/gateways")},s.showConfirm(e,t)}},e.addGateway=function(){a(),e.form.$invalid||o.set(e.gateway,o.buildUrl("/gateways"),{show:"gateway_id,name"}).then(function(e){i.addGrowl({id:"add_success",name:e.name,type:"success",gateway_id:e.gateway_id,url:"#/gateways/"+e.gateway_id+"/edit"}),r.setAccountMeta(),utils.redirect(n,"/gateways")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.updateGateway=function(){a(),e.form.$invalid||o.set(e.gateway,e.url,{show:"gateway_id,name"}).then(function(e){i.addGrowl({id:"edit_success",name:e.name,type:"success",url:"#/gateways/"+e.gateway_id+"/edit"}),r.setAccountMeta(),utils.redirect(n,"/gateways")},function(t){window.scrollTo(0,0),e.exception.error=t})},e.loadGatewayConfig=function(t){e.gateway_config=_.findWhere(e.gateway_configs,{provider_id:e.gateway.provider_id}),1==e.gateway_config.payment_method_types.length&&(e.gateway.payment_method_type=e.gateway_config.payment_method_types[0]),e.loadFields(t)},e.loadFields=function(t){var n=_.findWhere(e.gateway_configs,{provider_id:t});n&&(n.fields.length>0?e.fields=n.fields:e.fields=null)},e.onCurrencySelect=function(t,n,i){_.findWhere(e.models.selectedCurrencies,{code:n.code})||e.models.selectedCurrencies.push(n),e.typeahead.currency=null},e.removeCurrency=function(t){e.models.selectedCurrencies=_.reject(e.models.selectedCurrencies,function(e){return e.code==t.code})},e.onCardTypeSelect=function(t,n,i){e.models.selectedCardTypes.push(n),e.typeahead.card_types=null},e.removeCardType=function(t){e.models.selectedCardTypes=_.reject(e.models.selectedCardTypes,function(e){return e==t})},e.supportsCreditCard=function(t){if(t&&e.gateway_configs){var n=_.findWhere(e.gateway_configs,{provider_id:e.gateway.provider_id});if(n&&n.payment_method_types.indexOf("credit_card")>-1)return!0}return!1},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},s.showConfirm(e,t)},e.delete=function(){o.remove(e.url).then(function(){i.addGrowl({id:"delete_success",name:e.gateway.name,type:"success"}),utils.redirect(n,"/gateways")},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("GettingStartedViewCtrl",["$scope","$q","$routeParams","ApiService","GrowlsService",function(e,t,n,i,o){var s=function(t){e.cartUrl="/#/app_installations"};e.account_id=localStorage.getItem("account_id"),s(utils.stringToBool(localStorage.getItem("test")))}]),app.controller("HostedFunctionsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.hostedFunctions={},e.nav={},e.exception={},e.parseParams=function(){e.params=n.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="name"),null==e.params.desc&&(e.params.desc=!1)},e.loadHostedFunctions=function(){s.getList(s.buildUrl("/hosted_functions?show=hosted_function_id,filename,name,environment,bytes,date_created"),e.params).then(function(t){e.hostedFunctions.hostedFunctionList=t,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),n.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.hostedFunctions.hostedFunctionList.next_page_offset:e.params.offset=e.hostedFunctions.hostedFunctionList.previous_page_offset,e.nav.scrollTop=!0,n.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,n.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadHostedFunctions()}),e.parseParams(),e.loadHostedFunctions()}]),app.controller("HostedFunctionsAddCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,n,i,o,s){e.hostedFunction={},e.exception={},e.uploadSending=!1;e.$on("uploadSending",function(t,n){e.$apply(function(){e.uploadSending=n})}),e.$on("uploadDelete",function(t,i,r){var a={id:"delete"};a.onConfirm=function(){e.$broadcast("uploadDeleted",r),o.remove(i.url,null,!1),utils.redirect(n,"/hosted_functions")},s.showConfirm(e,a)}),e.$on("uploadComplete",function(e,t){i.addGrowl({id:"add_success",name:t.name,type:"success",hosted_function_id:t.hosted_function_id,url:"#/hosted_functions/"+t.hosted_function_id+"/edit"}),utils.redirect(n,"/hosted_functions")});e.cancel=function(){if(e.uploadSending){var t={id:"upload_cancel"};t.onConfirm=function(){e.$broadcast("uploadCanceled"),utils.redirect(n,"/hosted_functions")},s.showConfirm(e,t)}else utils.redirect(n,"/hosted_functions")}}]),app.controller("HostedFunctionsEditCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,n,i,o,s){e.hostedFunction={},e.exception={},e.url=o.buildUrl("/hosted_functions/"+t.id),e.uploadUrl="/hosted_functions/"+t.id,o.getItem(e.url).then(function(t){e.hostedFunction=t,e.hostedFunction_orig=angular.copy(e.hostedFunction)},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.confirmCancel=function(){if(angular.equals(e.hostedFunction,e.hostedFunction_orig))utils.redirect(n,"/hosted_functions");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/hosted_functions")},s.showConfirm(e,t)}},e.uploadSending=!1;e.$on("uploadSending",function(t,n){e.$apply(function(){e.uploadSending=n})}),e.$on("uploadComplete",function(t,n){e.$apply(function(){e.hostedFunction=n})});e.cancelUpload=function(){if(e.uploadSending){var t={id:"upload_cancel"};t.onConfirm=function(){e.$broadcast("uploadCanceled"),utils.redirect(n,"/hosted_functions")},s.showConfirm(e,t)}else utils.redirect(n,"/hosted_functions")};var r=function(){e.exception.error=null};e.updateHostedFunction=function(){r(),o.multipartForm(e.hostedFunction,null,e.hostedFunction.url,{show:"hosted_function_id,name"}).then(function(e){i.addGrowl({id:"edit_success",name:e.name,type:"success",hosted_function_id:e.hosted_function_id,url:"#/hosted_functions/"+e.hosted_function_id+"/edit"}),utils.redirect(n,"/hosted_functions")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.deleteHostedFunction()},s.showConfirm(e,t)},e.deleteHostedFunction=function(){o.remove(e.hostedFunction.url).then(function(){i.addGrowl({id:"delete_success",name:e.hostedFunction.name,type:"success"}),utils.redirect(n,"/hosted_functions")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("ImagesListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.images={},e.nav={},e.exception={},e.parseParams=function(){e.params=n.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!1)},e.loadImages=function(){s.getList(s.buildUrl("/images?show=image_id,filename,link_square,link_large,date_created&sort_by="+e.params.sort_by+"&desc="+e.params.desc),e.params).then(function(t){e.images.imageList=t,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),n.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.images.imageList.next_page_offset:e.params.offset=e.images.imageList.previous_page_offset,e.nav.scrollTop=!0,n.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,n.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadImages()}),e.parseParams(),e.loadImages()}]),app.controller("ImagesAddCtrl",["$scope","$routeParams","GrowlsService","ApiService","ConfirmService",function(e,t,n,i,o){e.image={},e.exception={},e.state={},e.state.uploadSending=!1,e.state.uploadComplete=!1;e.$on("uploadSending",function(t,n){e.$apply(function(){e.state.uploadSending=n})});e.showDelete=!1,utils.hasPermission("images","delete")&&(e.showDelete=!0);e.$on("uploadDelete",function(t,n,s){var r={id:"delete"};r.onConfirm=function(){e.$broadcast("uploadDeleted",s),utils.hasPermission("images","delete")&&i.remove(n.url,null,!1)},o.showConfirm(e,r)}),e.$on("uploadComplete",function(t,n){e.state.uploadComplete=!0});e.cancel=function(){if(e.state.uploadSending){var t={id:"upload_cancel"};t.onConfirm=function(){e.$broadcast("uploadCanceled"),utils.redirect($location,"/images")},o.showConfirm(e,t)}else utils.redirect($location,"/images")}}]),app.controller("ImagesViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,n,i,o,s){e.image={},e.exception={},e.url=o.buildUrl("/images/"+t.id),o.getItem(e.url).then(function(t){e.image=t},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.deleteImage()},s.showConfirm(e,t)},e.deleteImage=function(){o.remove(e.image.url).then(function(){i.addGrowl({id:"delete_success",name:e.image.filename,type:"success"}),utils.redirect(n,"/images")},function(t){window.scrollTo(0,0),e.exception=t})}}]),app.controller("InvoicesListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.exception={},e.resources={},e.resources.invoiceListUrl=s.buildUrl("/invoices")}]),app.controller("InvoicesSetCtrl",["$scope","$routeParams","$location","ApiService","ConfirmService","GrowlsService",function(e,t,n,i,o,s){e.invoice={},e.payment={},e.exception={},e.count={},e.count.payments=0,e.count.refunds=0,e.count.notifications=0,e.resources={},e.functions={},e.currencies=JSON.parse(localStorage.getItem("payment_currencies")),e.params={expand:"customer.payment_methods,options,payments.payment_method,items.subscription_terms,subscription",formatted:!0},e.invoice.currency=localStorage.getItem("default_payment_currency");var r=new Date;r.setMonth(r.getMonth()+1),e.invoice.date_due=r,1==e.currencies.length&&(e.invoice.currency=e.currencies[0].code),e.itemPriceEdits={},e.itemQuantityEdits={},e.datepicker={},e.datepicker.status={},e.datepicker.options={startingDay:1,showWeeks:!1,initDate:new Date,yearRange:10},e.datepicker.status.date_due={opened:!1},e.datepicker.open=function(t,n){e.datepicker.status[n].opened=!0},null!=t.id?(e.update=!0,e.add=!1,e.url=i.buildUrl("/invoices/"+t.id),e.resources.paymentListUrl=e.url+"/payments",e.resources.refundListUrl=e.url+"/refunds",e.resources.notificationListUrl=e.url+"/notifications",i.getItem(e.url,e.params).then(function(t){e.invoice=t,e.successful_payment=_.findWhere(e.invoice.payments.data,{success:!0}),e.draft=e.invoice.draft},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.hasPermission=function(e,t){return utils.hasPermission(e,t)}):(e.url=i.buildUrl("/invoices"),e.invoice.items=[],e.invoice.autopay=!1,e.draft=!0,e.update=!1,e.add=!0),e.$watch("successful_payment.status",function(t,n){e.successful_payment&&void 0!=n&&(e.invoice.payment_status=e.successful_payment.status)}),e.functions.onCustomerSet=function(t){e.invoice.url&&(e.invoice.customer=t,e.backgroundUpdate())},e.backgroundUpdate=function(){e.invoice.autopay;return i.set(e.invoice,e.url,e.params).then(function(t){e.invoice=t,e.invoice.autopay=!1,e.invoice.customer&&e.invoice.customer.payment_methods&&e.invoice.customer.payment_methods.length>0&&(e.invoice.autopay=!0)},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.save=function(t){i.set(e.invoice,e.url).then(function(e){s.addGrowl({id:"edit_success",name:"Invoice "+e.invoice_id,type:"success",url:"#/invoices/"+e.invoice_id}),utils.redirect(n,"/invoices")},function(t){window.scrollTo(0,0),e.exception.error=t})},e.editItemPrice=function(t){var n={reference_price:t.reference_price,reference_currency:t.reference_currency};null==t.reference_price&&(t.reference_price=t.price),null==t.reference_currency&&(t.reference_currency=t.currency),e.itemPriceEdits[t.item_id]=n,e.itemEdits=!0},e.editItemQuantity=function(t,n){if(!e.itemQuantityEdits[t.item_id]){var i={quantity:n};e.itemQuantityEdits[t.item_id]=i,e.itemEdits=!0}},e.cancelItemsEdit=function(t){for(var n in e.itemPriceEdits)if(e.itemPriceEdits.hasOwnProperty(n)){var i=_.findWhere(t,{item_id:n});i&&(i.reference_price=e.itemPriceEdits[n].reference_price,i.reference_currency=e.itemPriceEdits[n].reference_currency)}for(var n in e.itemQuantityEdits)if(e.itemQuantityEdits.hasOwnProperty(n)){var i=_.findWhere(t,{item_id:n});i&&(i.quantity=e.itemQuantityEdits[n].quantity)}e.itemPriceEdits={},e.itemQuantityEdits={},e.itemEdits=!1},e.applyItemEdits=function(){e.exception.error=null,e.backgroundUpdate().then(function(t){e.itemPriceEdits={},e.itemQuantityEdits={},e.itemEdits=!1},function(t){window.scrollTo(0,0),e.exception.error=t})},e.removeCustomer=function(){e.invoice.customer=null,e.invoice.customer_id=null,e.invoice.url&&e.backgroundUpdate()},e.save=function(){var t=e.invoice.draft;e.invoice.draft=e.draft,i.set(e.invoice,e.url,e.params).then(function(e){s.addGrowl({id:"edit_success",name:"invoice "+e.invoice_id,type:"success",url:"#/invoices/"+e.invoice_id}),utils.redirect(n,"/invoices")},function(n){e.exception.error=n,e.invoice.draft=t,window.scrollTo(0,0)})},e.setShipping=function(t){return e.invoice.shipping_method_id=t,e.backgroundUpdate()},e.publish=function(){e.draft=!1,e.invoice.draft=!1,i.set(e.invoice,e.url,e.params).then(function(e){s.addGrowl({id:"invoice_published",type:"success"})},function(t){e.draft=!0,e.invoice.draft=!0,e.exception.error=t,window.scrollTo(0,0)})},e.send=function(){i.set(null,e.url+"/send").then(function(e){s.addGrowl({id:"invoice_sent",type:"success"})},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.delete=function(){i.remove(e.url).then(function(){s.addGrowl({id:"delete_success",name:"invoice "+e.invoice.invoice_id,type:"success"}),utils.redirect(n,"/invoices")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.confirmCancel=function(){var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/invoices")},o.showConfirm(e,t)},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},o.showConfirm(e,t)},e.downloadPdf=function(){i.getItemPdf(e.url).then(function(t){var n=new Blob([t],{type:"application/pdf"});saveAs(n,"Invoice_"+e.invoice.invoice_id+".pdf")},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("LicenseRequestsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.licenseRequests={},e.nav={},e.exception={},e.parseParams=function(){e.params=n.search(),utils.stringsToBool(e.params),null==e.params.status&&(e.params.status="completed"),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadLicenseRequests=function(){s.getList(s.buildUrl("/license_requests",{expand:"order",show:"license_request_id,status,date_created,order.order_id"}),e.params).then(function(t){e.licenseRequests.licenseRequestList=t,e.licenseRequestsChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,i){e.params[t]=i,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,n.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),n.search(e.params))},e.movePage=function(t,i){"+"==t?(e.params.after_item=i,e.params.before_item=null):(e.params.after_item=null,e.params.before_item=i),e.nav.scrollTop=!0,n.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,n.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadLicenseRequests()}),e.parseParams(),e.loadLicenseRequests()}]),app.controller("LicenseRequestViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService",function(e,t,n,i,o,s,r){e.licenseRequest={},e.exception={},e.options={},e.options.raw=!0,e.options.html=!0,e.url=o.buildUrl("/license_requests/"+t.id);var a={expand:"license,license_service"};o.getItem(e.url,a).then(function(t){e.licenseRequest=t,e.renderedLicenseText=t.license.label+":\n"+t.license.text,t.license.instructions&&(e.renderedLicenseText+="\n\n"+t.license.instructions),e.renderedLicenseHtml=t.license.label+"<br>"+t.license.html,t.license.instructions&&(e.renderedLicenseHtml+="<br><br>"+t.license.instructions),e.licenseRequest.order=JSON.stringify(e.licenseRequest.order,null,4)},function(t){e.exception.error=t,window.scrollTo(0,0)})}]),app.controller("LicenseServicesListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.license_services={},e.nav={},e.exception={},e.parseParams=function(){e.params=n.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="name"),null==e.params.desc&&(e.params.desc=!1)},e.loadLicenseServices=function(){s.getList(s.buildUrl("/license_services?show=license_service_id,name,type,configuration.license_count,configuration.notify_at_count,date_created"),e.params).then(function(t){e.license_services.license_serviceList=t,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,i){e.params[t]=i,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,n.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),n.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.license_services.license_serviceList.next_page_offset:e.params.offset=e.license_services.license_serviceList.previous_page_offset,e.nav.scrollTop=!0,n.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,n.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadLicenseServices()}),e.parseParams(),e.loadLicenseServices()}]),app.controller("LicenseServicesSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,n,i,o,s){e.licenses={},e.licenses.list=null,e.exception={},e.license_service={},e.license_service.type="list",e.license_service.configuration={},e.license_service.configuration.format="json",e.license_service.configuration.per_quantity=!1,e.license_service.configuration.remove_after_use=!0,e.license_service.configuration.notify_at_count=100,null!=t.id?(e.update=!0,e.add=!1,e.url=o.buildUrl("/license_services/"+t.id),o.getItem(e.url).then(function(t){e.license_service=t,"list"==e.license_service.type&&(e.licenses.list=utils.arrayToString(e.license_service.configuration.licenses),e.license_service.configuration.format="json"),"remote_url"==e.license_service.type&&(e.license_service.configuration.per_quantity=!1,e.license_service.configuration.remove_after_use=!0,e.license_service.configuration.notify_at_count=100)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0);var r=function(){e.exception.error=null};e.confirmCancel=function(){var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/license_services")},s.showConfirm(e,t)},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},s.showConfirm(e,t)},e.addLicenseService=function(){return r(),e.form.$invalid?void window.scrollTo(0,0):(null!=e.licenses.list&&"list"==e.license_service.type&&(e.license_service.configuration.licenses=utils.stringToArray(e.licenses.list)),void o.set(e.license_service,o.buildUrl("/license_services"),{show:"license_service_id,name"}).then(function(e){i.addGrowl({id:"add_success",name:e.name,type:"success",license_service_id:e.license_service_id,url:"#/license_services/"+e.license_service_id+"/edit"}),window.location="#/license_services"},function(t){e.exception.error=t,window.scrollTo(0,0)}))},e.updateLicenseService=function(){r(),e.form.$invalid||(null!=e.licenses.list&&"list"==e.license_service.type&&(e.license_service.configuration.licenses=utils.stringToArray(e.licenses.list)),o.set(e.license_service,e.url,{show:"license_service_id,name"}).then(function(e){i.addGrowl({id:"edit_success",name:e.name,type:"success",license_service_id:e.license_service_id,url:"#/license_services/"+e.license_service_id+"/edit"}),utils.redirect(n,"/license_services")},function(t){window.scrollTo(0,0),e.exception.error=t}))},e.delete=function(){o.remove(e.license_service.url).then(function(t){i.addGrowl({id:"delete_success",name:e.license_service.name,type:"success"}),utils.redirect(n,"/license_services")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("NotificationsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.exception={},e.resources={},e.resources.notificationListUrl=s.buildUrl("/notifications")}]),app.controller("NotificationsViewCtrl",["$scope","$routeParams","ApiService","GrowlsService","$sce",function(e,t,n,i,o){e.notification={},e.exception={},e.url=n.buildUrl("/notifications/"+t.id),e.previewUrl=null,e.showResend=!1;var s={expand:"customer",hide:"data"};n.getItem(e.url,s).then(function(t){e.notification=t,e.previewUrl=o.trustAsResourceUrl("/app/pages/notifications/preview/index.html?notification_id="+t.notification_id),e.email=t.customer.email},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.resend=function(t){if(!t.$invalid){var o={destination:e.email};n.set(o,e.url+"/resend",{show:"notification_id"}).then(function(t){i.addGrowl({id:"notification_resend",email:e.email,type:"success"}),e.showResend=!1},function(t){e.exception.error=t,window.scrollTo(0,0)})}}}]),app.controller("NotificationsPreviewCtrl",["$scope","$routeParams","ApiService",function(e,t,n){e.notification={},e.exception={},e.url=n.buildUrl("/notifications/"+t.id);var i={show:"body"};n.getItem(e.url,i).then(function(t){e.notification=t},function(t){e.exception.error=t,window.scrollTo(0,0)})}]),app.controller("NotificationSubscriptionsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.notificationSubscriptions={},e.nav={},e.exception={},e.parseParams=function(){e.params=n.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadNotificationSubscriptions=function(){s.getList(s.buildUrl("/notification_subscriptions"),e.params).then(function(t){e.notificationSubscriptions.notificationSubscriptionList=t,e.notificationSubscriptionsChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,i){e.params[t]=i,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,n.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),n.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.notificationSubscriptions.notificationSubscriptionList.next_page_offset:e.params.offset=e.notificationSubscriptions.notificationSubscriptionList.previous_page_offset,e.nav.scrollTop=!0,n.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,n.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadNotificationSubscriptions()}),e.parseParams(),e.loadNotificationSubscriptions()}]),app.controller("NotificationSubscriptionsSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService",function(e,t,n,i,o,s,r){if(e.notificationSubscription={},e.exception={},e.typeValues=["order:confirmation","shipment:confirmation","cart:link","invoice:link"],e.showTemplate=!1,null!=t.id){e.update=!0,e.add=!1,e.url=o.buildUrl("/notification_subscriptions/"+t.id);var a={expand:"template"};o.getItem(e.url,a).then(function(t){e.notificationSubscription=t},function(t){e.exception.error=t,window.scrollTo(0,0)})}else e.update=!1,e.add=!0;var c=function(){e.exception.error=null};e.confirmCancel=function(){var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/notification_subscriptions")},s.showConfirm(e,t)},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},s.showConfirm(e,t)},e.addNotificationSubscription=function(){return c(),e.form.$invalid?void window.scrollTo(0,0):(e.notificationSubscription.method||(e.notificationSubscription.method="email"),e.notificationSubscription.template&&e.notificationSubscription.template.template_id&&(e.notificationSubscription.template_id=e.notificationSubscription.template.template_id),void o.set(e.notificationSubscription,o.buildUrl("/notification_subscriptions"),{show:"notification_subscription_id,name"}).then(function(e){i.addGrowl({id:"add_success",name:e.notification_subscription_id,type:"success",notification_subscription_id:e.notification_subscription_id,url:"#/notification_subscriptions/"+e.notification_subscription_id+"/edit"}),window.location="#/notification_subscriptions"},function(t){e.exception.error=t,window.scrollTo(0,0)}))},e.updateNotificationSubscription=function(){return c(),e.form.$invalid?void window.scrollTo(0,0):(e.notificationSubscription.template&&e.notificationSubscription.template.template_id&&(e.notificationSubscription.template_id=e.notificationSubscription.template.template_id),void o.set(e.notificationSubscription,e.url,{show:"notification_subscription_id,name"}).then(function(e){i.addGrowl({id:"edit_success",name:e.notification_subscription_id,type:"success",notification_subscription_id:e.notification_subscription_id,url:"#/notification_subscriptions/"+e.notification_subscription_id+"/edit"}),window.location="#/notification_subscriptions"},function(t){window.scrollTo(0,0),e.exception.error=t}))},e.delete=function(){o.remove(e.notificationSubscription.url).then(function(t){i.addGrowl({id:"delete_success",name:e.notificationSubscription.notification_subscription_id,type:"success"}),utils.redirect(n,"/notification_subscriptions")},function(t){window.scrollTo(0,0),
e.exception.error=t})},e.removeTemplate=function(){e.notificationSubscription.template=null,e.showTemplate=!1}}]),app.controller("OrdersListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.exception={},e.resources={},e.resources.orderListUrl=s.buildUrl("/orders")}]),app.controller("OrdersViewCtrl",["$scope","$routeParams","ApiService","ConfirmService","GrowlsService",function(e,t,n,i,o){e.order={},e.payment={},e.exception={},e.count={},e.count.shipments=0,e.resources={},e.url=n.buildUrl("/orders/"+t.id),e.resources.shipmentListUrl=e.url+"/shipments",e.resources.refundListUrl=e.url+"/refunds",e.resources.notificationListUrl=e.url+"/notifications";var s={expand:"customer,payment.response_data,payment.payment_method,payment.gateway,payment.refunds,items.product,items.subscription,items.download.file,items.license.license_service,shipments",hide:"items.product.images,items.license.license_service.configuration",formatted:!0};n.getItem(e.url,s).then(function(t){e.order=t},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.$watch("order.fulfilled",function(t,n){0==n&&1==t&&"pending"==e.order.payment.status&&"credit_card"==e.order.payment.payment_method.type&&(o.addGrowl({id:"payment_capture_scheduled",type:"success"}),e.order.hideCapture=!0)}),e.hasPermission=function(e,t){return utils.hasPermission(e,t)},e.downloadPdf=function(){n.getItemPdf(e.url).then(function(t){var n=new Blob([t],{type:"application/pdf"});saveAs(n,"Order_"+e.order.order_id+".pdf")},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("PaymentsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.exception={},e.resources={},e.resources.paymentListUrl=s.buildUrl("/payments")}]),app.controller("PaymentsViewCtrl",["$scope","$routeParams","ApiService","ConfirmService","GrowlsService",function(e,t,n,i,o){e.payment={},e.exception={},e.fee_currency=null,e.currencyType="transaction",e.prefs={},e.prefs.loadRefundDetails=!1,e.url=n.buildUrl("/payments/"+t.id),e.refundListUrl=e.url+"/refunds";var s={expand:"customer,payment_method,response_data,gateway,fees,commissions,order,refunds.items"};n.getItem(e.url,s).then(function(t){e.payment=t,t.fees.data.length>0&&(e.fee_currency=t.fees.data[0].currency)},function(t){e.exception.error=t,window.scrollTo(0,0)})}]),app.controller("ProductsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.products={},e.nav={},e.exception={},e.parseParams=function(){e.params=n.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadProducts=function(){s.getList(s.buildUrl("/products?show=product_id,name,active,price,currency,deleted,date_created&sort_by="+e.params.sort_by+"&desc="+e.params.desc),e.params).then(function(t){e.products.productList=t,e.productsChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setActive=function(t){function n(){e.successItems.length>0&&(1==t?o.addGrowl({id:"activate_success",count:e.successItems.length}):o.addGrowl({id:"inactivate_success",count:e.successItems.length}))}var r=_.where(e.products.productList.data,{checked:!0});e.successItems=[],e.failItems=[];var a=(i.defer(),[]);_.each(r,function(n){a.push(s.set({product_id:n.product_id,active:t},n.url).then(function(t){n.deleted=t.deleted,n.active=t.active,e.successItems.push(n)},function(t){e.failItems.push(n),o.addGrowl({id:"active_change_failure",name:n.name,type:"danger"})}))}),i.all(a).then(n)},e.setParam=function(t,i){e.params[t]=i,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,n.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),n.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.products.productList.next_page_offset:e.params.offset=e.products.productList.previous_page_offset,e.nav.scrollTop=!0,n.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,n.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadProducts()}),e.checkProduct=function(t){t.checked?(t.checked=!1,e.productsChecked=!1,_.each(e.products.productList.data,function(t){t.checked&&(e.productsChecked=!0)})):(t.checked=!0,e.productsChecked=!0)},e.parseParams(),e.loadProducts()}]),app.controller("ProductsSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,n,i,o,s){e.exception={},e.data={},null!=t.id?(e.update=!0,e.add=!1,e.url=o.buildUrl("/products/"+t.id),o.getItem(e.url,{expand:"file,images,subscription_plan,license_service"}).then(function(t){e.product=t,null==e.product.weight&&(e.product.weight={unit:"oz"}),e.data.file=t.file,e.data.images=t.images,e.data.subscription_plan=t.subscription_plan,e.data.license_service=t.license_service,delete e.product.file,delete e.product.images,delete e.product.subscription_plan,delete e.product.license_service;for(var n=0;n<e.product.prices.length;n++)e.product.prices[n].price=utils.cleanPrice(e.product.prices[n].price);e.product_orig=angular.copy(e.product)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0,e.product={active:!1,description:"",prices:[],weight:{}},e.data.images=[],e.account_id=localStorage.getItem("account_id"),e.product.active=!1,e.product.hidden=!1,e.product.weight.unit="oz",e.product.prices.push({price:"",currency:""})),e.currencies=JSON.parse(localStorage.getItem("payment_currencies")),e.removeFile=function(){e.product.file_id=null,e.data.file=null,e.showFile=!1},e.removeSubscriptionPlan=function(){e.product.subscription_plan_id=null,e.data.subscription_plan=null,e.showSubscriptionPlan=!1},e.removeLicenseService=function(){e.product.license_service_id=null,e.data.license_service=null,e.showLicenseService=!1};var r=function(){e.exception.error=null,e.product.prices=utils.removeEmptyPrices(e.product.prices),e.product.weight&&(null!=e.product.weight.amount&&""!=e.product.weight.amount||(e.product.weight=null)),0==e.product.prices.length&&e.product.prices.push({price:"",currency:""}),null!=e.data.file&&(e.product.file_id=e.data.file.file_id),null!=e.data.images&&_.each(e.data.images,function(t){null==e.product.image_ids&&(e.product.image_ids=[]),e.product.image_ids.push(t.image_id)}),null!=e.data.subscription_plan&&(e.product.subscription_plan_id=e.data.subscription_plan.subscription_plan_id),null!=e.data.license_service&&(e.product.license_service_id=e.data.license_service.license_service_id)};e.confirmCancel=function(){if(angular.equals(e.product,e.product_orig))utils.redirect(n,"/products");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/products")},s.showConfirm(e,t)}},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},s.showConfirm(e,t)},e.addProduct=function(){return r(),e.form.$invalid?void window.scrollTo(0,0):void o.set(e.product,o.buildUrl("/products"),{show:"product_id,name"}).then(function(e){i.addGrowl({id:"add_success",name:e.name,type:"success",product_id:e.product_id,url:"#/products/"+e.product_id+"/edit"}),utils.redirect(n,"/products")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.updateProduct=function(){r(),e.form.$invalid||o.set(e.product,e.url,{show:"product_id,name"}).then(function(e){i.addGrowl({id:"edit_success",name:e.name,type:"success",url:"#/products/"+e.product_id+"/edit"}),utils.redirect(n,"/products")},function(t){window.scrollTo(0,0),e.exception.error=t})},e.delete=function(){o.remove(e.url).then(function(){i.addGrowl({id:"delete_success_with_undelete",name:e.product.name,type:"success",url:"#/products/"+e.product.product_id+"/edit"}),utils.redirect(n,"/products")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.undelete=function(){o.set({deleted:!1},e.url,{show:"product_id,name"}).then(function(t){i.addGrowl({id:"undelete_success",name:e.product.name,type:"success",product_id:e.product.product_id,url:"#/products/"+t.product_id+"/edit"}),utils.redirect(n,"/products")},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("ProfileUpdateCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,n,i,o,s){e.exception={},e.url=o.buildUrl("/users/me"),o.getItem(e.url).then(function(t){e.user=t,e.user_orig=angular.copy(e.user)},function(t){e.exception.error=t,window.scrollTo(0,0)});var r=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.user,e.user_orig))utils.redirect(n,"/");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/")},s.showConfirm(e,t)}},e.updateProfile=function(t){if(r(),e.user.password||e.user.password2){if(e.user.password!=e.user.password2)return void t.password2.$setValidity("match",!1);t.password2.$setValidity("match",!0)}else t.password2.$setValidity("match",!0);e.form.$invalid||(utils.isNullOrEmpty(e.user.password)&&(delete e.user.password,delete e.user.password2),o.set(e.user,e.url).then(function(e){i.addGrowl({id:"edit_success",name:"your profile",type:"success",url:"#/profile"}),utils.redirect(n,"/")},function(t){window.scrollTo(0,0),e.exception.error=t}))}}]),app.controller("RefundsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.exception={},e.resources={},e.resources.refundListUrl=s.buildUrl("/refunds")}]),app.controller("RefundsViewCtrl",["$scope","$routeParams","ApiService","ConfirmService","GrowlsService",function(e,t,n,i,o){e.refund={},e.exception={},e.fee_currency=null,e.items=[],e.currencyType="transaction",e.prefs={},e.prefs.loadRefundDetails=!1,e.url=n.buildUrl("/refunds/"+t.id);var s={expand:"payment,customer,payment_method,gateway,fees,commissions,order,refunds.items"};n.getItem(e.url,s).then(function(t){e.refund=t,t.fees.data.length>0&&(e.fee_currency=t.fees.data[0].currency),null!=t.order&&(e.items=t.order.items)},function(t){e.exception.error=t,window.scrollTo(0,0)})}]),app.controller("ReportCommissionsController",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","TimezonesService",function(e,t,n,i,o,s,r){e.exception={},e.timezones=r.getTimezones(),e.url=o.buildUrl("/reports/commissions"),e.options={},e.options.category=null,e.options.desc="true",e.options.sort_by="total",e.options.timezone="UTC",e.options.dates="this_month",e.options.search_by="date",e.options.accounting_id=null,e.options.currencies=["Actual",localStorage.getItem("reporting_currency_primary"),localStorage.getItem("reporting_currency_secondary")],e.options.currency=e.options.currencies[0],e.nav={},e.datepicker={},e.datepicker.status={},e.datepicker.options={startingDay:1,showWeeks:!1,initDate:new Date,yearRange:10},e.datepicker.status.date_start={opened:!1},e.datepicker.status.date_end={opened:!1},e.datepicker.open=function(t,n){e.datepicker.status[n].opened=!0},e.run=function(t){e.exception={},t&&(e.options.offset="0");var n=e.options.dates;switch(date_end=e.options.dates,e.options.dates){case"last_30":n=-29,date_end=0;break;case"last_7":n=-6,date_end=0;break;case"custom":e.datepicker.date_end||(e.datepicker.date_end=new Date),e.datepicker.date_start||(e.datepicker.date_start=e.datepicker.date_end),n=e.datepicker.date_start.toISOString().substring(0,10),date_end=e.datepicker.date_end.toISOString().substring(0,10)}"doc"==e.options.search_by&&(n=null,date_end=null);var i=e.options.accounting_id;"date"==e.options.search_by&&(i=null);var s=e.options.currency;"Actual"==s&&(s=null),o.getItem(e.url,{category:e.options.category,currency:s,accounting_id:i,sort_by:e.options.sort_by,timezone:e.options.timezone,desc:e.options.desc,date_start:n,date_end:date_end,offset:e.options.offset,formatted:!0},!0,9e4).then(function(t){e.report=t,e.data={},_.each(t.data,function(t){e.data[t.currency]={},e.data[t.currency].data=[],e.data[t.currency].labels=[],e.data[t.currency].values=[],_.each(t.breakdowns,function(n){e.data[t.currency].data.push(n.total),e.data[t.currency].labels.push(n.type.split("_").join(" ")),e.data[t.currency].values.push(n.formatted.total)})}),1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.getChartData=function(e){var t={},n=[],i=[],o=[];return _.each(e.breakdowns,function(e){n.push(e.total),i.push(e.name),o.push(e.formatted.total)}),t.data=n,t.labels=i,t.values=o,t},e.downloadCsv=function(t,n){var i="all";if(e.options.category&&(i=e.options.category),"doc"==e.options.search_by)var o="commissionss_"+i+"_"+n+"_"+e.options.accounting_id;e.options.accounting_id;if("date"==e.options.search_by)var o="commissionss_"+i+"_"+n+"_"+utils.replaceAll(e.report.date_start,"-","").substring(0,8)+"-"+utils.replaceAll(e.report.date_end,"-","").substring(0,8)+"_"+utils.replaceAll(e.report.timezone," ","_").replace("/","_");_.each(t,function(e){e.currency=n}),utils.jsonToCsvDownload(t,o)},e.run()}]),app.controller("ReportFeesController",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","TimezonesService",function(e,t,n,i,o,s,r){e.exception={},e.timezones=r.getTimezones(),e.url=o.buildUrl("/reports/fees"),e.options={},e.options.category=null,e.options.desc="true",e.options.sort_by="total",e.options.timezone="UTC",e.options.dates="this_month",e.options.search_by="date",e.options.accounting_id=null,e.options.currencies=["Actual",localStorage.getItem("reporting_currency_primary"),localStorage.getItem("reporting_currency_secondary")],e.options.currency=e.options.currencies[0],e.nav={},e.datepicker={},e.datepicker.status={},e.datepicker.options={startingDay:1,showWeeks:!1,initDate:new Date,yearRange:10},e.datepicker.status.date_start={opened:!1},e.datepicker.status.date_end={opened:!1},e.datepicker.open=function(t,n){e.datepicker.status[n].opened=!0},e.run=function(t){e.exception={},t&&(e.options.offset="0");var n=e.options.dates;switch(date_end=e.options.dates,e.options.dates){case"last_30":n=-29,date_end=0;break;case"last_7":n=-6,date_end=0;break;case"custom":e.datepicker.date_end||(e.datepicker.date_end=new Date),e.datepicker.date_start||(e.datepicker.date_start=e.datepicker.date_end),n=e.datepicker.date_start.toISOString().substring(0,10),date_end=e.datepicker.date_end.toISOString().substring(0,10)}"doc"==e.options.search_by&&(n=null,date_end=null);var i=e.options.accounting_id;"date"==e.options.search_by&&(i=null);var s=e.options.currency;"Actual"==s&&(s=null),o.getItem(e.url,{category:e.options.category,currency:s,accounting_id:i,sort_by:e.options.sort_by,timezone:e.options.timezone,desc:e.options.desc,date_start:n,date_end:date_end,offset:e.options.offset,formatted:!0},!0,9e4).then(function(t){e.report=t,e.data={},_.each(t.data,function(t){e.data[t.currency]={},e.data[t.currency].data=[],e.data[t.currency].labels=[],e.data[t.currency].values=[],_.each(t.breakdowns,function(n){e.data[t.currency].data.push(n.total),e.data[t.currency].labels.push(n.type.split("_").join(" ")),e.data[t.currency].values.push(n.formatted.total)})}),1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.getChartData=function(e){var t={},n=[],i=[],o=[];return _.each(e.breakdowns,function(e){n.push(e.total),i.push(e.name),o.push(e.formatted.total)}),t.data=n,t.labels=i,t.values=o,t},e.downloadCsv=function(t,n){var i="all";if(e.options.category&&(i=e.options.category),"doc"==e.options.search_by)var o="fees_"+i+"_"+n+"_"+e.options.accounting_id;e.options.accounting_id;if("date"==e.options.search_by)var o="fees_"+i+"_"+n+"_"+utils.replaceAll(e.report.date_start,"-","").substring(0,8)+"-"+utils.replaceAll(e.report.date_end,"-","").substring(0,8)+"_"+utils.replaceAll(e.report.timezone," ","_").replace("/","_");_.each(t,function(e){e.currency=n}),utils.jsonToCsvDownload(t,o)},e.run()}]),app.controller("ReportItemsController",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","TimezonesService",function(e,t,n,i,o,s,r){e.exception={},e.timezones=r.getTimezones(),e.url=o.buildUrl("/reports/items"),e.options={},e.options.type="combined",e.options.desc="true",e.options.sort_by="subtotal",e.options.timezone="UTC",e.options.dates="yesterday",e.options.offset="0",e.options.labels=[],e.options.values=[],e.options.currencies=[],e.options.currencies.push(localStorage.getItem("reporting_currency_primary")),e.options.currencies.push(localStorage.getItem("reporting_currency_secondary")),e.options.currency=e.options.currencies[0],e.nav={},e.datepicker={},e.datepicker.status={},e.datepicker.options={startingDay:1,showWeeks:!1,initDate:new Date,yearRange:10},e.datepicker.status.date_start={opened:!1},e.datepicker.status.date_end={opened:!1},e.datepicker.open=function(t,n){e.datepicker.status[n].opened=!0},e.run=function(t){e.exception={},t&&(e.options.offset="0");var n=e.options.dates;switch(date_end=e.options.dates,e.options.dates){case"last_30":n=-29,date_end=0;break;case"last_7":n=-6,date_end=0;break;case"custom":e.datepicker.date_end||(e.datepicker.date_end=new Date),e.datepicker.date_start||(e.datepicker.date_start=e.datepicker.date_end),n=e.datepicker.date_start.toISOString().substring(0,10),date_end=e.datepicker.date_end.toISOString().substring(0,10)}o.getItem(e.url,{type:e.options.type,sort_by:e.options.sort_by,timezone:e.options.timezone,desc:e.options.desc,date_start:n,date_end:date_end,currency:e.options.currency,offset:e.options.offset,formatted:!0},!0,9e4).then(function(t){e.report=t,e.data=[],e.options.labels=[],e.options.values=[],_.each(t.data,function(t){e.data.push(t.total),e.options.labels.push(t.name),e.options.values.push(t.formatted.total)}),1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.movePage=function(t){"+"==t?e.options.offset=e.report.next_page_offset:e.options.offset=e.report.previous_page_offset,e.nav.scrollTop=!0,e.run()},e.downloadCsv=function(t){var n="sales_by_product_"+e.report.type+"_"+utils.replaceAll(e.report.date_start,"-","").substring(0,8)+"-"+utils.replaceAll(e.report.date_end,"-","").substring(0,8)+"_"+utils.replaceAll(e.report.timezone," ","_").replace("/","_");utils.jsonToCsvDownload(t,n)},e.run()}]),app.controller("ReportSalesCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","TimezonesService",function(e,t,n,i,o,s,r){e.exception={},e.timezones=r.getTimezones(),e.url=o.buildUrl("/reports/sales"),e.options={},e.options.type="combined",e.options.segment="all",e.options.group_by="day",e.options.timezone="UTC",e.options.dates="last_30",e.options.labels=[],e.options.values=[],e.options.currencies=[],e.options.currencies.push(localStorage.getItem("reporting_currency_primary")),e.options.currencies.push(localStorage.getItem("reporting_currency_secondary")),e.options.currency=e.options.currencies[0],e.datepicker={},e.datepicker.status={},e.datepicker.options={startingDay:1,showWeeks:!1,initDate:new Date,yearRange:10},e.datepicker.status.date_start={opened:!1},e.datepicker.status.date_end={opened:!1},e.datepicker.open=function(t,n){e.datepicker.status[n].opened=!0},e.run=function(){e.exception={};var t=e.options.dates;switch(date_end=e.options.dates,e.options.dates){case"last_30":t=-29,date_end=0;break;case"last_7":t=-6,date_end=0;break;case"custom":e.datepicker.date_end||(e.datepicker.date_end=new Date),e.datepicker.date_start||(e.datepicker.date_start=e.datepicker.date_end),t=e.datepicker.date_start.toISOString().substring(0,10),date_end=e.datepicker.date_end.toISOString().substring(0,10)}o.getItem(e.url,{type:e.options.type,group_by:e.options.group_by,timezone:e.options.timezone,segment:e.options.segment,date_start:t,date_end:date_end,currency:e.options.currency,formatted:!0}).then(function(t){e.report=t,e.data=[],e.options.labels=[],e.options.values=[],_.each(t.data,function(t){e.data.push(t.total-t.tax),e.options.labels.push(t.total),e.options.values.push(t.formatted.total)})},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.downloadCsv=function(t){var n="sales_"+e.report.type+"_"+e.report.segment+"_"+utils.replaceAll(e.report.date_start,"-","").substring(0,8)+"-"+utils.replaceAll(e.report.date_end,"-","").substring(0,8)+"_"+utils.replaceAll(e.report.timezone," ","_").replace("/","_");utils.jsonToCsvDownload(t,n)},e.run()}]),app.controller("AnalyticsSettingsCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,n,i,o,s){e.exception={},e.url=o.buildUrl("/settings/analytics"),o.getItem(e.url).then(function(t){e.settings=t,e.settings_orig=angular.copy(e.settings)},function(t){e.exception.error=t,window.scrollTo(0,0)});var r=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.settings,e.settings_orig))utils.redirect(n,"/");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/")},s.showConfirm(e,t)}},e.updateSettings=function(t){r(),e.form.$invalid||(null!=e.refund_reasons&&(e.settings.refund_reasons=utils.stringToArray(e.refund_reasons)),null!=e.chargeback_reasons&&(e.settings.chargeback_reasons=utils.stringToArray(e.chargeback_reasons)),o.set(e.settings,e.url).then(function(e){i.addGrowl({id:"edit_success",name:"Analytics Settings",type:"success",url:"#/settings/analytics"})},function(t){window.scrollTo(0,0),e.exception.error=t}))}}]),app.controller("FulfillmentSettingsCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,n,i,o,s){e.exception={},e.url=o.buildUrl("/settings/fulfillment"),o.getItem(e.url).then(function(t){e.settings=t,e.settings_orig=angular.copy(e.settings)},function(t){e.exception.error=t,window.scrollTo(0,0)});var r=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.settings,e.settings_orig))utils.redirect(n,"/");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/")},s.showConfirm(e,t)}},e.updateSettings=function(t){r(),e.form.$invalid||o.set(e.settings,e.url).then(function(e){i.addGrowl({id:"edit_success",name:"Fulfillment Settings",type:"success",url:"#/settings/fulfillment"})},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("GeneralSettingsCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","CurrenciesService","TimezonesService","HelperService",function(e,t,n,i,o,s,r,a,c){e.exception={},e.url=o.buildUrl("/settings/general"),e.currencies=r.getCurrencies(),e.timezones=a.getTimezones(),e.helperService=c,o.getItem(e.url).then(function(t){e.settings=t,e.typeahead={},e.typeahead.reporting_currency_primary=_.find(e.currencies,{code:t.reporting_currency_primary}),e.typeahead.reporting_currency_secondary=_.find(e.currencies,{code:t.reporting_currency_secondary}),e.app_hosts=utils.arrayToString(t.app_hosts),e.cors_allowed_origins=utils.arrayToString(t.cors_allowed_origins),e.oauth_redirect_uris=utils.arrayToString(t.oauth_redirect_uris),e.notification_from_addresses=utils.arrayToString(t.notification_from_addresses),e.settings_orig=angular.copy(e.settings)},function(t){e.exception.error=t,window.scrollTo(0,0)});var l=function(){e.exception.error=null};e.onCurrencySelect=function(t,n,i,o){e.settings["reporting_currency_"+o]=n.code},e.confirmCancel=function(){if(angular.equals(e.settings,e.settings_orig))utils.redirect(n,"/");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/")},s.showConfirm(e,t)}},e.updateSettings=function(){return l(),e.form.$invalid?void window.scrollTo(0,0):(null!=e.app_hosts&&(e.settings.app_hosts=utils.stringToArray(e.app_hosts)),null!=e.cors_allowed_origins&&(e.settings.cors_allowed_origins=utils.stringToArray(e.cors_allowed_origins)),null!=e.oauth_redirect_uris&&(e.settings.oauth_redirect_uris=utils.stringToArray(e.oauth_redirect_uris)),null!=e.notification_from_addresses&&(e.settings.notification_from_addresses=utils.stringToArray(e.notification_from_addresses)),void o.set(e.settings,e.url).then(function(e){i.addGrowl({id:"edit_success",name:"General Settings",type:"success",url:"#/settings/general"})},function(t){window.scrollTo(0,0),e.exception.error=t}))}}]),app.controller("PaymentSettingsCtrl",["$scope","$routeParams","$location","$timeout","GrowlsService","ApiService","ConfirmService","CurrenciesService","HelperService",function(e,t,n,i,o,s,r,a,c){function l(e,t){return _.each(e,function(e){t[e]=!0}),t}function u(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&1==e[n]&&t.push(n);return t}e.exception={},e.url=s.buildUrl("/settings/payment"),e.currencies=a.getCurrencies(),e.required_fields={},e.optional_fields={},e.helperService=c,s.getItem(e.url).then(function(t){e.settings=t,e.typeahead={},e.typeahead.default_payment_currency=_.find(e.currencies,{code:t.default_payment_currency}),e.refund_reasons=utils.arrayToString(t.refund_reasons),e.chargeback_reasons=utils.arrayToString(t.chargeback_reasons),e.blocked_countries=utils.arrayToString(t.blocked_countries),e.required_fields=l(t.customer_required_fields,e.required_fields),e.optional_fields=l(t.customer_optional_fields,e.optional_fields),e.settings_orig=angular.copy(e.settings)},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.onCurrencySelect=function(t,n,i,o){e.settings[o]=n.code},e.toggleCustomerRequiredField=function(t){e.required_fields[t]&&(e.optional_fields[t]=!1)},e.toggleCustomerOptionalField=function(t){e.optional_fields[t]&&(e.required_fields[t]=!1)};var p=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.settings,e.settings_orig))utils.redirect(n,"/");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/")},r.showConfirm(e,t)}},e.updateSettings=function(t){p(),e.form.$invalid||(null!=e.refund_reasons&&(e.settings.refund_reasons=utils.stringToArray(e.refund_reasons)),null!=e.chargeback_reasons&&(e.settings.chargeback_reasons=utils.stringToArray(e.chargeback_reasons)),null!=e.blocked_countries&&(e.settings.blocked_countries=utils.stringToArray(e.blocked_countries)),e.settings.customer_required_fields=u(e.required_fields),e.settings.customer_optional_fields=u(e.optional_fields),s.set(e.settings,e.url).then(function(e){o.addGrowl({id:"edit_success",name:"Payment Settings",type:"success",url:"#/settings/payment"})},function(t){window.scrollTo(0,0),e.exception.error=t}))}}]),app.controller("SubscriptionsSettingsCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,n,i,o,s){e.exception={},e.url=o.buildUrl("/settings/subscription"),o.getItem(e.url).then(function(t){e.settings=t,e.settings_orig=angular.copy(e.settings),e.cancellation_reasons=utils.arrayToString(t.cancellation_reasons)},function(t){e.exception.error=t,window.scrollTo(0,0)});var r=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.settings,e.settings_orig))utils.redirect(n,"/");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/")},s.showConfirm(e,t)}},e.updateSettings=function(t){r(),e.form.$invalid||(null!=e.cancellation_reasons&&(e.settings.cancellation_reasons=utils.stringToArray(e.cancellation_reasons)),o.set(e.settings,e.url).then(function(e){i.addGrowl({id:"edit_success",name:"Subscription Settings",type:"success",url:"#/settings/subscription"})},function(t){window.scrollTo(0,0),e.exception.error=t}))}}]),app.controller("TaxSettingsCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","GeographiesService",function(e,t,n,i,o,s,r){e.exception={},e.geo=r,e.url=o.buildUrl("/settings/tax"),e.countries=e.geo.getGeographies().countries,e.countries.push({code:"EU",name:"European Union"}),e.countries=_.sortBy(e.countries,"name"),e.ruleCountries=angular.copy(e.countries),e.countries.unshift({code:"*",name:"All countries"}),e.models={},e.models.tax_inclusive_countries=[],e.models.gross_discount_countries=[],e.typeahead={},o.getItem(e.url).then(function(t){e.settings=t,_.each(t.tax_inclusive_countries,function(t){var n=_.findWhere(e.countries,{code:t});null!=n&&e.models.tax_inclusive_countries.push(n)}),_.each(t.gross_discount_countries,function(t){var n=_.findWhere(e.countries,{code:t});null!=n&&e.models.gross_discount_countries.push(n)}),_.each(e.settings.rules,function(t){t.country=_.find(e.countries,{code:t.country}),t.manual_rate=!1,null!=t.rate&&(t.manual_rate=!0),t.state_prov&&(t.state_prov=t.state_prov.toUpperCase())})},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.addNewRule=function(){e.settings.rules.unshift({manual_rate:!0})},e.confirmDelete=function(t,n){var i={id:"delete"};i.onConfirm=function(){e.deleteRule(t,n)},s.showConfirm(e,i)},e.deleteRule=function(t,n){e.settings.rules.splice(n,1)},e.onCountrySelect=function(t,n,i,o){_.findWhere(e.models[o],{code:n.code})||e.models[o].push(n),e.typeahead[o]=null},e.removeCountry=function(t,n){e.models[n]=_.reject(e.models[n],function(e){return e.code==t.code}),"tax_inclusive_countries"==n&&e.removeCountry(t,"gross_discount_countries")},e.onRuleCountrySelect=function(t,n,i,o,s){"US"==n.code||"CA"==n.code||"EU"==n.code||e.geo.isEuCountry(n.code)?s.manual_rate=!1:s.manual_rate=!0},e.confirmCancel=function(){var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/")},s.showConfirm(e,t)},e.updateSettings=function(t){if(e.exception.error=null,!e.form.$invalid){var n=angular.copy(e.settings);_.each(n.rules,function(e){e.manual_rate||(e.rate=null),delete e.manual_rate,e.country=e.country.code}),n.tax_inclusive_countries=_.pluck(e.models.tax_inclusive_countries,"code"),n.gross_discount_countries=_.pluck(e.models.gross_discount_countries,"code"),o.set(n,e.url).then(function(e){i.addGrowl({id:"edit_success",name:"Tax Settings",type:"success",url:"#/settings/tax"})},function(t){window.scrollTo(0,0),e.exception.error=t})}}}]),app.controller("TechnicalSettingsCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","CurrenciesService","TimezonesService","HelperService",function(e,t,n,i,o,s,r,a,c){e.exception={},e.url=o.buildUrl("/settings/technical"),e.currencies=r.getCurrencies(),e.timezones=a.getTimezones(),e.helperService=c,o.getItem(e.url).then(function(t){e.settings=t,e.typeahead={},e.typeahead.reporting_currency_primary=_.find(e.currencies,{code:t.reporting_currency_primary}),e.typeahead.reporting_currency_secondary=_.find(e.currencies,{code:t.reporting_currency_secondary}),e.app_hosts=utils.arrayToString(t.app_hosts),e.cors_allowed_origins=utils.arrayToString(t.cors_allowed_origins),e.oauth_redirect_uris=utils.arrayToString(t.oauth_redirect_uris),e.notification_from_addresses=utils.arrayToString(t.notification_from_addresses),e.settings_orig=angular.copy(e.settings)},function(t){e.exception.error=t,window.scrollTo(0,0)});var l=function(){e.exception.error=null};e.onCurrencySelect=function(t,n,i,o){e.settings["reporting_currency_"+o]=n.code},e.confirmCancel=function(){if(angular.equals(e.settings,e.settings_orig))utils.redirect(n,"/");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/")},s.showConfirm(e,t)}},e.updateSettings=function(){return l(),e.form.$invalid?void window.scrollTo(0,0):(null!=e.app_hosts&&(e.settings.app_hosts=utils.stringToArray(e.app_hosts)),null!=e.cors_allowed_origins&&(e.settings.cors_allowed_origins=utils.stringToArray(e.cors_allowed_origins)),null!=e.oauth_redirect_uris&&(e.settings.oauth_redirect_uris=utils.stringToArray(e.oauth_redirect_uris)),null!=e.notification_from_addresses&&(e.settings.notification_from_addresses=utils.stringToArray(e.notification_from_addresses)),void o.set(e.settings,e.url).then(function(e){i.addGrowl({id:"edit_success",name:"Technical Settings",type:"success",url:"#/settings/technical"})},function(t){window.scrollTo(0,0),e.exception.error=t}))}}]),app.controller("ShipmentsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){
e.shipments={},e.nav={},e.exception={},e.parseParams=function(){e.params=n.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_shipped"),null==e.params.desc&&(e.params.desc=!0)},e.loadShipments=function(){s.getList(s.buildUrl("/shipments"),e.params).then(function(t){e.shipments.shipmentList=t,e.shipmentsChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,i){e.params[t]=i,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,n.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),n.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.shipments.shipmentList.next_page_offset:e.params.offset=e.shipments.shipmentList.previous_page_offset,e.nav.scrollTop=!0,n.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,n.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadShipments()}),e.parseParams(),e.loadShipments()}]),app.controller("ShipmentsViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService",function(e,t,n,i,o,s,r){e.shipment={},e.exception={},e.count={},e.resources={},e.url=o.buildUrl("/shipments/"+t.id),e.resources.notificationListUrl=e.url+"/notifications",o.getItem(e.url,{expand:"order.customer"}).then(function(t){e.shipment=t},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},s.showConfirm(e,t)},e.delete=function(){o.remove(e.shipment.url).then(function(t){i.addGrowl({id:"delete_success",name:e.shipment.shipment_id,type:"success"}),utils.redirect(n,"/shipments")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("ShippingMethodsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.shippingMethods={},e.nav={},e.exception={},e.parseParams=function(){e.params=n.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadShippingMethods=function(){s.getList(s.buildUrl("/shipping_methods"),e.params).then(function(t){e.shippingMethods.shippingMethodList=t,e.shippingMethodsChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,i){e.params[t]=i,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,n.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),n.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.shippingMethods.shippingMethodList.next_page_offset:e.params.offset=e.shippingMethods.shippingMethodList.previous_page_offset,e.nav.scrollTop=!0,n.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,n.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadShippingMethods()}),e.parseParams(),e.loadShippingMethods()}]),app.controller("ShippingMethodsSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService","GeographiesService",function(e,t,n,i,o,s,r,a){function c(e){return e._states=[],e.typeahead={},e.percentage?(e.adjustment_type="percentage",e.percentage*=100,e.amounts=[]):e.amounts&&(e.adjustment_type="amounts"),"US"==e.country?l(e,"us_states"):"CA"==e.country&&l(e,"ca_provinces"),e}function l(t,n){return _.each(t.regions,function(i){var o=_.findWhere(e[n],{code:i});null!=o&&t._states.push(o)}),t}function u(t){e.adjustmentCountries=_.filter(e.models[t],function(t){return e.adjustmentsEligibleCountries.indexOf(t.code)!=-1})}function p(){return!!e.adjustmentCountries.length}function d(){var t=angular.copy(e.shippingMethod);return t.countries=_.pluck(e.models.shipping_method_countries,"code"),p()?t.adjustments=_.map(t.adjustments,m):t.adjustments=null,"subtotal"==e.shipping_method_config_type?(t.quantity_config=null,t.weight_config=null,t.subtotal_config.percent_of_subtotal/=100):"quantity"==e.shipping_method_config_type?(t.subtotal_config=null,t.weight_config=null):(e.shipping_method_config_type="weight")&&(t.subtotal_config=null,t.quantity_config=null),t}function m(e){return"percentage"==e.adjustment_type?e.amounts=null:e.percentage=null,e.regions=_.pluck(e._states,"code"),e.percentage&&(e.percentage/=100),delete e.adjustment_type,e}e.shippingMethod={quantity_config:{prices_per_quantity:[{price:null,currency:null}],rules:[]},weight_config:{prices_per_unit:[{price:null,currency:null}],rules:[]},subtotal_config:{rules:[]}},e.exception={},e.geo=a;var f=e.geo.getGeographies();e.countries=f.countries,e.us_states=f.us_states,e.ca_provinces=f.ca_provinces,e.countries=_.sortBy(e.countries,"name"),e.adjustmentsEligibleCountries=["US","CA"],e.adjustmentCountries=[],e.currencies=JSON.parse(localStorage.getItem("payment_currencies")),e.models={},e.models.shipping_method_countries=[],e.typeahead={},e.shipping_method_config_type=null,e.units=[{code:"lb",name:"pound"},{code:"oz",name:"ounce"},{code:"kg",name:"kilogram"},{code:"g",name:"gram"}],null!=t.id?(e.update=!0,e.add=!1,e.url=o.buildUrl("/shipping_methods/"+t.id),o.getItem(e.url).then(function(t){e.shippingMethod=t,_.each(t.countries,function(t){var n=_.findWhere(e.countries,{code:t});null!=n&&e.models.shipping_method_countries.push(n)}),u("shipping_method_countries"),e.shippingMethod.adjustments=_.map(e.shippingMethod.adjustments,c),e.shippingMethod.subtotal_config?(e.shipping_method_config_type="subtotal",e.shippingMethod.quantity_config={prices_per_quantity:[{price:null,currency:null}]},e.shippingMethod.weight_config={prices_per_unit:[{price:null,currency:null}]},e.shippingMethod.subtotal_config.percent_of_subtotal*=100):e.shippingMethod.quantity_config?(e.shipping_method_config_type="quantity",e.shippingMethod.weight_config={prices_per_unit:[{price:null,currency:null}]},e.shippingMethod.subtotal_config={}):e.shippingMethod.weight_config&&(e.shipping_method_config_type="weight",e.shippingMethod.quantity_config={prices_per_quantity:[{price:null,currency:null}]},e.shippingMethod.subtotal_config={})},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0);var h=function(){e.exception.error=null};e.onCountrySelect=function(t,n,i,o){_.findWhere(e.models[o],{code:n.code})||e.models[o].push(n),e.typeahead[o]=null,u(o)},e.removeCountry=function(t,n){e.models[n]=_.reject(e.models[n],function(e){return e.code==t.code}),u(n)},e.onRuleCurrencySelect=function(e,t,n,i,o){o.currency=t.code},e.addNewAdjustment=function(){var t={amounts:[{price:null,currency:null}],_states:[],typeahead:{}};e.shippingMethod.adjustments?e.shippingMethod.adjustments.unshift(t):e.shippingMethod.adjustments=[t]},e.removeAdjustment=function(t,n,i){e.shippingMethod.adjustments.splice(i,1)},e.onStateSelect=function(e,t,n,i){_.findWhere(e._states,{code:n.code})||e._states.push(n),e.typeahead.state_prov=null},e.removeState=function(e,t){e._states=_.reject(e._states,function(e){return e.code==t.code})},e.addNewRule=function(t,n){e.shippingMethod[t].rules||(e.shippingMethod[t].rules=[]),e.shippingMethod[t].rules.unshift(n||{})},e.removeRule=function(t,n,i,o){e.shippingMethod[n].rules.splice(o,1)},e.confirmCancel=function(){var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/shipping_methods")},s.showConfirm(e,t)},e.confirmDelete=function(t,n,i,o,r){var a={id:"delete"};a.onConfirm=t.bind(e,t,n,i,o,r),s.showConfirm(e,a)},e.addShippingMethod=function(){if(h(),e.form.$invalid)return void window.scrollTo(0,0);var t=d();o.set(t,o.buildUrl("/shipping_methods"),{show:"shipping_method_id,name"}).then(function(e){i.addGrowl({id:"add_success",name:e.shipping_method_id,type:"success",shipping_method_id:e.shipping_method_id,url:"#/shipping_methods/"+e.shipping_method_id+"/edit"}),window.location="#/shipping_methods"},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.updateShippingMethod=function(){if(h(),!e.form.$invalid){var t=d();o.set(t,e.url,{show:"shipping_method_id,name"}).then(function(e){i.addGrowl({id:"edit_success",name:e.shipping_method_id,type:"success",shipping_method_id:e.shipping_method_id,url:"#/shipping_methods/"+e.shipping_method_id+"/edit"}),window.location="#/shipping_methods"},function(t){window.scrollTo(0,0),e.exception.error=t})}},e.delete=function(){o.remove(e.shippingMethod.url).then(function(t){i.addGrowl({id:"delete_success",name:e.shippingMethod.shipping_method_id,type:"success"}),utils.redirect(n,"/shipping_methods")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("SubscriptionsListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.exception={},e.resources={},e.resources.subscriptionListUrl=s.buildUrl("/subscriptions")}]),app.controller("SubscriptionsViewCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,n,i,o,s){e.exception={},e.payment_method=null,e.invoices={},e.model={},e.model.subscription={},e.resources={},e.count={},e.count.invoices=0,e.url=o.buildUrl("/subscriptions/"+t.id),e.resources.invoiceListUrl=e.url+"/invoices",o.getItem(e.url,{expand:"subscription_plan,customer.payment_methods,item.product",hide:"product.images"}).then(function(t){e.model.subscription=t},function(t){e.exception.error=t,window.scrollTo(0,0)}),e.uncancel=function(){var t={cancel_at_current_period_end:!1};o.set(t,e.url,{expand:"subscription_plan,customer.cards,product",hide:"product.images"}).then(function(t){e.model.subscription=t},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("SubscriptionPlansListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.subscription_plans={},e.nav={},e.exception={},e.parseParams=function(){e.params=n.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="name"),null==e.params.desc&&(e.params.desc=!1)},e.loadSubscriptionPlans=function(){s.getList(s.buildUrl("/subscription_plans?show=subscription_plan_id,name,billing_interval,billing_interval_unit,trial_interval,trial_interval_unit,end_at_billing_count,date_created&sort_by="+e.params.sort_by+"&desc="+e.params.desc),e.params).then(function(t){e.subscription_plans.subscription_planList=t,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,i){e.params[t]=i,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,n.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),n.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.subscription_plans.subscription_planList.next_page_offset:e.params.offset=e.subscription_plans.subscription_planList.previous_page_offset,e.nav.scrollTop=!0,n.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,n.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadSubscriptionPlans()}),e.parseParams(),e.loadSubscriptionPlans()}]),app.controller("SubscriptionPlansSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,n,i,o,s){e.exception={},null!=t.id?(e.update=!0,e.add=!1,e.url=o.buildUrl("/subscription_plans/"+t.id),o.getItem(e.url).then(function(t){e.subscription_plan=t,e.subscription_plan_orig=angular.copy(e.subscription_plan)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0,e.subscription_plan={},e.subscription_plan.fulfill_on_renewal=!1,e.subscription_plan.order_confirmation_on_renewal=!0,e.subscription_plan.trial_interval_unit=null,e.subscription_plan.billing_interval_unit="month");var r=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.subscription_plan,e.subscription_plan_orig))utils.redirect(n,"/subscription_plans");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/subscription_plans")},s.showConfirm(e,t)}},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},s.showConfirm(e,t)},e.addSubscriptionPlan=function(){return r(),e.form.$invalid?void window.scrollTo(0,0):void o.set(e.subscription_plan,o.buildUrl("/subscription_plans"),{show:"subscription_plan_id,name"}).then(function(e){i.addGrowl({id:"add_success",name:e.name,type:"success",subscription_plan_id:e.subscription_plan_id,url:"#/subscription_plans/"+e.subscription_plan_id+"/edit"}),utils.redirect(n,"/subscription_plans")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.updateSubscriptionPlan=function(){return r(),e.form.$invalid?void window.scrollTo(0,0):((utils.isNullOrEmpty(e.subscription_plan.trial_interval_unit)||utils.isNullOrEmpty(e.subscription_plan.trial_interval))&&(e.subscription_plan.trial_interval_unit=null,e.subscription_plan.trial_interval=null),void o.set(e.subscription_plan,e.url,{show:"subscription_plan_id,name"}).then(function(e){i.addGrowl({id:"edit_success",name:e.name,type:"success",subscription_plan_id:e.subscription_plan_id,url:"#/subscription_plans/"+e.subscription_plan_id+"/edit"}),utils.redirect(n,"/subscription_plans")},function(t){window.scrollTo(0,0),e.exception.error=t}))},e.delete=function(){o.remove(e.url).then(function(t){i.addGrowl({id:"delete_success_with_undelete",name:e.subscription_plan.name,type:"success",subscription_plan_id:e.subscription_plan.subscription_plan_id,url:"#/subscription_plans/"+e.subscription_plan.subscription_plan_id+"/edit"}),utils.redirect(n,"/subscription_plans")},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.undelete=function(){o.set({deleted:!1},e.url,{show:"subscription_plan_id,name"}).then(function(t){i.addGrowl({id:"undelete_success",name:e.subscription_plan.name,type:"success",subscription_plan_id:e.subscription_plan.subscription_plan_id,url:"#/subscription_plans/"+t.subscription_plan_id+"/edit"}),utils.redirect(n,"/subscription_plans")},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),app.controller("TemplatesListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.templates={},e.nav={},e.exception={},e.parseParams=function(){e.params=n.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="date_created"),null==e.params.desc&&(e.params.desc=!0)},e.loadTemplates=function(){s.getList(s.buildUrl("/templates"),e.params).then(function(t){e.templates.templateList=t,e.templatesChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,i){e.params[t]=i,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,n.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),n.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.templates.templateList.next_page_offset:e.params.offset=e.templates.templateList.previous_page_offset,e.nav.scrollTop=!0,n.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,n.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadTemplates()}),e.parseParams(),e.loadTemplates()}]),app.controller("TemplatesSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService","SettingsService",function(e,t,n,i,o,s,r){e.template={},e.exception={},null!=t.id?(e.update=!0,e.add=!1,e.url=o.buildUrl("/templates/"+t.id),o.getItem(e.url,{expand:"wrapper_template"}).then(function(t){e.template=t,t.wrapper_template&&(e.template.wrapper_template_id=t.wrapper_template.template_id)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0);var a=function(){e.exception.error=null};e.confirmCancel=function(){var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/templates")},s.showConfirm(e,t)},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},s.showConfirm(e,t)},e.addTemplate=function(){return a(),e.form.$invalid?void window.scrollTo(0,0):void o.set(e.template,o.buildUrl("/templates"),{show:"template_id,name"}).then(function(e){i.addGrowl({id:"add_success",name:e.template_id,type:"success",template_id:e.template_id,url:"#/templates/"+e.template_id+"/edit"}),window.location="#/templates"},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.updateTemplate=function(){a(),e.form.$invalid||o.set(e.template,e.url,{show:"template_id,name"}).then(function(e){i.addGrowl({id:"edit_success",name:e.template_id,type:"success",template_id:e.template_id,url:"#/templates/"+e.template_id+"/edit"}),window.location="#/templates"},function(t){window.scrollTo(0,0),e.exception.error=t})},e.delete=function(){o.remove(e.template.url).then(function(t){i.addGrowl({id:"delete_success",name:e.template.template_id,type:"success"}),utils.redirect(n,"/templates")},function(t){window.scrollTo(0,0),e.exception.error=t})}}]),app.controller("UsersListCtrl",["$scope","$routeParams","$location","$q","GrowlsService","ApiService",function(e,t,n,i,o,s){e.users={},e.nav={},e.exception={},e.parseParams=function(){e.params=n.search(),utils.stringsToBool(e.params),null==e.params.sort_by&&(e.params.sort_by="name"),null==e.params.desc&&(e.params.desc=!0)},e.loadUsers=function(){s.getList(s.buildUrl("/users?show=user_id,name,date_last_login,date_created&sort_by="+e.params.sort_by+"&desc="+e.params.desc),e.params).then(function(t){e.users.userList=t,e.usersChecked=!1,1==e.nav.scrollTop&&window.scrollTo(0,0),e.nav.scrollTop=null},function(t){e.exception.error=t,window.scrollTo(0,0)})},e.setParam=function(t,i){e.params[t]=i,e.params.before_item=null,e.params.after_item=null,e.nav.scrollTop=!0,n.search(e.params)},e.search=function(){null!=e.params.q&&(e.params.offset=null,e.nav.scrollTop=!0,""==e.params.q&&(e.params.q=null),n.search(e.params))},e.movePage=function(t){"+"==t?e.params.offset=e.users.userList.next_page_offset:e.params.offset=e.users.userList.previous_page_offset,e.nav.scrollTop=!0,n.search(e.params)},e.sort=function(t,i){e.params.sort_by=t,e.params.desc=i,n.search(e.params)},e.$on("$routeUpdate",function(t){e.parseParams(),e.loadUsers()}),e.parseParams(),e.loadUsers()}]),app.controller("UsersSetCtrl",["$scope","$routeParams","$location","GrowlsService","ApiService","ConfirmService",function(e,t,n,i,o,s){e.exception={},e.data={},null!=t.id?(e.update=!0,e.add=!1,e.url=o.buildUrl("/users/"+t.id),o.getItem(e.url).then(function(t){e.usr=t,e.usr_orig=angular.copy(e.usr)},function(t){e.exception.error=t,window.scrollTo(0,0)})):(e.update=!1,e.add=!0);var r=function(){e.exception.error=null};e.confirmCancel=function(){if(angular.equals(e.usr,e.usr_orig))utils.redirect(n,"/users");else{var t={id:"changes_lost"};t.onConfirm=function(){utils.redirect(n,"/users")},s.showConfirm(e,t)}},e.confirmDelete=function(){var t={id:"delete"};t.onConfirm=function(){e.delete()},s.showConfirm(e,t)},e.addUser=function(){return r(),e.form.$invalid?void window.scrollTo(0,0):(e.usr.password=e.data.password,void o.set(e.usr,o.buildUrl("/users"),{show:"user_id,name"}).then(function(e){i.addGrowl({id:"add_success",name:e.name,type:"success",user_id:e.usr_id,url:"#/users/"+e.usr_id+"/edit"}),utils.redirect(n,"/users")},function(t){e.exception.error=t,window.scrollTo(0,0)}))},e.updateUser=function(){r(),e.form.$invalid||(utils.isNullOrEmpty(e.data.password)?delete e.usr.password:e.usr.password=e.data.password,o.set(e.usr,e.url,{show:"user_id,name"}).then(function(e){i.addGrowl({id:"edit_success",name:e.name,type:"success",url:"#/users/"+e.usr_id+"/edit"}),utils.redirect(n,"/users")},function(t){window.scrollTo(0,0),e.exception.error=t}))},e.delete=function(){o.remove(e.url).then(function(){i.addGrowl({id:"delete_success_with_undelete",name:e.usr.name,type:"success",url:"#/users/"+e.usr.usr_id+"/edit"}),utils.redirect(n,"/users")},function(t){e.exception.error=t,window.scrollTo(0,0)})}}]),$("document").ready(function(){var e=localStorage.getItem("token"),t="api.comecero.com";window.location.hostname.indexOf("admin-staging.")>-1&&(t="api-staging.comecero.com");var n=utils.getPageQueryParameters(),i="https://"+t+"/api/v1/notifications/"+n.notification_id+"?show=body";n.notification_id&&$.ajax({type:"GET",url:i,beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+e)},success:function(e){document.open(),document.write(e.body),document.close()}})});